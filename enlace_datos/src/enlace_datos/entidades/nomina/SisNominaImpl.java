package enlace_datos.entidades.nomina;

import enlace_datos.entidades.gestiones.contrato.sisHorarioContratoImpl;

import enlace_datos.entidades.nomina.SisDetCalculoAjusteImpl;

import enlace_datos.util.myEntityImpl;
import enlace_datos.util.utils;
import enlace_datos.util.utils_DB;

import java.sql.SQLException;

import oracle.jbo.AttributeList;
import oracle.jbo.JboException;
import oracle.jbo.Key;
import oracle.jbo.RowIterator;
import oracle.jbo.domain.Date;
import oracle.jbo.domain.Number;
import oracle.jbo.server.AttributeDefImpl;
import oracle.jbo.server.EntityDefImpl;
import oracle.jbo.server.EntityImpl;
import oracle.jbo.server.TransactionEvent;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class SisNominaImpl extends myEntityImpl {
    public static final int IDNOMINA = 0;
    public static final int IDTIPONOMINA = 1;
    public static final int IDPROCESO = 2;
    public static final int IDPARTIDA = 3;
    public static final int IDCONTRATO = 4;
    public static final int ANIO = 5;
    public static final int PERIODO = 6;
    public static final int SUELDOBASE = 7;
    public static final int ESCALAFON = 8;
    public static final int COMPLSALARIAL = 9;
    public static final int NOMINAL = 10;
    public static final int TOTALBONO = 11;
    public static final int TOTALDESCUENTO = 12;
    public static final int TOTALPLUSSALARIAL = 13;
    public static final int IDESTADO = 14;
    public static final int REGISTROEMPLEADO = 15;
    public static final int IDNOMINAREEMPLAZA = 16;
    public static final int IDPUESTO = 17;
    public static final int NUMEROPLAZA = 18;
    public static final int CORRELATIVO = 19;
    public static final int LIQUIDO = 20;
    public static final int CREADOPOR = 21;
    public static final int FECHACREACION = 22;
    public static final int MODPOR = 23;
    public static final int FECHAMODIF = 24;
    public static final int IDNOMINAREEMPLAZASISNOMINA = 25;
    public static final int SISNOMINA = 26;
    public static final int SISDETCALCULOAJUSTE = 27;
    private static EntityDefImpl mDefinitionObject;
    private boolean vgetLiquido=false;

    /**This is the default constructor (do not remove)
     */
    public SisNominaImpl() {
    }


    /**Retrieves the definition object for this instance class.
     */
    public static synchronized EntityDefImpl getDefinitionObject() {
        if (mDefinitionObject == null) {
            mDefinitionObject = (EntityDefImpl)EntityDefImpl.findDefObject("enlace_datos.entidades.nomina.SisNomina");
        }
        return mDefinitionObject;
    }

    /**Gets the attribute value for IdNomina, using the alias name IdNomina
     */
    public Number getIdNomina() {
        return (Number)getAttributeInternal(IDNOMINA);
    }

    /**Sets <code>value</code> as the attribute value for IdNomina
     */
    public void setIdNomina(Number value) {
        setAttributeInternal(IDNOMINA, value);
    }

    /**Gets the attribute value for IdTipoNomina, using the alias name IdTipoNomina
     */
    public Number getIdTipoNomina() {
        return (Number)getAttributeInternal(IDTIPONOMINA);
    }

    /**Sets <code>value</code> as the attribute value for IdTipoNomina
     */
    public void setIdTipoNomina(Number value) {
        setAttributeInternal(IDTIPONOMINA, value);
    }

    /**Gets the attribute value for IdProceso, using the alias name IdProceso
     */
    public Number getIdProceso() {
        return (Number)getAttributeInternal(IDPROCESO);
    }

    /**Sets <code>value</code> as the attribute value for IdProceso
     */
    public void setIdProceso(Number value) {
        setAttributeInternal(IDPROCESO, value);
    }

    /**Gets the attribute value for IdPartida, using the alias name IdPartida
     */
    public Number getIdPartida() {
        return (Number)getAttributeInternal(IDPARTIDA);
    }

    /**Sets <code>value</code> as the attribute value for IdPartida
     */
    public void setIdPartida(Number value) {
        setAttributeInternal(IDPARTIDA, value);
    }

    /**Gets the attribute value for IdContrato, using the alias name IdContrato
     */
    public Number getIdContrato() {
        return (Number)getAttributeInternal(IDCONTRATO);
    }

    /**Sets <code>value</code> as the attribute value for IdContrato
     */
    public void setIdContrato(Number value) {
        setAttributeInternal(IDCONTRATO, value);
    }

    /**Gets the attribute value for Anio, using the alias name Anio
     */
    public Number getAnio() {
        return (Number)getAttributeInternal(ANIO);
    }

    /**Sets <code>value</code> as the attribute value for Anio
     */
    public void setAnio(Number value) {
        setAttributeInternal(ANIO, value);
    }

    /**Gets the attribute value for Periodo, using the alias name Periodo
     */
    public Number getPeriodo() {
        return (Number)getAttributeInternal(PERIODO);
    }

    /**Sets <code>value</code> as the attribute value for Periodo
     */
    public void setPeriodo(Number value) {
        setAttributeInternal(PERIODO, value);
    }

    /**Gets the attribute value for SueldoBase, using the alias name SueldoBase
     */
    public Number getSueldoBase() {
        return (Number)getAttributeInternal(SUELDOBASE);
    }

    /**Sets <code>value</code> as the attribute value for SueldoBase
     */
    public void setSueldoBase(Number value) {
        Number vValor=null;
        if (value!=null){
            vValor=new Number(value.abs());
        }
        setAttributeInternal(SUELDOBASE, vValor);
    }

    /**Gets the attribute value for Escalafon, using the alias name Escalafon
     */
    public Number getEscalafon() {
        return (Number)getAttributeInternal(ESCALAFON);
    }

    /**Sets <code>value</code> as the attribute value for Escalafon
     */
    public void setEscalafon(Number value) {
        Number vValor=null;
        if (value!=null){
            vValor=new Number(value.abs());
        }
        setAttributeInternal(ESCALAFON, vValor);
    }

    /**Gets the attribute value for ComplSalarial, using the alias name ComplSalarial
     */
    public Number getComplSalarial() {
        return (Number)getAttributeInternal(COMPLSALARIAL);
    }

    /**Sets <code>value</code> as the attribute value for ComplSalarial
     */
    public void setComplSalarial(Number value) {
        Number vValor=null;
        if (value!=null){
            vValor=new Number(value.abs());
        }
        setAttributeInternal(COMPLSALARIAL, vValor);
    }

    /**Gets the attribute value for Nominal, using the alias name Nominal
     */
    public Number getNominal() {
       Number vSueldoBase;
       Number vEscalafon;
       Number vComplSal;
       Number vLiquido;
       
        vSueldoBase=this.getSueldoBase()==null?new Number(0):this.getSueldoBase();
        vEscalafon=this.getEscalafon()==null?new Number(0):this.getEscalafon();
        vComplSal=this.getComplSalarial()==null?new Number(0):this.getComplSalarial();
        vLiquido=vSueldoBase.add(vEscalafon).add(vComplSal);
       
        if (getAttributeInternal(NOMINAL)==null){
            setAttributeInternal(NOMINAL, vLiquido);            
        }else if (getAttributeInternal(NOMINAL)!=null && vLiquido.compareTo((Number)getAttributeInternal(NOMINAL))!=0){
            setAttributeInternal(NOMINAL, vLiquido);
        }
        //this.setNominal(this.getSueldoBase().add(this.getEscalafon()).add(this.getComplSalarial()));
        return (Number)getAttributeInternal(NOMINAL);
    }

    /**Sets <code>value</code> as the attribute value for Nominal
     */
    public void setNominal(Number value) {
        setAttributeInternal(NOMINAL, value);
    }

    /**Gets the attribute value for TotalBono, using the alias name TotalBono
     */
    public Number getTotalBono() {
        return (Number)getAttributeInternal(TOTALBONO);
    }

    /**Sets <code>value</code> as the attribute value for TotalBono
     */
    public void setTotalBono(Number value) {
        setAttributeInternal(TOTALBONO, value);
    }

    /**Gets the attribute value for TotalDescuento, using the alias name TotalDescuento
     */
    public Number getTotalDescuento() {
        return (Number)getAttributeInternal(TOTALDESCUENTO);
    }

    /**Sets <code>value</code> as the attribute value for TotalDescuento
     */
    public void setTotalDescuento(Number value) {
        setAttributeInternal(TOTALDESCUENTO, value);
    }

    /**Gets the attribute value for TotalPlusSalarial, using the alias name TotalPlusSalarial
     */
    public Number getTotalPlusSalarial() {
        return (Number)getAttributeInternal(TOTALPLUSSALARIAL);
    }

    /**Sets <code>value</code> as the attribute value for TotalPlusSalarial
     */
    public void setTotalPlusSalarial(Number value) {
        setAttributeInternal(TOTALPLUSSALARIAL, value);
    }

    /**Gets the attribute value for IdEstado, using the alias name IdEstado
     */
    public Number getIdEstado() {
        return (Number)getAttributeInternal(IDESTADO);
    }

    /**Sets <code>value</code> as the attribute value for IdEstado
     */
    public void setIdEstado(Number value) {
        setAttributeInternal(IDESTADO, value);
    }

    /**Gets the attribute value for RegistroEmpleado, using the alias name RegistroEmpleado
     */
    public Number getRegistroEmpleado() {
        return (Number)getAttributeInternal(REGISTROEMPLEADO);
    }

    /**Sets <code>value</code> as the attribute value for RegistroEmpleado
     */
    public void setRegistroEmpleado(Number value) {
        setAttributeInternal(REGISTROEMPLEADO, value);
    }

    /**Gets the attribute value for IdNominaReemplaza, using the alias name IdNominaReemplaza
     */
    public Number getIdNominaReemplaza() {
        return (Number)getAttributeInternal(IDNOMINAREEMPLAZA);
    }

    /**Sets <code>value</code> as the attribute value for IdNominaReemplaza
     */
    public void setIdNominaReemplaza(Number value) {
        setAttributeInternal(IDNOMINAREEMPLAZA, value);
    }

    /**getAttrInvokeAccessor: generated method. Do not modify.
     */
    protected Object getAttrInvokeAccessor(int index, 
                                           AttributeDefImpl attrDef) throws Exception {
        switch (index) {
        case IDNOMINA:
            return getIdNomina();
        case IDTIPONOMINA:
            return getIdTipoNomina();
        case IDPROCESO:
            return getIdProceso();
        case IDPARTIDA:
            return getIdPartida();
        case IDCONTRATO:
            return getIdContrato();
        case ANIO:
            return getAnio();
        case PERIODO:
            return getPeriodo();
        case SUELDOBASE:
            return getSueldoBase();
        case ESCALAFON:
            return getEscalafon();
        case COMPLSALARIAL:
            return getComplSalarial();
        case NOMINAL:
            return getNominal();
        case TOTALBONO:
            return getTotalBono();
        case TOTALDESCUENTO:
            return getTotalDescuento();
        case TOTALPLUSSALARIAL:
            return getTotalPlusSalarial();
        case IDESTADO:
            return getIdEstado();
        case REGISTROEMPLEADO:
            return getRegistroEmpleado();
        case IDNOMINAREEMPLAZA:
            return getIdNominaReemplaza();
        case IDPUESTO:
            return getIdPuesto();
        case NUMEROPLAZA:
            return getNumeroPlaza();
        case CORRELATIVO:
            return getCorrelativo();
        case LIQUIDO:
            return getLiquido();
        case CREADOPOR:
            return getCreadopor();
        case FECHACREACION:
            return getFechacreacion();
        case MODPOR:
            return getModpor();
        case FECHAMODIF:
            return getFechamodif();
        case SISNOMINA:
            return getSisNomina();
        case SISDETCALCULOAJUSTE:
            return getSisDetCalculoAjuste();
        case IDNOMINAREEMPLAZASISNOMINA:
            return getIdNominaReemplazaSisNomina();
        default:
            return super.getAttrInvokeAccessor(index, attrDef);
        }
    }

    /**setAttrInvokeAccessor: generated method. Do not modify.
     */
    protected void setAttrInvokeAccessor(int index, Object value, 
                                         AttributeDefImpl attrDef) throws Exception {
        switch (index) {
        case IDNOMINA:
            setIdNomina((Number)value);
            return;
        case IDTIPONOMINA:
            setIdTipoNomina((Number)value);
            return;
        case IDPROCESO:
            setIdProceso((Number)value);
            return;
        case IDPARTIDA:
            setIdPartida((Number)value);
            return;
        case IDCONTRATO:
            setIdContrato((Number)value);
            return;
        case ANIO:
            setAnio((Number)value);
            return;
        case PERIODO:
            setPeriodo((Number)value);
            return;
        case SUELDOBASE:
            setSueldoBase((Number)value);
            return;
        case ESCALAFON:
            setEscalafon((Number)value);
            return;
        case COMPLSALARIAL:
            setComplSalarial((Number)value);
            return;
        case NOMINAL:
            setNominal((Number)value);
            return;
        case TOTALBONO:
            setTotalBono((Number)value);
            return;
        case TOTALDESCUENTO:
            setTotalDescuento((Number)value);
            return;
        case TOTALPLUSSALARIAL:
            setTotalPlusSalarial((Number)value);
            return;
        case IDESTADO:
            setIdEstado((Number)value);
            return;
        case REGISTROEMPLEADO:
            setRegistroEmpleado((Number)value);
            return;
        case IDNOMINAREEMPLAZA:
            setIdNominaReemplaza((Number)value);
            return;
        case IDPUESTO:
            setIdPuesto((Number)value);
            return;
        case NUMEROPLAZA:
            setNumeroPlaza((Number)value);
            return;
        case CORRELATIVO:
            setCorrelativo((Number)value);
            return;
        case LIQUIDO:
            setLiquido((Number)value);
            return;
        case CREADOPOR:
            setCreadopor((String)value);
            return;
        case FECHACREACION:
            setFechacreacion((Date)value);
            return;
        case MODPOR:
            setModpor((String)value);
            return;
        case FECHAMODIF:
            setFechamodif((Date)value);
            return;
        default:
            super.setAttrInvokeAccessor(index, value, attrDef);
            return;
        }
    }

    /**Gets the associated entity SisNominaImpl
     */
    public SisNominaImpl getIdNominaReemplazaSisNomina() {
        return (SisNominaImpl)getAttributeInternal(IDNOMINAREEMPLAZASISNOMINA);
    }

    /**Sets <code>value</code> as the associated entity SisNominaImpl
     */
    public void setIdNominaReemplazaSisNomina(SisNominaImpl value) {
        setAttributeInternal(IDNOMINAREEMPLAZASISNOMINA, value);
    }

    /**Gets the associated entity oracle.jbo.RowIterator
     */
    public RowIterator getSisNomina() {
        return (RowIterator)getAttributeInternal(SISNOMINA);
    }

    /**Gets the associated entity oracle.jbo.RowIterator
     */
    public RowIterator getSisDetCalculoAjuste() {
        return (RowIterator)getAttributeInternal(SISDETCALCULOAJUSTE);
    }

    /**Gets the attribute value for IdPuesto, using the alias name IdPuesto
     */
    public Number getIdPuesto() {
        return (Number)getAttributeInternal(IDPUESTO);
    }

    /**Sets <code>value</code> as the attribute value for IdPuesto
     */
    public void setIdPuesto(Number value) {
        setAttributeInternal(IDPUESTO, value);
    }

    /**Gets the attribute value for NumeroPlaza, using the alias name NumeroPlaza
     */
    public Number getNumeroPlaza() {
        return (Number)getAttributeInternal(NUMEROPLAZA);
    }

    /**Sets <code>value</code> as the attribute value for NumeroPlaza
     */
    public void setNumeroPlaza(Number value) {
        setAttributeInternal(NUMEROPLAZA, value);
    }

    /**Gets the attribute value for Correlativo, using the alias name Correlativo
     */
    public Number getCorrelativo() {
        return (Number)getAttributeInternal(CORRELATIVO);
    }

    /**Sets <code>value</code> as the attribute value for Correlativo
     */
    public void setCorrelativo(Number value) {
        setAttributeInternal(CORRELATIVO, value);
    }

    /**Gets the attribute value for Liquido, using the alias name Liquido
     */
    public Number getLiquido() {        
        return (Number)getAttributeInternal(LIQUIDO);
    }

    /**Sets <code>value</code> as the attribute value for Liquido
     */
    public void setLiquido(Number value) {
        setAttributeInternal(LIQUIDO, value);
    }

    /**Add locking logic here.
     */
    public void lock() {
        super.lock();
    }


    public void validarEntidad(){
        if (this.getRegistroEmpleado()==null){
        throw new JboException("Por favor ingrese el Registro de Empleado.");
        //throw utils.getAttributeException(this.getEntityDef().getName(),"RegistroEmpleado","VAL_OBLIGATORIO",null);   
        }
        
        if (this.getIdTipoNomina()==null){
        throw new JboException("Por favor seleccione el tipo de nómina.");    
        }
        
        if (this.getAnio()==null){
        throw new JboException("Por favor ingrese el año.");        
        }
        
        if (this.getPeriodo()==null){
        throw new JboException("Por favor seleccione el periodo.");            
        }
        
        if (this.getIdPartida()==null||this.getIdPuesto()==null){
        throw new JboException("Por favor seleccione la plaza.");                
        }
        
        if (this.getSueldoBase()==null){
        throw new JboException("Por favor ingrese el sueldo base.");                    
        }
        
        if (this.getComplSalarial()==null){
        throw new JboException("Por favor ingrese el complemento salarial.");                        
        }
        
        if (this.getEscalafon()==null){
        throw new JboException("Por favor ingrese el escalafón.");                        
        }
        
        int vExiste;
        try{
        vExiste=Integer.parseInt(utils_DB.getEjecutarQuerry(this.getDBTransaction(),"select count(0) from sis_empleado where registro_empleado="+this.getRegistroEmpleado()).toString());
        }catch(Exception exep){
            vExiste=0;
        }
        if (vExiste==0){
        throw new JboException("Por favor revise el registro de empleado, no existe.");                        
        }
        
    }

    public void actualizar_liquido(){
        RowIterator vDetalleDesc;
        SisDetCalculoAjusteImpl vDescuento;
        vDetalleDesc=this.getSisDetCalculoAjuste();
        Number vTotalDescuentos=new Number(0);
        Number vTotalBonos=new Number(0);
        Number vTotalPlus=new Number(0);
        Number vLiquido;
        
        
        if (vDetalleDesc!=null){
            while (vDetalleDesc.hasNext()){
                 vDescuento=(SisDetCalculoAjusteImpl)vDetalleDesc.next();
              //   vDescuento.getAplicado()
               if (vDescuento.getOperacion()!=null){ 
                 if (vDescuento.getOperacion().equals("D")){ //descuento                     
                  vTotalDescuentos=vTotalDescuentos.add(vDescuento.getValorAplicado().abs().doubleValue());  
                 }else if(vDescuento.getOperacion().equals("ISD")){ //bono mensual                   
                  vTotalBonos=vTotalBonos.add(vDescuento.getValorAplicado());
                 }else if (vDescuento.getOperacion().equals("I")){ //bonos que se incluyen  deducciones
                  vTotalPlus=vTotalPlus.add(vDescuento.getValorAplicado());
                 }
                                                }
                                 }
                                 
       
          vLiquido=this.getNominal().add(vTotalBonos).subtract(vTotalDescuentos);  
        
          this.setTotalBono(vTotalBonos);                         
          this.setTotalDescuento(vTotalDescuentos);
          this.setTotalPlusSalarial(vTotalPlus);
          this.setLiquido(vLiquido);  
        
        }        
          
    }

    /**Custom DML update/insert/delete logic here.
     */
    protected void doDML(int operation, TransactionEvent e) {
       Number vIdEstado;
       
       //VALIDACIONES
      try {
      
          if (operation!=DML_DELETE){        
              
              validarEntidad();
              actualizar_liquido();
              if (this.getLiquido()!=null && this.getLiquido().compareTo(0)<0){
                 throw new JboException("Por favor revise los datos, el liquido no puede ser negativo."); 
              } 
              
          }
           
           // OPERACION 
           if (operation==DML_INSERT){
               vIdEstado=utils_DB.getIdEstado(e.getDBTransaction(),"GENERADO","SIS_NOMINA");
               this.setIdEstado(vIdEstado);
               this.setCreadopor(utils.getAuthUser(e.getDBTransaction()));
               this.setFechacreacion(utils.getFechaActual());
               
           }else if (operation==DML_UPDATE){
              
               actualizar_liquido();
               this.setModpor(utils.getAuthUser(e.getDBTransaction()));
               this.setFechamodif(utils.getFechaActual());
    
              
               /*
               Object oSueldoBase;
               String sSueldoBase;
               oSueldoBase = this.getSueldoBase();
               sSueldoBase = String.valueOf(oSueldoBase);
               //this.setNominal(new Number(sSueldoBase));
              // this.setLiquido(new Number(sSueldoBase));
               */
              
           }
           
                
         //  System.out.println("debug actualizando nomina " + this.getIdNomina());
            registrarLogOperaciones(operation, e); 
            super.doDML(operation, e);
      }
      catch (Exception ee) {
          System.out.println("a ocurrido un error en SisNominaImpl: " + ee.getMessage());
      }
    }

    /**Add attribute defaulting logic in this method.
     */
    protected void create(AttributeList attributeList) {
        Number vIdNomina;
        super.create(attributeList);
        vIdNomina=utils.getNumberOracle(utils_DB.getValorSequencia(this.getDBTransaction(),"sis_nomina_sq"));
        //this.setIdNomina(utils.getNumberOracle(utils.getFechaFormato("HHmmss",utils.getFechaActual())).multiply(-1));
        this.setIdNomina(vIdNomina);
        this.setEscalafon(new Number(0));
        this.setComplSalarial(new Number(0));
    }


    /**Gets the attribute value for Creadopor, using the alias name Creadopor
     */
    public String getCreadopor() {
        return (String)getAttributeInternal(CREADOPOR);
    }

    /**Sets <code>value</code> as the attribute value for Creadopor
     */
    public void setCreadopor(String value) {
        setAttributeInternal(CREADOPOR, value);
    }

    /**Gets the attribute value for Fechacreacion, using the alias name Fechacreacion
     */
    public Date getFechacreacion() {
        return (Date)getAttributeInternal(FECHACREACION);
    }

    /**Sets <code>value</code> as the attribute value for Fechacreacion
     */
    public void setFechacreacion(Date value) {
        setAttributeInternal(FECHACREACION, value);
    }

    /**Gets the attribute value for Modpor, using the alias name Modpor
     */
    public String getModpor() {
        return (String)getAttributeInternal(MODPOR);
    }

    /**Sets <code>value</code> as the attribute value for Modpor
     */
    public void setModpor(String value) {
        setAttributeInternal(MODPOR, value);
    }

    /**Gets the attribute value for Fechamodif, using the alias name Fechamodif
     */
    public Date getFechamodif() {
        return (Date)getAttributeInternal(FECHAMODIF);
    }

    /**Sets <code>value</code> as the attribute value for Fechamodif
     */
    public void setFechamodif(Date value) {
        setAttributeInternal(FECHAMODIF, value);
    }

    /**Creates a Key object based on given key constituents
     */
    public static Key createPrimaryKey(Number idNomina) {
        return new Key(new Object[]{idNomina});
    }
}
