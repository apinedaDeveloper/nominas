package enlace_datos.entidades.gestiones;

import enlace_datos.util.myEntityImpl;
import enlace_datos.util.utils_DB;

import oracle.jbo.AttributeList;
import oracle.jbo.JboException;
import oracle.jbo.Key;
import oracle.jbo.NameValuePairs;
import oracle.jbo.domain.Date;
import oracle.jbo.domain.Number;
import oracle.jbo.server.AttributeDefImpl;
import oracle.jbo.server.EntityDefImpl;
import oracle.jbo.server.EntityImpl;
import oracle.jbo.server.TransactionEvent;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class SisVariacionDetAjusteImpl extends myEntityImpl {
    public static final int IDVARIACIONNOMINA = 0;
    public static final int IDAJUSTE = 1;
    public static final int IDESTADOAJUSTE = 2;
    public static final int VALOR = 3;
    public static final int CUOTAS = 4;
    public static final int FECHAINICIO = 5;
    public static final int FECHAFIN = 6;
    public static final int VAR_ESTADO = 7;
    public static final int BAJA = 8;
    public static final int REMOVIBLE = 9;
    public static final int MODI = 10;
    public static final int RENUNCIA = 11;
    public static final int PORCENTAJE = 12;
    public static final int IDCORRELATIVO = 13;
    public static final int SISVARIACIONNOMINA = 14;
    private static EntityDefImpl mDefinitionObject;

    /**This is the default constructor (do not remove)
     */
    public SisVariacionDetAjusteImpl() {
    }


    /**Retrieves the definition object for this instance class.
     */
    public static synchronized EntityDefImpl getDefinitionObject() {
        if (mDefinitionObject == null) {
            mDefinitionObject = (EntityDefImpl)EntityDefImpl.findDefObject("enlace_datos.entidades.gestiones.SisVariacionDetAjuste");
        }
        return mDefinitionObject;
    }

    /**Gets the attribute value for IdVariacionNomina, using the alias name IdVariacionNomina
     */
    public Number getIdVariacionNomina() {
        return (Number)getAttributeInternal(IDVARIACIONNOMINA);
    }

    /**Sets <code>value</code> as the attribute value for IdVariacionNomina
     */
    public void setIdVariacionNomina(Number value) {
        setAttributeInternal(IDVARIACIONNOMINA, value);
    }

    /**Gets the attribute value for IdAjuste, using the alias name IdAjuste
     */
    public Number getIdAjuste() {
        return (Number)getAttributeInternal(IDAJUSTE);
    }

    /**Sets <code>value</code> as the attribute value for IdAjuste
     */
    public void setIdAjuste(Number value) {
        setAttributeInternal(IDAJUSTE, value);
    }

    /**Gets the attribute value for IdEstadoAjuste, using the alias name IdEstadoAjuste
     */
    public Number getIdEstadoAjuste() {
        return (Number)getAttributeInternal(IDESTADOAJUSTE);
    }

    /**Sets <code>value</code> as the attribute value for IdEstadoAjuste
     */
    public void setIdEstadoAjuste(Number value) {
        setAttributeInternal(IDESTADOAJUSTE, value);
    }

    /**Gets the attribute value for Valor, using the alias name Valor
     */
    public Number getValor() {
        return (Number)getAttributeInternal(VALOR);
    }

    /**Sets <code>value</code> as the attribute value for Valor
     */
    public void setValor(Number value) {
        setAttributeInternal(VALOR, value);
    }

    /**Gets the attribute value for Cuotas, using the alias name Cuotas
     */
    public Number getCuotas() {
        return (Number)getAttributeInternal(CUOTAS);
    }

    /**Sets <code>value</code> as the attribute value for Cuotas
     */
    public void setCuotas(Number value) {
        setAttributeInternal(CUOTAS, value);
    }

    /**Gets the attribute value for FechaInicio, using the alias name FechaInicio
     */
    public Date getFechaInicio() {
        return (Date)getAttributeInternal(FECHAINICIO);
    }

    /**Sets <code>value</code> as the attribute value for FechaInicio
     */
    public void setFechaInicio(Date value) {
        setAttributeInternal(FECHAINICIO, value);
    }

    /**Gets the attribute value for FechaFin, using the alias name FechaFin
     */
    public Date getFechaFin() {
        return (Date)getAttributeInternal(FECHAFIN);
    }

    /**Sets <code>value</code> as the attribute value for FechaFin
     */
    public void setFechaFin(Date value) {
        setAttributeInternal(FECHAFIN, value);
    }

    /**getAttrInvokeAccessor: generated method. Do not modify.
     */
    protected Object getAttrInvokeAccessor(int index, 
                                           AttributeDefImpl attrDef) throws Exception {
        switch (index) {
        case IDVARIACIONNOMINA:
            return getIdVariacionNomina();
        case IDAJUSTE:
            return getIdAjuste();
        case IDESTADOAJUSTE:
            return getIdEstadoAjuste();
        case VALOR:
            return getValor();
        case CUOTAS:
            return getCuotas();
        case FECHAINICIO:
            return getFechaInicio();
        case FECHAFIN:
            return getFechaFin();
        case VAR_ESTADO:
            return getvar_estado();
        case BAJA:
            return getbaja();
        case REMOVIBLE:
            return getremovible();
        case MODI:
            return getModi();
        case RENUNCIA:
            return getRenuncia();
        case PORCENTAJE:
            return getPorcentaje();
        case IDCORRELATIVO:
            return getIdCorrelativo();
        case SISVARIACIONNOMINA:
            return getSisVariacionNomina();
        default:
            return super.getAttrInvokeAccessor(index, attrDef);
        }
    }

    /**setAttrInvokeAccessor: generated method. Do not modify.
     */
    protected void setAttrInvokeAccessor(int index, Object value, 
                                         AttributeDefImpl attrDef) throws Exception {
        switch (index) {
        case IDVARIACIONNOMINA:
            setIdVariacionNomina((Number)value);
            return;
        case IDAJUSTE:
            setIdAjuste((Number)value);
            return;
        case IDESTADOAJUSTE:
            setIdEstadoAjuste((Number)value);
            return;
        case VALOR:
            setValor((Number)value);
            return;
        case CUOTAS:
            setCuotas((Number)value);
            return;
        case FECHAINICIO:
            setFechaInicio((Date)value);
            return;
        case FECHAFIN:
            setFechaFin((Date)value);
            return;
        case VAR_ESTADO:
            setvar_estado((String)value);
            return;
        case BAJA:
            setbaja((String)value);
            return;
        case REMOVIBLE:
            setremovible((String)value);
            return;
        case MODI:
            setModi((String)value);
            return;
        case RENUNCIA:
            setRenuncia((String)value);
            return;
        case PORCENTAJE:
            setPorcentaje((Number)value);
            return;
        case IDCORRELATIVO:
            setIdCorrelativo((Number)value);
            return;
        default:
            super.setAttrInvokeAccessor(index, value, attrDef);
            return;
        }
    }

    /**Gets the associated entity SisVariacionNominaImpl
     */
    public SisVariacionNominaImpl getSisVariacionNomina() {
        return (SisVariacionNominaImpl)getAttributeInternal(SISVARIACIONNOMINA);
    }

    /**Sets <code>value</code> as the associated entity SisVariacionNominaImpl
     */
    public void setSisVariacionNomina(SisVariacionNominaImpl value) {
        setAttributeInternal(SISVARIACIONNOMINA, value);
    }


    /**Gets the attribute value for var_estado, using the alias name var_estado
     */
    public String getvar_estado() {
        return (String)getAttributeInternal(VAR_ESTADO);
    }

    /**Add locking logic here.
     */
    public void lock() {
        super.lock();
    }




    /**Custom DML update/insert/delete logic here.
     */
    protected void doDML(int operation, TransactionEvent e) {
        
        Number idEstadoAjuste;
  
        
        if (operation==DML_INSERT ){
         
            if (getvar_estado() != null && getvar_estado().equals("ALTA")){
             //No. 1 indica que el usuario esta ingresando un nuevo ajuste al empleado
             // System.out.println("es un nuevo registro"); 
                validateEntityNew();
                idEstadoAjuste=utils_DB.getIdEstado(e.getDBTransaction(),"ALTA","SIS_VARIACION_DET_AJUSTE");  
                //System.out.println("es un nuevo registro"); 
            }
            else if (this.getbaja()!=null && this.getbaja().equals("SI")){
                validateEntityMod();  
                idEstadoAjuste=utils_DB.getIdEstado(e.getDBTransaction(),"BAJA","SIS_VARIACION_DET_AJUSTE");  
                
            }else if (getvar_estado() != null && ( getvar_estado().equals("REEMPLAZO") ||getvar_estado().equals("CAMBIO POR IVS") )){
                
                idEstadoAjuste=utils_DB.getIdEstado(e.getDBTransaction(),getvar_estado(),"SIS_VARIACION_DET_AJUSTE");  
            }
            else {
                validateEntityMod();  
                idEstadoAjuste=utils_DB.getIdEstado(e.getDBTransaction(),"MODIFICADO","SIS_VARIACION_DET_AJUSTE");  
              //  System.out.println("estoy modificando un ajuste");
            }
            //System.out.println(idEstadoAjuste); // prueba para ver que lleva la variable
            this.setIdEstadoAjuste(idEstadoAjuste);
            
            }
               
        registrarLogOperaciones(operation, e);     
        super.doDML(operation, e);
        
    }

    /**Sets <code>value</code> as the attribute value for var_estado
     */
    public void setvar_estado(String value) {
        setAttributeInternal(VAR_ESTADO, value);
    }

    /**Gets the attribute value for baja, using the alias name baja
     */
    public String getbaja() {
        return (String)getAttributeInternal(BAJA);
    }

    /**Sets <code>value</code> as the attribute value for baja
     */
    public void setbaja(String value) {
        setAttributeInternal(BAJA, value);
    }

    /**Gets the attribute value for removible, using the alias name removible
     */
    public String getremovible() {
        return (String)getAttributeInternal(REMOVIBLE);
    }

    /**Sets <code>value</code> as the attribute value for removible
     */
    public void setremovible(String value) {
        setAttributeInternal(REMOVIBLE, value);
    }


    /**Add Entity validation code in this method.
     */
    protected void validateEntity() {
    
        super.validateEntity();
    }


    private void validateEntityNew(){
      if (this.getFechaInicio()==null){
          throw new JboException("Ingrese la fecha de inicio");      
      }
      
      if (this.getFechaFin()!=null && this.getFechaFin().compareTo(this.getFechaInicio())<0){
          throw new JboException("Fecha Finalizacion debe ser mayor fecha inicio");       
          
      }
        
    }


    private void validateEntityMod() {
  //  this.getIdCorrelativo()
     NameValuePairs vparametros=new NameValuePairs();
     Object vValorConsulta;
     if (this.getremovible().equals("N")){
         if (this.getbaja().equals("NO")){
               throw new JboException("No se permite darle de baja a este descuento");      
         }
         
         if (this.getModi().equals("N")){
             throw new JboException("No se permite modificar este descuento");      
         }
         
     }else if (this.getremovible().equals("S")){
          if (this.getModi().equals("N") && (this.getFechaFin()!=null ||this.getValor()!=null)){
              throw new JboException("No se permite modificar este descuento");      
          }
          
          if (this.getbaja().equals("SI")){
                  vparametros.setAttribute("pIdAjuste",this.getIdAjuste());
                  vparametros.setAttribute("pIdContrato",0);
                  vparametros.setAttribute("pIdVariacionNom",this.getIdVariacionNomina());
                  vValorConsulta=utils_DB.getValorFuncion(this.getDBTransaction(),"sis_pkg_util.getPermitidoRemAjuste(?,?,?)",vparametros);
                  
                  if (vValorConsulta.toString().equals("NO")){
                      throw new JboException("Debe haber al menos un descuento del mismo tipo activo");
                  }
          
          }
      }
    
        super.validateEntity();
    }





    /**Gets the attribute value for Modi, using the alias name Modi
     */
    public String getModi() {
        return (String)getAttributeInternal(MODI);
    }

    /**Sets <code>value</code> as the attribute value for Modi
     */
    public void setModi(String value) {
        setAttributeInternal(MODI, value);
    }

    /**Gets the attribute value for Renuncia, using the alias name Renuncia
     */
    public String getRenuncia() {
        return (String)getAttributeInternal(RENUNCIA);
    }

    /**Sets <code>value</code> as the attribute value for Renuncia
     */
    public void setRenuncia(String value) {
        setAttributeInternal(RENUNCIA, value);
    }

    /**Gets the attribute value for Porcentaje, using the alias name Porcentaje
     */
    public Number getPorcentaje() {
        return (Number)getAttributeInternal(PORCENTAJE);
    }

    /**Sets <code>value</code> as the attribute value for Porcentaje
     */
    public void setPorcentaje(Number value) {
        setAttributeInternal(PORCENTAJE, value);
    }

    /**Gets the attribute value for IdCorrelativo, using the alias name IdCorrelativo
     */
    public Number getIdCorrelativo() {
        return (Number)getAttributeInternal(IDCORRELATIVO);
    }

    /**Sets <code>value</code> as the attribute value for IdCorrelativo
     */
    public void setIdCorrelativo(Number value) {
        setAttributeInternal(IDCORRELATIVO, value);
    }

    /**Creates a Key object based on given key constituents
     */
    public static Key createPrimaryKey(Number idVariacionNomina, 
                                       Number idAjuste) {
        return new Key(new Object[]{idVariacionNomina, idAjuste});
    }
}
