package enlace_datos.entidades.gestiones.procesos;

import enlace_datos.entidades.procesos.SisAsignacionNumChequeImpl;
import enlace_datos.entidades.procesos.SisProcesoPagoDetImpl;

import enlace_datos.util.myEntityImpl;
import enlace_datos.util.utils;
import enlace_datos.util.utils_DB;

import oracle.jbo.JboException;
import oracle.jbo.Key;
import oracle.jbo.NameValuePairs;
import oracle.jbo.RowIterator;
import oracle.jbo.domain.Date;
import oracle.jbo.domain.Number;
import oracle.jbo.server.AttributeDefImpl;
import oracle.jbo.server.EntityDefImpl;
import oracle.jbo.server.EntityImpl;
import oracle.jbo.server.TransactionEvent;;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class SisProcesoImpl extends myEntityImpl {
    public static final int IDPROCESO = 0;
    public static final int PROCESOPADRE = 1;
    public static final int TIPOPROCESO = 2;
    public static final int FECHAINICIO = 3;
    public static final int FECHAFIN = 4;
    public static final int ANIO = 5;
    public static final int PERIODO = 6;
    public static final int IDESTADO = 7;
    public static final int OBSERVACIONES = 8;
    public static final int OPERACION = 9;
    public static final int FECHAREF = 10;
    public static final int CREADOPOR = 11;
    public static final int SISPROCESOPAGODET = 12;
    public static final int SISASIGNACIONNUMCHEQUE = 13;
    private static EntityDefImpl mDefinitionObject;

    /**This is the default constructor (do not remove)
     */
    public SisProcesoImpl() {
    }


    /**Retrieves the definition object for this instance class.
     */
    public static synchronized EntityDefImpl getDefinitionObject() {
        if (mDefinitionObject == null) {
            mDefinitionObject = (EntityDefImpl)EntityDefImpl.findDefObject("enlace_datos.entidades.gestiones.procesos.SisProceso");
        }
        return mDefinitionObject;
    }

    /**Gets the attribute value for IdProceso, using the alias name IdProceso
     */
    public Number getIdProceso() {
        return (Number)getAttributeInternal(IDPROCESO);
    }

    /**Sets <code>value</code> as the attribute value for IdProceso
     */
    public void setIdProceso(Number value) {
        setAttributeInternal(IDPROCESO, value);
    }

    /**Gets the attribute value for ProcesoPadre, using the alias name ProcesoPadre
     */
    public Number getProcesoPadre() {
        return (Number)getAttributeInternal(PROCESOPADRE);
    }

    /**Sets <code>value</code> as the attribute value for ProcesoPadre
     */
    public void setProcesoPadre(Number value) {
        setAttributeInternal(PROCESOPADRE, value);
    }

    /**Gets the attribute value for Tipoproceso, using the alias name Tipoproceso
     */
    public Number getTipoproceso() {
        return (Number)getAttributeInternal(TIPOPROCESO);
    }

    /**Sets <code>value</code> as the attribute value for Tipoproceso
     */
    public void setTipoproceso(Number value) {
        setAttributeInternal(TIPOPROCESO, value);
    }

    /**Gets the attribute value for FechaInicio, using the alias name FechaInicio
     */
    public Date getFechaInicio() {
        return (Date)getAttributeInternal(FECHAINICIO);
    }

    /**Sets <code>value</code> as the attribute value for FechaInicio
     */
    public void setFechaInicio(Date value) {
        setAttributeInternal(FECHAINICIO, value);
    }

    /**Gets the attribute value for FechaFin, using the alias name FechaFin
     */
    public Date getFechaFin() {
        return (Date)getAttributeInternal(FECHAFIN);
    }

    /**Sets <code>value</code> as the attribute value for FechaFin
     */
    public void setFechaFin(Date value) {
        setAttributeInternal(FECHAFIN, value);
    }

    /**Gets the attribute value for Anio, using the alias name Anio
     */
    public Number getAnio() {
        return (Number)getAttributeInternal(ANIO);
    }

    /**Sets <code>value</code> as the attribute value for Anio
     */
    public void setAnio(Number value) {
        setAttributeInternal(ANIO, value);
    }

    /**Gets the attribute value for Periodo, using the alias name Periodo
     */
    public Number getPeriodo() {
        return (Number)getAttributeInternal(PERIODO);
    }

    /**Sets <code>value</code> as the attribute value for Periodo
     */
    public void setPeriodo(Number value) {
        setAttributeInternal(PERIODO, value);
    }

    /**Gets the attribute value for IdEstado, using the alias name IdEstado
     */
    public Number getIdEstado() {
        return (Number)getAttributeInternal(IDESTADO);
    }

    /**Sets <code>value</code> as the attribute value for IdEstado
     */
    public void setIdEstado(Number value) {
        setAttributeInternal(IDESTADO, value);
    }

    /**Gets the attribute value for Observaciones, using the alias name Observaciones
     */
    public String getObservaciones() {
        return (String)getAttributeInternal(OBSERVACIONES);
    }

    /**Sets <code>value</code> as the attribute value for Observaciones
     */
    public void setObservaciones(String value) {
        setAttributeInternal(OBSERVACIONES, value);
    }

    /**getAttrInvokeAccessor: generated method. Do not modify.
     */
    protected Object getAttrInvokeAccessor(int index, 
                                           AttributeDefImpl attrDef) throws Exception {
        switch (index) {
        case IDPROCESO:
            return getIdProceso();
        case PROCESOPADRE:
            return getProcesoPadre();
        case TIPOPROCESO:
            return getTipoproceso();
        case FECHAINICIO:
            return getFechaInicio();
        case FECHAFIN:
            return getFechaFin();
        case ANIO:
            return getAnio();
        case PERIODO:
            return getPeriodo();
        case IDESTADO:
            return getIdEstado();
        case OBSERVACIONES:
            return getObservaciones();
        case OPERACION:
            return getoperacion();
        case FECHAREF:
            return getFechaRef();
        case CREADOPOR:
            return getCreadopor();
        case SISASIGNACIONNUMCHEQUE:
            return getSisAsignacionNumCheque();
        case SISPROCESOPAGODET:
            return getSisProcesoPagoDet();
        default:
            return super.getAttrInvokeAccessor(index, attrDef);
        }
    }

    /**setAttrInvokeAccessor: generated method. Do not modify.
     */
    protected void setAttrInvokeAccessor(int index, Object value, 
                                         AttributeDefImpl attrDef) throws Exception {
        switch (index) {
        case IDPROCESO:
            setIdProceso((Number)value);
            return;
        case PROCESOPADRE:
            setProcesoPadre((Number)value);
            return;
        case TIPOPROCESO:
            setTipoproceso((Number)value);
            return;
        case FECHAINICIO:
            setFechaInicio((Date)value);
            return;
        case FECHAFIN:
            setFechaFin((Date)value);
            return;
        case ANIO:
            setAnio((Number)value);
            return;
        case PERIODO:
            setPeriodo((Number)value);
            return;
        case IDESTADO:
            setIdEstado((Number)value);
            return;
        case OBSERVACIONES:
            setObservaciones((String)value);
            return;
        case OPERACION:
            setoperacion((String)value);
            return;
        case FECHAREF:
            setFechaRef((Date)value);
            return;
        case CREADOPOR:
            setCreadopor((String)value);
            return;
        default:
            super.setAttrInvokeAccessor(index, value, attrDef);
            return;
        }
    }


    /**Gets the associated entity oracle.jbo.RowIterator
     */
    public RowIterator getSisProcesoPagoDet() {
        return (RowIterator)getAttributeInternal(SISPROCESOPAGODET);
    }

    /**Add locking logic here.
     */
    public void lock() {
        super.lock();
    }


    public boolean validateFecha(Date  data) {
        long vDiffMeses;
                long Milianio;
                Milianio=24*60*60;
               try{ 
                  if (data!=null){
                  vDiffMeses=new java.util.Date().getTime()- data.getValue().getTime(); 
                  vDiffMeses=vDiffMeses/(1000*Milianio);
                  if (vDiffMeses>30){
                      return false;
                  }
                                }
               }catch(Exception exep){
                exep.printStackTrace();
                 return false;
               }
        return true;
    }

    /**Custom DML update/insert/delete logic here.
     */
    protected void doDML(int operation, TransactionEvent e) {
      
      String vNuevaSequencia;
      Number idProceso;
      Number idEstado;
      Object idTipoProceso;
      NameValuePairs vRestriccion= new NameValuePairs();
      RowIterator vFilas;  
      SisProcesoPagoDetImpl  vdetProceso;
      SisAsignacionNumChequeImpl vCheques;
      boolean detalle=false;
      // Si es una inserccion
     if (operation==DML_INSERT){
     
     
      // Obtengo el id del proceso
      vNuevaSequencia=utils_DB.getValorSequencia(e.getDBTransaction(),"sis_proceso_sq");
     
      // Obtengo el estado del proceso
      idEstado=utils_DB.getIdEstado(e.getDBTransaction(),"PROCESANDO","SIS_PROCESO");
     try{ 
         
      if (getoperacion()!=null && getoperacion().equals("PAGO")){
      // Obtengo el id del tipo de proceso
      vRestriccion.setAttribute("NOMBRE","PAGO");
      idTipoProceso=utils_DB.getValorTabla(e.getDBTransaction(),"sis_tipo_proceso","id_tipoproceso",vRestriccion);  
      this.setTipoproceso(new Number(idTipoProceso));
      }
    
      
      idProceso=new Number(vNuevaSequencia);
      vFilas=this.getSisProcesoPagoDet();

        

       // Cambio el id del proceso para el proceso pago det        
       while (vFilas.hasNext()){
           vdetProceso=(SisProcesoPagoDetImpl )vFilas.next();
           vdetProceso.setIdProceso(idProceso);
           detalle=true;
       }
         
         // Verifica que tenga al menos un detalle para el calculo de pago
            if (detalle==false && this.getoperacion()!=null) {
                throw new JboException("INGRESE AL MENOS UN TIPO DE NOMINA PARA EL PAGO.");
            } 
            
            
         vFilas=this.getSisAsignacionNumCheque();
       
         // Cambio el id del proceso para el proceso asignacion cheques       
         while (vFilas.hasNext()){
             vCheques=( SisAsignacionNumChequeImpl)vFilas.next();
             vCheques.setIdProceso(idProceso);
         }
       
       
           if (this.getAnio()==null){
             this.setAnio(utils.getNumberOracle(utils.getFechaFormato("yyyy",new java.util.Date())));       
           }
       
        this.setIdProceso(idProceso);
        this.setIdEstado(idEstado);
        this.setCreadopor(utils.getAuthUser(this.getDBTransaction()));
       
      
        
     }catch(Exception exep){
        exep.printStackTrace(); 
     }
     }
     
    
        registrarLogOperaciones(operation, e);   
        super.doDML(operation, e);
    }

    /**Gets the attribute value for operacion, using the alias name operacion
     */
    public String getoperacion() {
        return (String)getAttributeInternal(OPERACION);
    }

    /**Sets <code>value</code> as the attribute value for operacion
     */
    public void setoperacion(String value) {
        setAttributeInternal(OPERACION, value);
    }

    /**Add Entity validation code in this method.
     */
    protected void validateEntity() {
     
        super.validateEntity();
      
            
     
    }

    /**Gets the associated entity oracle.jbo.RowIterator
     */
    public RowIterator getSisAsignacionNumCheque() {
        return (RowIterator)getAttributeInternal(SISASIGNACIONNUMCHEQUE);
    }

    /**Gets the attribute value for FechaRef, using the alias name FechaRef
     */
    public Date getFechaRef() {
        return (Date)getAttributeInternal(FECHAREF);
    }

    /**Sets <code>value</code> as the attribute value for FechaRef
     */
    public void setFechaRef(Date value) {
        setAttributeInternal(FECHAREF, value);
    }

    /**Gets the attribute value for Creadopor, using the alias name Creadopor
     */
    public String getCreadopor() {
        return (String)getAttributeInternal(CREADOPOR);
    }

    /**Sets <code>value</code> as the attribute value for Creadopor
     */
    public void setCreadopor(String value) {
        setAttributeInternal(CREADOPOR, value);
    }



    /**Validation method for FechaRef
     */
    public boolean validateFechaRef(Date  data) {
       boolean vResultado;
       
        vResultado=true;
       if (this.getoperacion()!=null && this.getoperacion().equals("PAGO")){
           if (!this.validateFecha(data)){
               vResultado=false;
           }
       }
        return vResultado;
    }

    /**Creates a Key object based on given key constituents
     */
    public static Key createPrimaryKey(Number idProceso) {
        return new Key(new Object[]{idProceso});
    }
}
