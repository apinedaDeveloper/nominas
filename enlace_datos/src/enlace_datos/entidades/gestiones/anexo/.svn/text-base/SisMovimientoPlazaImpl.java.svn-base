package enlace_datos.entidades.gestiones.anexo;

import enlace_datos.myException;

import enlace_datos.util.myEntityImpl;
import enlace_datos.util.resulOp;
import enlace_datos.util.utils;
import enlace_datos.util.utils_DB;

import java.text.SimpleDateFormat;

import oracle.jbo.AttributeList;
import oracle.jbo.JboException;
import oracle.jbo.Key;
import oracle.jbo.NameValuePairs;
import oracle.jbo.domain.DBSequence;
import oracle.jbo.domain.Date;
import oracle.jbo.domain.Number;
import oracle.jbo.server.AttributeDefImpl;
import oracle.jbo.server.EntityDefImpl;
import oracle.jbo.server.EntityImpl;
import oracle.jbo.server.SequenceImpl;
import oracle.jbo.server.TransactionEvent;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class SisMovimientoPlazaImpl extends myEntityImpl {
    public static final int IDMOVIMIENTOPLAZA = 0;
    public static final int OPERACION = 1;
    public static final int IDPARTIDA = 2;
    public static final int IDPUESTO = 3;
    public static final int NUMEROPLAZA = 4;
    public static final int CORRELATIVO = 5;
    public static final int CANTIDADHORAS = 6;
    public static final int FECHAINICIO = 7;
    public static final int FECHAFIN = 8;
    public static final int SUELDOBASE = 9;
    public static final int ESCALAFON = 10;
    public static final int COMPLSALARIAL = 11;
    public static final int IDANEXO = 12;
    public static final int TOTALSUELDO = 13;
    public static final int VACACIONES = 14;
    public static final int AGUINALDO = 15;
    public static final int BONO14 = 16;
    public static final int DIFERIDO50 = 17;
    public static final int DIFERIDO = 18;
    public static final int PERIODOPLAZA = 19;
    public static final int TOTALESCALAFON = 20;
    public static final int TOTALCOMSALARIAL = 21;
    public static final int DICTAMEN = 22;
    public static final int NOMPLAZA = 23;
    public static final int IDPROMOCION = 24;
    public static final int REGISTROEMPLEADO = 25;
    public static final int FACTIEMPO = 26;
    public static final int NUMERO = 27;
    public static final int ANIO = 28;
    public static final int IDPUESTOESCALA = 29;
    public static final int IDPARTIDASICOIN = 30;
    public static final int SISANEXO = 31;
    private static EntityDefImpl mDefinitionObject;

    /**This is the default constructor (do not remove)
     */
    public SisMovimientoPlazaImpl() {
    }


    /**Retrieves the definition object for this instance class.
     */
    public static synchronized EntityDefImpl getDefinitionObject() {
        if (mDefinitionObject == null) {
            mDefinitionObject = (EntityDefImpl)EntityDefImpl.findDefObject("enlace_datos.entidades.gestiones.anexo.SisMovimientoPlaza");
        }
        return mDefinitionObject;
    }

    /**Gets the attribute value for IdMovimientoPlaza, using the alias name IdMovimientoPlaza
     */
    public Number getIdMovimientoPlaza() {
        return (Number)getAttributeInternal(IDMOVIMIENTOPLAZA);
    }

    /**Sets <code>value</code> as the attribute value for IdMovimientoPlaza
     */
    public void setIdMovimientoPlaza(Number value) {
        setAttributeInternal(IDMOVIMIENTOPLAZA, value);
    }

    /**Gets the attribute value for Operacion, using the alias name Operacion
     */
    public String getOperacion() {
        return (String)getAttributeInternal(OPERACION);
    }

    /**Sets <code>value</code> as the attribute value for Operacion
     */
    public void setOperacion(String value) {
        setAttributeInternal(OPERACION, value);
    }

    /**Gets the attribute value for IdPartida, using the alias name IdPartida
     */
    public Number getIdPartida() {
        return (Number)getAttributeInternal(IDPARTIDA);
    }

    /**Sets <code>value</code> as the attribute value for IdPartida
     */
    public void setIdPartida(Number value) {
        setAttributeInternal(IDPARTIDA, value);
    }

    /**Gets the attribute value for IdPuesto, using the alias name IdPuesto
     */
    public Number getIdPuesto() {
        return (Number)getAttributeInternal(IDPUESTO);
    }

    /**Sets <code>value</code> as the attribute value for IdPuesto
     */
    public void setIdPuesto(Number value) {
        setAttributeInternal(IDPUESTO, value);
    }

    /**Gets the attribute value for NumeroPlaza, using the alias name NumeroPlaza
     */
    public Number getNumeroPlaza() {
        return (Number)getAttributeInternal(NUMEROPLAZA);
    }

    /**Sets <code>value</code> as the attribute value for NumeroPlaza
     */
    public void setNumeroPlaza(Number value) {
     // Number vValor;
        if (this.getOperacion()!=null || this.getOperacion().equals("B")){
           // vValor=value;
            setAttributeInternal(NUMEROPLAZA,value);
        }
       // setAttributeInternal(NUMEROPLAZA, value);
    }

    /**Gets the attribute value for Correlativo, using the alias name Correlativo
     */
    public Number getCorrelativo() {
        return (Number)getAttributeInternal(CORRELATIVO);
    }

    /**Sets <code>value</code> as the attribute value for Correlativo
     */
    public void setCorrelativo(Number value) {
       /* Number vValor;
        if (this.getOperacion()==null || this.getOperacion().equals("A")){
            vValor=null;
        }else {
            vValor=value;
        }*/
        setAttributeInternal(CORRELATIVO, value);
    }


    /**Gets the attribute value for CantidadHoras, using the alias name CantidadHoras
     */
    public Number getCantidadHoras() {
        return (Number)getAttributeInternal(CANTIDADHORAS);
    }

    /**Sets <code>value</code> as the attribute value for CantidadHoras
     */
    public void setCantidadHoras(Number value) {
      /*  Number vValor;
        if (this.getOperacion()==null || this.getOperacion().equals("A")){
            vValor=null;
        }else {
            vValor=value;
        }*/
        setAttributeInternal(CANTIDADHORAS, value);
    }

    /**Gets the attribute value for FechaInicio, using the alias name FechaInicio
     */
    public Date getFechaInicio() {
        return (Date)getAttributeInternal(FECHAINICIO);
    }

    /**Sets <code>value</code> as the attribute value for FechaInicio
     */
    public void setFechaInicio(Date value) {
        setAttributeInternal(FECHAINICIO, value);
    }

    /**Gets the attribute value for FechaFin, using the alias name FechaFin
     */
    public Date getFechaFin() {
        return (Date)getAttributeInternal(FECHAFIN);
    }

    /**Sets <code>value</code> as the attribute value for FechaFin
     */
    public void setFechaFin(Date value) {
        setAttributeInternal(FECHAFIN, value);
    }

    /**Gets the attribute value for SueldoBase, using the alias name SueldoBase
     */
    public Number getSueldoBase() {
        return (Number)getAttributeInternal(SUELDOBASE);
    }

    /**Sets <code>value</code> as the attribute value for SueldoBase
     */
    public void setSueldoBase(Number value) {
     /*  Number vValor;
       if (this.getOperacion()==null || this.getOperacion().equals("A")){
           vValor=null;
       }else {
           vValor=value;
       }*/
        setAttributeInternal(SUELDOBASE, value);
    }

    /**Gets the attribute value for Escalafon, using the alias name Escalafon
     */
    public Number getEscalafon() {
        return (Number)getAttributeInternal(ESCALAFON);
    }

    /**Sets <code>value</code> as the attribute value for Escalafon
     */
    public void setEscalafon(Number value) {
    
      /*  Number vValor;
        if (this.getOperacion()==null || this.getOperacion().equals("A")){
            vValor=null;
        }else {
            vValor=value;
        }
*/        setAttributeInternal(ESCALAFON, value);
    }

    /**Gets the attribute value for ComplSalarial, using the alias name ComplSalarial
     */
    public Number getComplSalarial() {
        return (Number)getAttributeInternal(COMPLSALARIAL);
    }

    /**Sets <code>value</code> as the attribute value for ComplSalarial
     */
    public void setComplSalarial(Number value) {
        /*Number vValor;
        if (this.getOperacion()==null || this.getOperacion().equals("A")){
            vValor=null;
        }else {
            vValor=value;
        }*/
        setAttributeInternal(COMPLSALARIAL, value);
    }

    /**Gets the attribute value for IdAnexo, using the alias name IdAnexo
     */
    public Number getIdAnexo() {
        return (Number)getAttributeInternal(IDANEXO);
    }

    /**Sets <code>value</code> as the attribute value for IdAnexo
     */
    public void setIdAnexo(Number value) {
        setAttributeInternal(IDANEXO, value);
    }

    /**Gets the attribute value for TotalSueldo, using the alias name TotalSueldo
     */
    public Number getTotalSueldo() {
        return (Number)getAttributeInternal(TOTALSUELDO);
    }

    /**Sets <code>value</code> as the attribute value for TotalSueldo
     */
    public void setTotalSueldo(Number value) {
        setAttributeInternal(TOTALSUELDO, value);
    }

    /**Gets the attribute value for Vacaciones, using the alias name Vacaciones
     */
    public Number getVacaciones() {
        return (Number)getAttributeInternal(VACACIONES);
    }

    /**Sets <code>value</code> as the attribute value for Vacaciones
     */
    public void setVacaciones(Number value) {
        setAttributeInternal(VACACIONES, value);
    }

    /**Gets the attribute value for Aguinaldo, using the alias name Aguinaldo
     */
    public Number getAguinaldo() {
        return (Number)getAttributeInternal(AGUINALDO);
    }

    /**Sets <code>value</code> as the attribute value for Aguinaldo
     */
    public void setAguinaldo(Number value) {
        setAttributeInternal(AGUINALDO, value);
    }

    /**Gets the attribute value for Bono14, using the alias name Bono14
     */
    public Number getBono14() {
        return (Number)getAttributeInternal(BONO14);
    }

    /**Sets <code>value</code> as the attribute value for Bono14
     */
    public void setBono14(Number value) {
        setAttributeInternal(BONO14, value);
    }

    /**Gets the attribute value for Diferido50, using the alias name Diferido50
     */
    public Number getDiferido50() {
        return (Number)getAttributeInternal(DIFERIDO50);
    }

    /**Sets <code>value</code> as the attribute value for Diferido50
     */
    public void setDiferido50(Number value) {
        setAttributeInternal(DIFERIDO50, value);
    }

    /**Gets the attribute value for Diferido, using the alias name Diferido
     */
    public Number getDiferido() {
        return (Number)getAttributeInternal(DIFERIDO);
    }

    /**Sets <code>value</code> as the attribute value for Diferido
     */
    public void setDiferido(Number value) {
        setAttributeInternal(DIFERIDO, value);
    }

    /**getAttrInvokeAccessor: generated method. Do not modify.
     */
    protected Object getAttrInvokeAccessor(int index, 
                                           AttributeDefImpl attrDef) throws Exception {
        switch (index) {
        case IDMOVIMIENTOPLAZA:
            return getIdMovimientoPlaza();
        case OPERACION:
            return getOperacion();
        case IDPARTIDA:
            return getIdPartida();
        case IDPUESTO:
            return getIdPuesto();
        case NUMEROPLAZA:
            return getNumeroPlaza();
        case CORRELATIVO:
            return getCorrelativo();
        case CANTIDADHORAS:
            return getCantidadHoras();
        case FECHAINICIO:
            return getFechaInicio();
        case FECHAFIN:
            return getFechaFin();
        case SUELDOBASE:
            return getSueldoBase();
        case ESCALAFON:
            return getEscalafon();
        case COMPLSALARIAL:
            return getComplSalarial();
        case IDANEXO:
            return getIdAnexo();
        case TOTALSUELDO:
            return getTotalSueldo();
        case VACACIONES:
            return getVacaciones();
        case AGUINALDO:
            return getAguinaldo();
        case BONO14:
            return getBono14();
        case DIFERIDO50:
            return getDiferido50();
        case DIFERIDO:
            return getDiferido();
        case PERIODOPLAZA:
            return getPeriodoPlaza();
        case TOTALESCALAFON:
            return getTotalEscalafon();
        case TOTALCOMSALARIAL:
            return getTotalComsalarial();
        case DICTAMEN:
            return getDictamen();
        case NOMPLAZA:
            return getNomplaza();
        case IDPROMOCION:
            return getidPromocion();
        case REGISTROEMPLEADO:
            return getRegistroEmpleado();
        case FACTIEMPO:
            return getFacTiempo();
        case NUMERO:
            return getNumero();
        case ANIO:
            return getAnio();
        case IDPUESTOESCALA:
            return getIdPuestoEscala();
        case IDPARTIDASICOIN:
            return getIdPartidaSicoin();
        case SISANEXO:
            return getSisAnexo();
        default:
            return super.getAttrInvokeAccessor(index, attrDef);
        }
    }

    /**setAttrInvokeAccessor: generated method. Do not modify.
     */
    protected void setAttrInvokeAccessor(int index, Object value, 
                                         AttributeDefImpl attrDef) throws Exception {
        switch (index) {
        case IDMOVIMIENTOPLAZA:
            setIdMovimientoPlaza((Number)value);
            return;
        case OPERACION:
            setOperacion((String)value);
            return;
        case IDPARTIDA:
            setIdPartida((Number)value);
            return;
        case IDPUESTO:
            setIdPuesto((Number)value);
            return;
        case NUMEROPLAZA:
            setNumeroPlaza((Number)value);
            return;
        case CORRELATIVO:
            setCorrelativo((Number)value);
            return;
        case CANTIDADHORAS:
            setCantidadHoras((Number)value);
            return;
        case FECHAINICIO:
            setFechaInicio((Date)value);
            return;
        case FECHAFIN:
            setFechaFin((Date)value);
            return;
        case SUELDOBASE:
            setSueldoBase((Number)value);
            return;
        case ESCALAFON:
            setEscalafon((Number)value);
            return;
        case COMPLSALARIAL:
            setComplSalarial((Number)value);
            return;
        case IDANEXO:
            setIdAnexo((Number)value);
            return;
        case TOTALSUELDO:
            setTotalSueldo((Number)value);
            return;
        case VACACIONES:
            setVacaciones((Number)value);
            return;
        case AGUINALDO:
            setAguinaldo((Number)value);
            return;
        case BONO14:
            setBono14((Number)value);
            return;
        case DIFERIDO50:
            setDiferido50((Number)value);
            return;
        case DIFERIDO:
            setDiferido((Number)value);
            return;
        case PERIODOPLAZA:
            setPeriodoPlaza((String)value);
            return;
        case TOTALESCALAFON:
            setTotalEscalafon((Number)value);
            return;
        case TOTALCOMSALARIAL:
            setTotalComsalarial((Number)value);
            return;
        case DICTAMEN:
            setDictamen((String)value);
            return;
        case NOMPLAZA:
            setNomplaza((String)value);
            return;
        case IDPROMOCION:
            setidPromocion((Number)value);
            return;
        case REGISTROEMPLEADO:
            setRegistroEmpleado((Number)value);
            return;
        case FACTIEMPO:
            setFacTiempo((Number)value);
            return;
        case NUMERO:
            setNumero((Number)value);
            return;
        case ANIO:
            setAnio((Number)value);
            return;
        case IDPUESTOESCALA:
            setIdPuestoEscala((Number)value);
            return;
        case IDPARTIDASICOIN:
            setIdPartidaSicoin((Number)value);
            return;
        default:
            super.setAttrInvokeAccessor(index, value, attrDef);
            return;
        }
    }

    /**Gets the associated entity SisAnexoImpl
     */
    public SisAnexoImpl getSisAnexo() {
        return (SisAnexoImpl)getAttributeInternal(SISANEXO);
    }

    /**Sets <code>value</code> as the associated entity SisAnexoImpl
     */
    public void setSisAnexo(SisAnexoImpl value) {
        setAttributeInternal(SISANEXO, value);
    }

    /**Add locking logic here.
     */
    public void lock() {
        super.lock();
    }

    /**Custom DML update/insert/delete logic here.
     */
    protected void doDML(int operation, TransactionEvent e) {
        
    if (this.getEscalafon()==null){
        
        this.setEscalafon(new Number(0));
    }
    
    if (this.getComplSalarial()==null){
        
        this.setComplSalarial(new Number(0));
    }
        
        
    if (operation==DML_INSERT){  
           
        SequenceImpl sequence = new SequenceImpl("SIS_MOVIMIENTOPLAZA_SQ",e.getDBTransaction());
        //this.setIdMovimientoPlaza(sequence.getSequenceNumber());
        this.setIdMovimientoPlaza(sequence.getSequenceNumber());
               // this.setIdMovimientoPlaza(sequence.getSequenceNumber());
                
                //System.out.println("toy con el hijo");
                //System.out.println("plaza"+" "+ this.getSisAnexo());
                //System.out.println("movimiento" + this.getIdMovimientoPlaza());
                // this.setIdAnexo(this.getSisAnexo().getIdAnexo());
               
                //Object cadena = this.getSisAnexo();
              //  int numanexo = Integer.parseInt(cadena.trim());
            //    this.setIdAnexo(numanexo);
             //this.setOperacion("A");
             
             
       // ***********la plaza se bajara para ampliacion de horario*****************
       if (this.getOperacion().equals("B")&& this.getDictamen()!= null){ // la plaza se bajara para ampliacion de horario
            String consulta1 = "select to_char(dic.FECHA_INICIO,'dd/mm/yyyy') as fecha_inicio from sis_dictamen_detalle dic where dic.EMITIDO_POR =  '" + this.getDictamen() + "' and dic.NUMERO =  " 
            +this.getNumero() +"  and dic.ANIO =  " + this.getAnio()+ " and dic.ID_PARTIDA =  "
            + this.getIdPartida()+ " and dic.ID_PUESTO = " +this.getIdPuesto()+ " and dic.tipo_operacion = 'A'" ;
        
            Object fechaDictamen = utils_DB.getEjecutarQuerry(this.getDBTransaction(),consulta1);
           
            //Date fechInicio = utils.getFechaOracle(this.fecha_inicio.getValue().toString());
            
             //verificamos que hayan ingresado un registro.
             if (this.getRegistroEmpleado() == null || this.getRegistroEmpleado().equals(" ")){//verificamos que hayan ingresado el registro del empleado quien tiene actualmente la plaza
                 throw new JboException ("La plaza se bajará por ampliación de horario  EN EL ID_MOVIMIENTO_PLAZA No. "+ this.getIdMovimientoPlaza()+ " , debe ingresar el registro del empleado que tiene actualmente la plaza");
                 
             }
             else{//buscamos si el registro de empleado ingresado esta contratado en la plaza que se ampliará
                 consulta1 = "select mov.registro_empleado from sis_contrato mov"
                 +" where  mov.ID_PARTIDA =  "+ this.getIdPartida()+"  and mov.ID_PUESTO = "+this.getIdPuesto()
                  +" and mov.NUMERO_PLAZA = "+ this.getNumeroPlaza()
                 +" and to_date(' "+ utils.getFechaFormato("dd/MM/yyyy",this.getFechaInicio())+" ','dd/MM/yyyy') between mov.FECHA_INICIO and mov.FECHA_FIN";
                  
                  
                  Object existRegistro = utils_DB.getEjecutarQuerry(this.getDBTransaction(),consulta1);
                  if(existRegistro == null || existRegistro.equals(" ")){// el registro no esta contratado en la plaza a bajar
                      throw new JboException("El registro de empleado que ingresó no esta contratado en la plaza que esta bajando por ampliación de horario " + " , VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No. "+ this.getIdMovimientoPlaza());
                      
                  }
                 
             }//Fin verificacion del registro
         
            if (fechaDictamen == null || fechaDictamen.equals(" ")){
                throw new JboException("La plaza se bajará por ampliación de horario y los datos en el dictamen son incorrectos, verifiquelos  ID_MOVIMIENTO_PLAZA No. "+ this.getIdMovimientoPlaza());
            
            } 
            else{// existe la plaza para ampliacion de horario en el dictamen..
           
                //Consultamos para ver si ya existe una baja por ampliacion de horario
                consulta1 = "select mov.ID_ANEXO from sis_anexo an, sis_movimiento_plaza mov, sis_estado estado"
                +" where an.ID_ANEXO = mov.ID_ANEXO and an.ESTATUS = estado.ID_ESTADO and estado.nombre != 'ANULADO'"
                 +"and mov.ID_PARTIDA =  "+ this.getIdPartida()+"  and mov.ID_PUESTO = "+this.getIdPuesto()
                +" and mov.CORRELATIVO = "+this.getCorrelativo()+" and mov.NUMERO_PLAZA = "+this.getNumeroPlaza()
                + " and mov.operacion = 'B' and mov.dictamen is not null and mov.numero is not null";
               
                Object auxAnexo = utils_DB.getEjecutarQuerry(this.getDBTransaction(),consulta1); 
                Date fechDictamen = utils.getFechaOracle(fechaDictamen.toString());
                if (auxAnexo != null){//existe una baja por ampliacion de horario 
                    throw new JboException("No se puede bajar la plaza en ID_MOVIMIENTO_PLAZA No. "+ this.getIdMovimientoPlaza()+" , debido a que ya fue bajada para Ampliacion de horario, CONSULTE EL ANEXO No. "+auxAnexo);
                   
                }
        
                else if(fechDictamen.compareTo((Date)this.getFechaInicio()) > 0){
                    throw new JboException ("La Fecha de inicio a bajar es incorrecta, la fecha para ampliación de horario segun  dictamen es:  "+fechaDictamen + " , VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No. "+ this.getIdMovimientoPlaza());
            
                }    
            }
       }
             
             //Si el anexo no es para promocion o reclasificacion entonces se haran las validaciones de lo contrario no se haran.
       else if (this.getSisAnexo().getIdTipoMovPlaza().intValue()!= 5 && this.getSisAnexo().getIdTipoMovPlaza().intValue() != 6){
                    //consulta utilizada para verificar que la plaza a bajar no este contenida en otro anexo.
            String consulta = "select a.id_anexo from sis_anexo a, sis_movimiento_plaza m, sis_estado e where a.ID_ANEXO = m.ID_ANEXO and m.ID_PARTIDA = " + this.getIdPartida()
            +" and m.ID_PUESTO = "+ this.getIdPuesto() +"and m.NUMERO_PLAZA = "+ this.getNumeroPlaza() +" and m.CORRELATIVO = "+this.getCorrelativo()
            + " and  to_date("+"'"+ utils.getFechaFormato("dd/MM/yyyy",this.getFechaInicio())+"'"+",'dd/MM/yyyy') between m.FECHA_INICIO and m.FECHA_FIN "
            + "and a.ESTATUS = e.ID_ESTADO and (e.NOMBRE ='OBJETADO' OR e.NOMBRE = 'INGRESADO' or e.NOMBRE ='AUTORIZADO' OR e.NOMBRE = 'TRASLADADO') and m.operacion = 'B' and id_aumento_salarial is null  " 
            + " m.dictamen is null and m.numero is null and m.anio is null and rownum = 1";
              
            Object cadFecha = utils_DB.getEjecutarQuerry(this.getDBTransaction(),consulta);
                    //System.out.println("para que pare la insercion de anexo");
            if (cadFecha != null && this.getOperacion().equals("B")) {
                throw new JboException("NO SE PUEDE BAJAR LA PLAZA, EL RANGO DE FECHAS ES INVALIDO: ID_MOVIMIENTO_PLAZA No. "+ this.getIdMovimientoPlaza()+" , CONSULTE EL ANEXO No. "+cadFecha);
                }
              
            if (this.getOperacion().equals("B")){
                        //consulta que busca si la plaza a bajar contiene una licencia parcial
                consulta = "select det.HORAS_BAJA from sis_solicitud s, sis_det_licencia det, sis_estado_solicitud_vw est, sis_contrato cont "
                + " where s.ID_SOLICITUD = det.ID_SOLICITUD  and s.ID_ESTADO = est.ID_ESTADO and est.NOMBRE = 'AUTORIZADO'"
                +" and s.ID_CONTRATO = cont.ID_CONTRATO"
                +" and cont.ID_PARTIDA = " +this.getIdPartida()
                +" and cont.NUMERO_PLAZA = " +this.getNumeroPlaza()
                + " and cont.ID_PUESTO = " +this.getIdPuesto()
                +" and cont.CORRELATIVO = to_number(to_char(sysdate,'yyyy'))"
                +" and to_date('"+ utils.getFechaFormato("dd/MM/yyyy", this.getFechaInicio())+" ','dd/mm/yyyy') between det.FECHA_INICIO and det.FECHA_FIN";  //buscando licencias parciales sobre la baja
                cadFecha = utils_DB.getEjecutarQuerry(this.getDBTransaction(),consulta);
                            
                consulta = "select to_char(mov.FECHA_INICIO,'dd/mm/yyyy') from sis_movimiento_plaza mov, sis_anexo an, sis_estado est " + 
                " where mov.ID_ANEXO = an.ID_ANEXO" + 
                " and an.ESTATUS = est.ID_ESTADO" + 
                " AND est.NOMBRE = 'AUTORIZADO'" + 
                " and mov.ID_PARTIDA = " +this.getIdPartida() +
                " and mov.CORRELATIVO = to_number(to_char(sysdate,'yyyy'))" + 
                " and mov.ID_PUESTO = "+this.getIdPuesto() + 
                " and mov.NUMERO_PLAZA = " +this.getNumeroPlaza()+
                " AND AN.ID_TIPO_MOV_PLAZA IN (5,6)";
                                
                Object fechaPromo = utils_DB.getEjecutarQuerry(this.getDBTransaction(),consulta);
                            
                               
                if (fechaPromo != null){ //a plaza fue promovida o reclasificada
                    
                    consulta = " select MOV.SUELDO_BASE from sis_movimiento_plaza mov, sis_anexo anexo, sis_estado estado" + 
                    " where mov.ID_ANEXO = anexo.ID_ANEXO and anexo.ESTATUS = estado.ID_ESTADO" + 
                    " and estado.NOMBRE = 'AUTORIZADO'" + 
                    " and mov.ID_PARTIDA = " +this.getIdPartida() +" and mov.NUMERO_PLAZA = " +this.getNumeroPlaza()
                    +" and mov.CORRELATIVO = to_number(to_char(sysdate,'yyyy'))" 
                    +" and to_date(' " +utils.getFechaFormato("dd/MM/yyyy",this.getFechaInicio())+"  ','dd/mm/yyyy') between mov.FECHA_INICIO and mov.FECHA_FIN\n" + 
                    " and mov.ID_PUESTO != " +this.getIdPuesto() + 
                    " and anexo.ID_TIPO_MOV_PLAZA != 5 and anexo.ID_TIPO_MOV_PLAZA != 6";
                    Object varSueldo = utils_DB.getEjecutarQuerry(this.getDBTransaction(),consulta);
                                
                    consulta = " select to_char(MOV.fecha_fin,'dd/mm/yyyy') from sis_movimiento_plaza mov, sis_anexo anexo, sis_estado estado" + 
                    " where mov.ID_ANEXO = anexo.ID_ANEXO and anexo.ESTATUS = estado.ID_ESTADO" + 
                    " and estado.NOMBRE = 'AUTORIZADO'" + 
                    " and mov.ID_PARTIDA = " +this.getIdPartida() +" and mov.NUMERO_PLAZA = " +this.getNumeroPlaza()
                    +" and mov.CORRELATIVO = to_number(to_char(sysdate,'yyyy'))" 
                    +" and ( to_date('"+utils.getFechaFormato("dd/MM/yyyy", this.getFechaInicio())+" ','dd/mm/yyyy') between mov.FECHA_INICIO and mov.FECHA_FIN" + 
                    " or to_date('"+utils.getFechaFormato("dd/MM/yyyy", this.getFechaFin())+" ','dd/mm/yyyy') between mov.FECHA_INICIO and mov.FECHA_FIN )" + 
                    " and mov.ID_PUESTO != " +this.getIdPuesto() + 
                    " and anexo.ID_TIPO_MOV_PLAZA != 5 and anexo.ID_TIPO_MOV_PLAZA != 6";
                    Object finAnexo = utils_DB.getEjecutarQuerry(this.getDBTransaction(),consulta);
                          
                    Date inicioPromo = utils.getFechaOracle("dd/MM/yyyy",fechaPromo.toString().trim());
                    
                    Integer temporal = inicioPromo.compareTo(utils.getFechaOracle("dd/MM/yyyy",utils.getFechaFormato("dd/MM/yyyy", this.getFechaInicio()))); 
                    //Date temp = utils.getFechaOracle("dd/mm/yyyy",utils.getFechaFormato("dd/MM/yyyy", this.getFechaInicio()));
                   
                    if ( inicioPromo.compareTo(utils.getFechaOracle("dd/MM/yyyy",utils.getFechaFormato("dd/MM/yyyy", this.getFechaInicio())))<= 0 ){//fecha de inicio esta dentro de la promocion o reclasificacion
                        if (varSueldo != null){//la plaza se promovio o reclasifico pero  habia sido bajada antes.
                           // if (finAnexo != null){
                                Date finBaja = utils.getFechaOracle("dd/MM/yyyy",finAnexo.toString().trim());
                            //}
                                if (finBaja.compareTo(utils.getFechaOracle("dd/MM/yyyy",utils.getFechaFormato("dd/MM/yyyy", this.getFechaFin())))>= 0){//el periodo a bajar esta dentro de la baja antes de la promocion
                                    Double sueldoAnexo = new Double(varSueldo.toString().trim());  
                                    if(sueldoAnexo > 0) {
                                        if (cadFecha != null){// la plaza a bajar tiene una licencia
                                            Double hrParciales = new Double(cadFecha.toString().trim());
                                    
                                            if (hrParciales >0){//la plaza la bajaron con horas parciales
                                                Number sueldo;
                                                sueldo = this.getSueldoBase().divide(this.getCantidadHoras());
                                                sueldo = sueldo.multiply(hrParciales.doubleValue());
                                                //sueldo = utils.getNumberOracle((sueldo.doubleValue() - sueldoAnexo.doubleValue()));
                                                this.setCantidadHoras(utils.getNumberOracle(hrParciales.doubleValue()));
                                                this.setSueldoBase(sueldo);
                                            
                                            } 
                                            /*
                                            else {// por aquelllo de que agarre basura....jejeje
                                                                                 
                                                sueldoAnexo = this.getSueldoBase().doubleValue()- sueldoAnexo.doubleValue() ;
                                                this.setSueldoBase( utils.getNumberOracle(sueldoAnexo.doubleValue())) ;   
                                            }
                                            */
                                        }//fin bajas parciales
                                        
                                        /*
                                        else {//la plaza no tiene bajas parciales
                                            sueldoAnexo = this.getSueldoBase().doubleValue()- sueldoAnexo.doubleValue() ;
                                            this.setSueldoBase( utils.getNumberOracle(sueldoAnexo)); 
                                        
                                        }// fin else bajas parciales  
                                        */
                                        
                                    }
                                    else {//por aquello que agarre basura jejejejeje
                                        if (cadFecha != null){// la plaza a bajar tiene una licencia
                                            Double hrParciales = new Double(cadFecha.toString().trim());
                                    
                                            if (hrParciales >0){//la plaza la bajaron con horas parciales
                                                Number sueldo;
                                                sueldo = this.getSueldoBase().divide(this.getCantidadHoras());
                                                sueldo = sueldo.multiply(hrParciales.doubleValue());
                                                this.setCantidadHoras(utils.getNumberOracle(hrParciales.doubleValue()));
                                                this.setSueldoBase(sueldo);
                                            }
                                        }//fin bajas parciales
                                        }
                            
                                    
                                }else {
                                
                                    throw new JboException("NO SE PUEDE BAJAR LA PLAZA PORQUE FUE BAJADA Y LUEGO PROMOVIDA, EL RANGO DE FECHAS ES INVALIDO." +
                                    " SI DESEA UTILIZAR LA DIFERENCIA ENTRE EL PUESTO ANTERIOR Y EL ACTUAL UTILICE UN PERIODO DENTRO DEL RANGO DEL  "+utils.getFechaFormato("dd/MM/yyyy",inicioPromo.getValue())+ "  AL  "+utils.getFechaFormato("dd/MM/yyyy", finBaja.getValue())
                                    + " , VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No. "+ this.getIdMovimientoPlaza());
                                    /*  if (cadFecha != null){// la plaza a bajar tiene una licencia
                                         Double hrParciales = new Double(cadFecha.toString().trim());
                                     
                                         if (hrParciales >0){//la plaza la bajaron con horas parciales
                                             Number sueldo;
                                             sueldo = this.getSueldoBase().divide(this.getCantidadHoras());
                                             sueldo = sueldo.multiply(hrParciales.doubleValue());
                                             this.setCantidadHoras(utils.getNumberOracle(hrParciales.doubleValue()));
                                             this.setSueldoBase(sueldo);
                                         }
                                     }//fin bajas parciales */
                                
                                
                                }// fin else de las fechas de promocion o reclasificacion
                            }//fin varsueldo != null
                            else {// la plaza antigua no fue bajada en el periodo seleccionado
                                         if (cadFecha != null){// la plaza a bajar tiene una licencia
                                         Double hrParciales = new Double(cadFecha.toString().trim());
                                                                 
                                                if (hrParciales >0){//la plaza la bajaron con horas parciales
                                                    Number sueldo;
                                                    sueldo = this.getSueldoBase().divide(this.getCantidadHoras());
                                                    sueldo = sueldo.multiply(hrParciales.doubleValue());
                                                    this.setCantidadHoras(utils.getNumberOracle(hrParciales.doubleValue()));
                                                    this.setSueldoBase(sueldo);
                                                }
                                          }//fin bajas parciales  
                            }
                            }// fin fecha inicio
                            else {// la plaza fue promovida o reclasificada y se esta bajando con una fecha antes de su promocion
                                throw new JboException("EL RANGO DE FECHAS ES INVALIDO DEBIDO A QUE FUE PROMOVIDA O RECLASIFICADA, LA FECHA DE INICIO DEBE SER IGUAL O MAYOR AL  "+utils.getFechaFormato("dd/MM/yyyy", inicioPromo.getValue())+ " , VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No. "+ this.getIdMovimientoPlaza());     
                            }
                            }//fin if verificacion que si tubo una promocion o reclasificacion
                            else{ // la plaza no fue promovida ni reclasificada
                                    if (cadFecha != null){// la plaza a bajar tiene una licencia
                                        Double hrParciales = new Double(cadFecha.toString().trim());
                                                     
                                         if (hrParciales >0){//la plaza la bajaron con horas parciales
                                            Number sueldo;
                                            sueldo = this.getSueldoBase().divide(this.getCantidadHoras());
                                            sueldo = sueldo.multiply(hrParciales.doubleValue());
                                            this.setCantidadHoras(utils.getNumberOracle(hrParciales.doubleValue()));
                                            this.setSueldoBase(sueldo);
                                         }
                                     }//fin bajas parciales  
                                
                            }
                                
                            } // fin operacion bajas                        
                            
                        }// fin de la verificacion
             
                         if (this.getOperacion().equals("B")){ // la plaza se bajara , buscar partida_sicoin para que se inserte en sis_movimiento_plaza
                                     String consulta1 = "select id_partida_sicoin from sis_plaza where id_partida = " + this.getIdPartida() + " and id_puesto =  " 
                                     + this.getIdPuesto() + " and correlativo = "+this.getCorrelativo()+" and numero_plaza = "+ this.getNumeroPlaza();
                                  
                                     Object id = utils_DB.getEjecutarQuerry(this.getDBTransaction(),consulta1);
                                     if (id != null){
                                         Number idsicoin = utils.getNumberOracle(id);
                                         this.setIdPartidaSicoin(idsicoin);
                                     }            
                         }
        }/*
              NameValuePairs parametros;//parametros que serviran para llamar la funcion del periodo disponible de la plaza
              parametros = new NameValuePairs();
              parametros.setAttribute("1",this.getIdPartida());
              parametros.setAttribute("2",this.getIdPuesto());
              parametros.setAttribute("3",this.getNumeroPlaza());
              parametros.setAttribute("4",this.getCorrelativo());
              Object cadFecha =  utils_DB.getValorFuncion(this.getDBTransaction(),"sis_pkg_util.GETPERIODOPLAZA(?,?,?,?)",parametros);
            String fechaplaza = cadFecha.toString().substring(0,10);
            //fechaplaza = fechaplaza.substring(0,10);
            String fechaplaza1 = cadFecha.toString().substring(11,21);
            String consulta = "select a.id_anexo from sis_anexo a, sis_movimiento_plaza m, sis_estado e where a.ID_ANEXO = m.ID_ANEXO and m.ID_PARTIDA = " + this.getIdPartida()
            +" and m.ID_PUESTO = :puesto and m.NUMERO_PLAZA = "+ this.getNumeroPlaza() +" and m.CORRELATIVO = "+this.getCorrelativo()
            + " and m.FECHA_FIN between to_date("+fechaplaza+",'dd/MM/yyyy') and to_date("+ fechaplaza1 + ",'dd/MM/yyyy')"
            + "and a.ESTATUS = e.ID_ESTADO and (e.NOMBRE ='OBJETADO' OR e.NOMBRE = 'INGRESADO' or e.NOMBRE ='AUTORIZADO' OR e.NOMBRE = 'TRASLADADO')";
        */
        
         
       
        
            
            
        //      super.doDML(operation, e);
        
        //capturando los mensajes desde la base de datos
        try { 
            validarForma();
            registrarLogOperaciones(operation, e); 
            super.doDML(operation, e);           
        
        }
       
        catch (Exception exep) {
           //exep.printStackTrace();
           throw new JboException("[Id:"+ this.getIdMovimientoPlaza()+"] "+   utils.getSQLMensaje(exep));
             
             //throw new myException(exep.getMessage());
             
        }
        //*/
    }

    /**Add attribute defaulting logic in this method.
     */
    protected void create(AttributeList attributeList) {
        super.create(attributeList);
        Number auxiliar  = new Number(System.currentTimeMillis()-9999999); 
             if (this.getidPromocion() != null){
                auxiliar = auxiliar.add(this.getidPromocion());
             }
       
        //System.out.println("puesto es:  "+this.getIdPuesto()+ "  auxiliar es: " + auxiliar);
        this.setIdMovimientoPlaza(auxiliar );
        
        //System.out.println("creacion " +this.getIdMovimientoPlaza());
        
        
        
    }

    /**Gets the attribute value for PeriodoPlaza, using the alias name PeriodoPlaza
     */
    public String getPeriodoPlaza() {
        return (String)getAttributeInternal(PERIODOPLAZA);
    }

    /**Sets <code>value</code> as the attribute value for PeriodoPlaza
     */
    public void setPeriodoPlaza(String value) {
        setAttributeInternal(PERIODOPLAZA, value);
    }

    //verifica que en el formulario del anexo no hayan campos vacios obligatorios.  
    public void validarForma(){
    
        if(this.getOperacion()==null){
            throw new JboException("RECUERDE QUE DEBE SELECCIONAR LA OPERACION A REALIZAR, VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No. "+ this.getIdMovimientoPlaza());
        }
        else {
            if(this.getOperacion().equals("A")){
                    if (this.getIdPartida() == null) {
                        throw new JboException("RECUERDE QUE DEBE SELECCIONAR UNA PARTIDA, VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No."+ this.getIdMovimientoPlaza());
                    }
                      
                    if (this.getIdPuesto() == null) {
                        throw new JboException("RECUERDE QUE DEBE SELECCIONAR UN PUESTO, VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No."+ this.getIdMovimientoPlaza());
                    }
        
                    if (this.getPeriodoPlaza() == null) {
                        throw new JboException("RECUERDE QUE DEBE SELECCIONAR EL REGIMEN DE LA UNIDAD,  VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No."+ this.getIdMovimientoPlaza());
                    }
        
                    if (this.getNumeroPlaza() == null) {
                        throw new JboException("RECUERDE QUE DEBE INGRESAR EL NUMERO DE PLAZA, VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No."+ this.getIdMovimientoPlaza());
                    }
                    if (this.getSueldoBase() == null){
                        throw new JboException("INGRESE EL SUELDO BASE O SELECCIONE UN PUESTO CON ESCALA DISTINTO A 0, VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No.  "+ this.getIdMovimientoPlaza());
                    }
        
                    if (this.getCantidadHoras() == null) {
                        throw new JboException("RECUERDE QUE DEBE INGRESAR EL NUMERO DE HORAS DE LA PLAZA,  VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No."+ this.getIdMovimientoPlaza());
                    }
                    SimpleDateFormat formato = new SimpleDateFormat("yyyy");
                    String cadena = formato.format(this.getFechaInicio().getValue());
                    if (this.getCorrelativo().compareTo(Integer.parseInt(cadena.trim()) )!=0){
                        throw new JboException("LA FECHA DE INICIO NO COINCIDE CON EL AÑO DE TRABAJO,  VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No."+ this.getIdMovimientoPlaza());
                    }
                     cadena = formato.format(this.getFechaFin().getValue());
                    if (this.getCorrelativo().compareTo(Integer.parseInt(cadena.trim()) )!=0){
                        throw new JboException("LA FECHA FIN NO COINCIDE CON EL AÑO DE TRABAJO,  VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No."+ this.getIdMovimientoPlaza());
                    }
                    
                    /*
                    if (this.getEscalafon() == null) {
                        throw new JboException("RECUERDE QUE DEBE INGRESAR EL ESCALAFON DE LA PLAZA");
                    }
                    if (this.getComplSalarial() == null) {
                        throw new JboException("RECUERDE QUE DEBE INGRESAR EL COMPLEMENTO SALARIAL");
                    }*/
       
            }
            else if(this.getOperacion().equals("B")){
                    if (this.getIdPartida() == null) {
                        throw new JboException("RECUERDE QUE DEBE SELECCIONAR UNA PARTIDA, VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No."+ this.getIdMovimientoPlaza());
                    }
                    if (this.getNumeroPlaza() == null) {
                        throw new JboException("RECUERDE QUE DEBE SELECCIONAR EL NUMERO DE PLAZA, VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No."+ this.getIdMovimientoPlaza());
                    }
            }
    
        }
    
        if (this.getFechaInicio() == null) {
            throw new JboException("RECUERDE QUE DEBE INGRESAR LA FECHA DE INICIO, VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No."+ this.getIdMovimientoPlaza());
        }
        if (this.getFechaFin() == null) {
            throw new JboException("RECUERDE QUE DEBE INGRESAR LA FECHA FINAL, VERIFIQUE EN EL ID_MOVIMIENTO_PLAZA No."+ this.getIdMovimientoPlaza());
        }
    }

    /**Gets the attribute value for TotalEscalafon, using the alias name TotalEscalafon
     */
    public Number getTotalEscalafon() {
        return (Number)getAttributeInternal(TOTALESCALAFON);
    }

    /**Sets <code>value</code> as the attribute value for TotalEscalafon
     */
    public void setTotalEscalafon(Number value) {
        setAttributeInternal(TOTALESCALAFON, value);
    }

    /**Gets the attribute value for TotalComsalarial, using the alias name TotalComsalarial
     */
    public Number getTotalComsalarial() {
        return (Number)getAttributeInternal(TOTALCOMSALARIAL);
    }

    /**Sets <code>value</code> as the attribute value for TotalComsalarial
     */
    public void setTotalComsalarial(Number value) {
        setAttributeInternal(TOTALCOMSALARIAL, value);
    }

    /**Gets the attribute value for Dictamen, using the alias name Dictamen
     */
    public String getDictamen() {
        return (String)getAttributeInternal(DICTAMEN);
    }

    /**Sets <code>value</code> as the attribute value for Dictamen
     */
    public void setDictamen(String value) {
        setAttributeInternal(DICTAMEN, value);
    }

    /**Gets the attribute value for Nomplaza, using the alias name Nomplaza
     */
    public String getNomplaza() {
        return (String)getAttributeInternal(NOMPLAZA);
    }

    /**Sets <code>value</code> as the attribute value for Nomplaza
     */
    public void setNomplaza(String value) {
        setAttributeInternal(NOMPLAZA, value);
    }

    /**Gets the attribute value for idPromocion, using the alias name idPromocion
     */
    public Number getidPromocion() {
        return (Number)getAttributeInternal(IDPROMOCION);
    }

    /**Sets <code>value</code> as the attribute value for idPromocion
     */
    public void setidPromocion(Number value) {
        setAttributeInternal(IDPROMOCION, value);
    }

    /**Gets the attribute value for RegistroEmpleado, using the alias name RegistroEmpleado
     */
    public Number getRegistroEmpleado() {
        return (Number)getAttributeInternal(REGISTROEMPLEADO);
    }

    /**Sets <code>value</code> as the attribute value for RegistroEmpleado
     */
    public void setRegistroEmpleado(Number value) {
        setAttributeInternal(REGISTROEMPLEADO, value);
    }

    /**Gets the attribute value for FacTiempo, using the alias name FacTiempo
     */
    public Number getFacTiempo() {
        return (Number)getAttributeInternal(FACTIEMPO);
    }

    /**Sets <code>value</code> as the attribute value for FacTiempo
     */
    public void setFacTiempo(Number value) {
        setAttributeInternal(FACTIEMPO, value);
    }

    /**Gets the attribute value for Numero, using the alias name Numero
     */
    public Number getNumero() {
        return (Number)getAttributeInternal(NUMERO);
    }

    /**Sets <code>value</code> as the attribute value for Numero
     */
    public void setNumero(Number value) {
        setAttributeInternal(NUMERO, value);
    }

    /**Gets the attribute value for Anio, using the alias name Anio
     */
    public Number getAnio() {
        return (Number)getAttributeInternal(ANIO);
    }

    /**Sets <code>value</code> as the attribute value for Anio
     */
    public void setAnio(Number value) {
        setAttributeInternal(ANIO, value);
    }

    /**Gets the attribute value for IdPuestoEscala, using the alias name IdPuestoEscala
     */
    public Number getIdPuestoEscala() {
        return (Number)getAttributeInternal(IDPUESTOESCALA);
    }

    /**Sets <code>value</code> as the attribute value for IdPuestoEscala
     */
    public void setIdPuestoEscala(Number value) {
        setAttributeInternal(IDPUESTOESCALA, value);
    }

    /**Gets the attribute value for IdPartidaSicoin, using the alias name IdPartidaSicoin
     */
    public Number getIdPartidaSicoin() {
        return (Number)getAttributeInternal(IDPARTIDASICOIN);
    }

    /**Sets <code>value</code> as the attribute value for IdPartidaSicoin
     */
    public void setIdPartidaSicoin(Number value) {
        setAttributeInternal(IDPARTIDASICOIN, value);
    }

    /**Creates a Key object based on given key constituents
     */
    public static Key createPrimaryKey(Number idMovimientoPlaza, 
                                       Number idAnexo) {
        return new Key(new Object[]{idMovimientoPlaza, idAnexo});
    }
}
