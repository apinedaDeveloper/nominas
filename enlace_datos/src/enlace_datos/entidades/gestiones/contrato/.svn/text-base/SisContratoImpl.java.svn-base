
package enlace_datos.entidades.gestiones.contrato;

import enlace_datos.entidades.gestiones.contrato.common.SisContratoImplMsgBundle;

import enlace_datos.myException;


import enlace_datos.util.MyException;
import enlace_datos.util.myEntityImpl;
import enlace_datos.util.resulOp;
import enlace_datos.util.utils;
import enlace_datos.util.utils_DB;

import java.math.BigDecimal;

import java.math.RoundingMode;

import java.sql.ResultSet;

import java.sql.SQLException;

import java.text.DecimalFormat;
import java.text.NumberFormat;

import java.text.SimpleDateFormat;

import java.util.ArrayList;

import java.util.Calendar;
import java.util.Iterator;

import oracle.jbo.AttrValException;
import oracle.jbo.AttributeList;
import oracle.jbo.JboException;
import oracle.jbo.Key;
import oracle.jbo.NameValuePairs;
import oracle.jbo.RowIterator;
import oracle.jbo.domain.ClobDomain;
import oracle.jbo.domain.Date;
import oracle.jbo.domain.Number;
import oracle.jbo.server.AttributeDefImpl;
import oracle.jbo.server.EntityDefImpl;
import oracle.jbo.server.EntityImpl;
import oracle.jbo.server.TransactionEvent;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class SisContratoImpl extends myEntityImpl {
    public static final int IDCONTRATO = 0;
    public static final int IDTIPOCONTRATO = 1;
    public static final int IDFORMAOBTPUESTO = 2;
    public static final int IDPARTIDA = 3;
    public static final int IDPUESTO = 4;
    public static final int NUMEROPLAZA = 5;
    public static final int CORRELATIVO = 6;
    public static final int REGISTROEMPLEADO = 7;
    public static final int SUELDOBASE = 8;
    public static final int COMPLSAL = 9;
    public static final int ESCALAF = 10;
    public static final int ATRIBUCION = 11;
    public static final int FECHAINICIO = 12;
    public static final int FECHAFIN = 13;
    public static final int HORASCONTRATADAS = 14;
    public static final int LUGARPOSESION = 15;
    public static final int FECHAPOSESION = 16;
    public static final int INSTALACIONPOSESION = 17;
    public static final int FECHACREACION = 18;
    public static final int ESTATUS = 19;
    public static final int NUMHORAS = 20;
    public static final int NUMCONTRATOFORMATO = 21;
    public static final int CREADOPOR = 22;
    public static final int BASELEGAL = 23;
    public static final int IDCONTRATOPADRE = 24;
    public static final int MODPOR1 = 25;
    public static final int FECHAMODIFICACION = 26;
    public static final int OBSERVFORMAOBTPUESTO = 27;
    public static final int HORAPOSESION = 28;
    public static final int CONTRACTVACACION = 29;
    public static final int NOMPLAZA = 30;
    public static final int OBSERVHORARIO = 31;
    public static final int VALHORARIO = 32;
    public static final int FIRMAJEFEUNIDAD = 33;
    public static final int FIRMAJEFESUBPROG = 34;
    public static final int FIRMATESORERO = 35;
    public static final int ATRIBUCIONANEXO = 36;
    public static final int PRIMERINGRESO = 37;
    public static final int TIPOVALIDEZ = 38;
    public static final int FECHAFIRMA = 39;
    public static final int NOEXCEDADE = 40;
    public static final int NUMCONTRATOFISICO = 41;
    public static final int TIPOPAGO = 42;
    public static final int PAGABONO = 43;
    public static final int PROVICIONADO = 44;
    public static final int IDPARTIDAPROV = 45;
    public static final int FECHAINICIODOC = 46;
    public static final int FECHAFINDOC = 47;
    public static final int OPCIONINDEF = 48;
    public static final int IDPARTIDASICOIN = 49;
    public static final int SISHORARIOCONTRATO = 50;
    private static EntityDefImpl mDefinitionObject;
    private int numVeces;
    private boolean ValidacionFechaF=true;
    private boolean ValidacionFechaI=true;
    private boolean vInsertarHorario=true;
    private String []vPuestoExcluye;
    
    
    public boolean getInsertarHorario()
    {
    
        return this.vInsertarHorario;    
    
    }
    
    private void AsignarFirmasContrato(){
        String vConsulta;
        Object vFirma;
       if (this.getIdPartida()!=null)
       {
           /////////// --- firma del jefe 
            vConsulta="select nombre ||'|'|| cargo from sis_auth_contrato_datos_vw where id_auth_contrato=sis_pkg_util.getIdAuthContratoNom("+this.getIdPartida()+","+this.getRegistroEmpleado()+",1)";        
            vFirma=utils_DB.getEjecutarQuerry(this.getDBTransaction(),vConsulta);
            
            if (vFirma!=null){            
               this.setFirmaJefeUnidad(vFirma.toString()); 
            }
             
           ///////// ---- firma del jefe dependencia
            vConsulta="select nombre ||'|'|| cargo from sis_auth_contrato_datos_vw where id_auth_contrato=sis_pkg_util.getIdAuthContratoNom("+this.getIdPartida()+","+this.getRegistroEmpleado()+",2)";        
            vFirma=utils_DB.getEjecutarQuerry(this.getDBTransaction(),vConsulta);
            
            if (vFirma!=null){            
               this.setFirmaJefeSubprog(vFirma.toString()); 
            }
           
           ///////// ---- firma del tesorero
             vConsulta="select nombre ||'|'|| cargo from sis_auth_contrato_datos_vw where id_auth_contrato=sis_pkg_util.getIdAuthContratoNom("+this.getIdPartida()+","+this.getRegistroEmpleado()+",3)";        
             vFirma=utils_DB.getEjecutarQuerry(this.getDBTransaction(),vConsulta);
             
             if (vFirma!=null){
                this.setFirmaTesorero(vFirma.toString()); 
             }
            
       }
    
    }
    

    /**This is the default constructor (do not remove)
     */
    public SisContratoImpl() {
        numVeces=0;
    }


    /**Retrieves the definition object for this instance class.
     */
    public static synchronized EntityDefImpl getDefinitionObject() {
        if (mDefinitionObject == null) {
            mDefinitionObject = (EntityDefImpl)EntityDefImpl.findDefObject("enlace_datos.entidades.gestiones.contrato.SisContrato");
        }
        return mDefinitionObject;
    }

    /**Gets the attribute value for IdContrato, using the alias name IdContrato
     */
    public Number getIdContrato() {
        return (Number)getAttributeInternal(IDCONTRATO);
    }

    /**Sets <code>value</code> as the attribute value for IdContrato
     */
    public void setIdContrato(Number value) {
        setAttributeInternal(IDCONTRATO, value);
    }

    /**Gets the attribute value for IdTipoContrato, using the alias name IdTipoContrato
     */
    public Number getIdTipoContrato() {
        return (Number)getAttributeInternal(IDTIPOCONTRATO);
    }

    /**Sets <code>value</code> as the attribute value for IdTipoContrato
     */
    public void setIdTipoContrato(Number value) {
        setAttributeInternal(IDTIPOCONTRATO, value);
    }

    /**Gets the attribute value for IdFormaObtPuesto, using the alias name IdFormaObtPuesto
     */
    public Number getIdFormaObtPuesto() {
        return (Number)getAttributeInternal(IDFORMAOBTPUESTO);
    }

    /**Sets <code>value</code> as the attribute value for IdFormaObtPuesto
     */
    public void setIdFormaObtPuesto(Number value) {
        setAttributeInternal(IDFORMAOBTPUESTO, value);
    }

    /**Gets the attribute value for IdPartida, using the alias name IdPartida
     */
    public Number getIdPartida() {
        return (Number)getAttributeInternal(IDPARTIDA);
    }

    /**Sets <code>value</code> as the attribute value for IdPartida
     */
    public void setIdPartida(Number value) {
        setAttributeInternal(IDPARTIDA, value);
        ///System.out.println("Cambio de partida");
        AsignarFirmasContrato();
    }

    /**Gets the attribute value for IdPuesto, using the alias name IdPuesto
     */
    public Number getIdPuesto() {
        return (Number)getAttributeInternal(IDPUESTO);
    }

    /**Sets <code>value</code> as the attribute value for IdPuesto
     */
    public void setIdPuesto(Number value) {
        setAttributeInternal(IDPUESTO, value);
    }

    /**Gets the attribute value for NumeroPlaza, using the alias name NumeroPlaza
     */
    public Number getNumeroPlaza() {
        return (Number)getAttributeInternal(NUMEROPLAZA);
    }

    /**Sets <code>value</code> as the attribute value for NumeroPlaza
     */
    public void setNumeroPlaza(Number value) {
        setAttributeInternal(NUMEROPLAZA, value);
    }

    /**Gets the attribute value for Correlativo, using the alias name Correlativo
     */
    public Number getCorrelativo() {
        return (Number)getAttributeInternal(CORRELATIVO);
    }

    /**Sets <code>value</code> as the attribute value for Correlativo
     */
    public void setCorrelativo(Number value) {
        setAttributeInternal(CORRELATIVO, value);
    }

    /**Gets the attribute value for RegistroEmpleado, using the alias name RegistroEmpleado
     */
    public Number getRegistroEmpleado() {
        return (Number)getAttributeInternal(REGISTROEMPLEADO);
    }

    /**Sets <code>value</code> as the attribute value for RegistroEmpleado
     */
    public void setRegistroEmpleado(Number value) {
        setAttributeInternal(REGISTROEMPLEADO, value);
    }

    /**Gets the attribute value for Sueldobase, using the alias name Sueldobase
     */
    public Number getSueldobase() {
        return (Number)getAttributeInternal(SUELDOBASE);
    }

    /**Sets <code>value</code> as the attribute value for Sueldobase
     */
    public void setSueldobase(Number value) {
        setAttributeInternal(SUELDOBASE, value);
    }

    /**Gets the attribute value for ComplSal, using the alias name ComplSal
     */
    public Number getComplSal() {
        return (Number)getAttributeInternal(COMPLSAL);
    }

    /**Sets <code>value</code> as the attribute value for ComplSal
     */
    public void setComplSal(Number value) {
        setAttributeInternal(COMPLSAL, value);
    }

    /**Gets the attribute value for Escalaf, using the alias name Escalaf
     */
    public Number getEscalaf() {
        return (Number)getAttributeInternal(ESCALAF);
    }

    /**Sets <code>value</code> as the attribute value for Escalaf
     */
    public void setEscalaf(Number value) {
        setAttributeInternal(ESCALAF, value);
    }

    /**Gets the attribute value for Atribucion, using the alias name Atribucion
     */
    public String getAtribucion() {
        return (String)getAttributeInternal(ATRIBUCION);
    }

    /**Sets <code>value</code> as the attribute value for Atribucion
     */
    public void setAtribucion(String value) {
        setAttributeInternal(ATRIBUCION, value);
    }

    /**Gets the attribute value for FechaInicio, using the alias name FechaInicio
     */
    public Date getFechaInicio() {
        return (Date)getAttributeInternal(FECHAINICIO);
    }

    /**Sets <code>value</code> as the attribute value for FechaInicio
     */
    public void setFechaInicio(Date value) {
        setAttributeInternal(FECHAINICIO, value);
        setAttributeInternal(FECHAINICIODOC, value);
        
    }

    /**Gets the attribute value for FechaFin, using the alias name FechaFin
     */
    public Date getFechaFin() {
        return (Date)getAttributeInternal(FECHAFIN);
    }

    /**Sets <code>value</code> as the attribute value for FechaFin
     */
    public void setFechaFin(Date value) {
        setAttributeInternal(FECHAFIN, value);
        setAttributeInternal(FECHAFINDOC, value);
    }

    /**Gets the attribute value for Horascontratadas, using the alias name Horascontratadas
     */
    public Number getHorascontratadas() {
        return (Number)getAttributeInternal(HORASCONTRATADAS);
    }

    /**Sets <code>value</code> as the attribute value for Horascontratadas
     */
    public void setHorascontratadas(Number value) {
        setAttributeInternal(HORASCONTRATADAS, value);
    }

    /**Gets the attribute value for LugarPosesion, using the alias name LugarPosesion
     */
    public Number getLugarPosesion() {
        return (Number)getAttributeInternal(LUGARPOSESION);
    }

    /**Sets <code>value</code> as the attribute value for LugarPosesion
     */
    public void setLugarPosesion(Number value) {
        setAttributeInternal(LUGARPOSESION, value);
    }

    /**Gets the attribute value for FechaPosesion, using the alias name FechaPosesion
     */
    public Date getFechaPosesion() {
        return (Date)getAttributeInternal(FECHAPOSESION);
    }

    /**Sets <code>value</code> as the attribute value for FechaPosesion
     */
    public void setFechaPosesion(Date value) {
        setAttributeInternal(FECHAPOSESION, value);
    }

    /**Gets the attribute value for InstalacionPosesion, using the alias name InstalacionPosesion
     */
    public String getInstalacionPosesion() {
        return (String)getAttributeInternal(INSTALACIONPOSESION);
    }

    /**Sets <code>value</code> as the attribute value for InstalacionPosesion
     */
    public void setInstalacionPosesion(String value) {
        setAttributeInternal(INSTALACIONPOSESION, value);
    }

    /**Gets the attribute value for FechaCreacion, using the alias name FechaCreacion
     */
    public Date getFechaCreacion() {
        return (Date)getAttributeInternal(FECHACREACION);
    }

    /**Sets <code>value</code> as the attribute value for FechaCreacion
     */
    public void setFechaCreacion(Date value) {
        setAttributeInternal(FECHACREACION, value);
    }

    /**Gets the attribute value for Estatus, using the alias name Estatus
     */
    public Number getEstatus() {
        return (Number)getAttributeInternal(ESTATUS);
    }

    /**Sets <code>value</code> as the attribute value for Estatus
     */
    public void setEstatus(Number value) {
        setAttributeInternal(ESTATUS, value);
    }

    /**getAttrInvokeAccessor: generated method. Do not modify.
     */
    protected Object getAttrInvokeAccessor(int index, 
                                           AttributeDefImpl attrDef) throws Exception {
        switch (index) {
        case IDCONTRATO:
            return getIdContrato();
        case IDTIPOCONTRATO:
            return getIdTipoContrato();
        case IDFORMAOBTPUESTO:
            return getIdFormaObtPuesto();
        case IDPARTIDA:
            return getIdPartida();
        case IDPUESTO:
            return getIdPuesto();
        case NUMEROPLAZA:
            return getNumeroPlaza();
        case CORRELATIVO:
            return getCorrelativo();
        case REGISTROEMPLEADO:
            return getRegistroEmpleado();
        case SUELDOBASE:
            return getSueldobase();
        case COMPLSAL:
            return getComplSal();
        case ESCALAF:
            return getEscalaf();
        case ATRIBUCION:
            return getAtribucion();
        case FECHAINICIO:
            return getFechaInicio();
        case FECHAFIN:
            return getFechaFin();
        case HORASCONTRATADAS:
            return getHorascontratadas();
        case LUGARPOSESION:
            return getLugarPosesion();
        case FECHAPOSESION:
            return getFechaPosesion();
        case INSTALACIONPOSESION:
            return getInstalacionPosesion();
        case FECHACREACION:
            return getFechaCreacion();
        case ESTATUS:
            return getEstatus();
        case NUMHORAS:
            return getnumHoras();
        case NUMCONTRATOFORMATO:
            return getnumContratoFormato();
        case CREADOPOR:
            return getCreadoPor();
        case BASELEGAL:
            return getBaseLegal();
        case IDCONTRATOPADRE:
            return getIdContratoPadre();
        case MODPOR1:
            return getModPor1();
        case FECHAMODIFICACION:
            return getFechaModificacion();
        case OBSERVFORMAOBTPUESTO:
            return getObservFormaobtpuesto();
        case HORAPOSESION:
            return getHoraPosesion();
        case CONTRACTVACACION:
            return getContractVacacion();
        case NOMPLAZA:
            return getNomPlaza();
        case OBSERVHORARIO:
            return getObservhorario();
        case VALHORARIO:
            return getValHorario();
        case FIRMAJEFEUNIDAD:
            return getFirmaJefeUnidad();
        case FIRMAJEFESUBPROG:
            return getFirmaJefeSubprog();
        case FIRMATESORERO:
            return getFirmaTesorero();
        case ATRIBUCIONANEXO:
            return getAtribucionAnexo();
        case PRIMERINGRESO:
            return getPrimerIngreso();
        case TIPOVALIDEZ:
            return getTipoValidez();
        case FECHAFIRMA:
            return getFechaFirma();
        case NOEXCEDADE:
            return getNoExcedaDe();
        case NUMCONTRATOFISICO:
            return getNumContratoFisico();
        case TIPOPAGO:
            return getTipoPago();
        case PAGABONO:
            return getPagaBono();
        case PROVICIONADO:
            return getProvicionado();
        case IDPARTIDAPROV:
            return getIdPartidaProv();
        case FECHAINICIODOC:
            return getFechaInicioDoc();
        case FECHAFINDOC:
            return getFechaFinDoc();
        case OPCIONINDEF:
            return getOpcionIndef();
        case IDPARTIDASICOIN:
            return getIdPartidaSicoin();
        case SISHORARIOCONTRATO:
            return getSisHorarioContrato();
        default:
            return super.getAttrInvokeAccessor(index, attrDef);
        }
    }

    /**setAttrInvokeAccessor: generated method. Do not modify.
     */
    protected void setAttrInvokeAccessor(int index, Object value, 
                                         AttributeDefImpl attrDef) throws Exception {
        switch (index) {
        case IDCONTRATO:
            setIdContrato((Number)value);
            return;
        case IDTIPOCONTRATO:
            setIdTipoContrato((Number)value);
            return;
        case IDFORMAOBTPUESTO:
            setIdFormaObtPuesto((Number)value);
            return;
        case IDPARTIDA:
            setIdPartida((Number)value);
            return;
        case IDPUESTO:
            setIdPuesto((Number)value);
            return;
        case NUMEROPLAZA:
            setNumeroPlaza((Number)value);
            return;
        case CORRELATIVO:
            setCorrelativo((Number)value);
            return;
        case REGISTROEMPLEADO:
            setRegistroEmpleado((Number)value);
            return;
        case SUELDOBASE:
            setSueldobase((Number)value);
            return;
        case COMPLSAL:
            setComplSal((Number)value);
            return;
        case ESCALAF:
            setEscalaf((Number)value);
            return;
        case ATRIBUCION:
            setAtribucion((String)value);
            return;
        case FECHAINICIO:
            setFechaInicio((Date)value);
            return;
        case FECHAFIN:
            setFechaFin((Date)value);
            return;
        case HORASCONTRATADAS:
            setHorascontratadas((Number)value);
            return;
        case LUGARPOSESION:
            setLugarPosesion((Number)value);
            return;
        case FECHAPOSESION:
            setFechaPosesion((Date)value);
            return;
        case INSTALACIONPOSESION:
            setInstalacionPosesion((String)value);
            return;
        case FECHACREACION:
            setFechaCreacion((Date)value);
            return;
        case ESTATUS:
            setEstatus((Number)value);
            return;
        case NUMHORAS:
            setnumHoras((Double)value);
            return;
        case NUMCONTRATOFORMATO:
            setnumContratoFormato((String)value);
            return;
        case CREADOPOR:
            setCreadoPor((String)value);
            return;
        case BASELEGAL:
            setBaseLegal((String)value);
            return;
        case IDCONTRATOPADRE:
            setIdContratoPadre((Number)value);
            return;
        case MODPOR1:
            setModPor1((String)value);
            return;
        case FECHAMODIFICACION:
            setFechaModificacion((Date)value);
            return;
        case OBSERVFORMAOBTPUESTO:
            setObservFormaobtpuesto((String)value);
            return;
        case HORAPOSESION:
            setHoraPosesion((String)value);
            return;
        case CONTRACTVACACION:
            setContractVacacion((Number)value);
            return;
        case NOMPLAZA:
            setNomPlaza((String)value);
            return;
        case OBSERVHORARIO:
            setObservhorario((String)value);
            return;
        case VALHORARIO:
            setValHorario((Boolean)value);
            return;
        case FIRMAJEFEUNIDAD:
            setFirmaJefeUnidad((String)value);
            return;
        case FIRMAJEFESUBPROG:
            setFirmaJefeSubprog((String)value);
            return;
        case FIRMATESORERO:
            setFirmaTesorero((String)value);
            return;
        case ATRIBUCIONANEXO:
            setAtribucionAnexo((ClobDomain)value);
            return;
        case PRIMERINGRESO:
            setPrimerIngreso((String)value);
            return;
        case TIPOVALIDEZ:
            setTipoValidez((String)value);
            return;
        case FECHAFIRMA:
            setFechaFirma((Date)value);
            return;
        case NOEXCEDADE:
            setNoExcedaDe((Date)value);
            return;
        case NUMCONTRATOFISICO:
            setNumContratoFisico((String)value);
            return;
        case TIPOPAGO:
            setTipoPago((Number)value);
            return;
        case PAGABONO:
            setPagaBono((Number)value);
            return;
        case PROVICIONADO:
            setProvicionado((Number)value);
            return;
        case IDPARTIDAPROV:
            setIdPartidaProv((Number)value);
            return;
        case FECHAINICIODOC:
            setFechaInicioDoc((Date)value);
            return;
        case FECHAFINDOC:
            setFechaFinDoc((Date)value);
            return;
        case OPCIONINDEF:
            setOpcionIndef((Number)value);
            return;
        case IDPARTIDASICOIN:
            setIdPartidaSicoin((Number)value);
            return;
        default:
            super.setAttrInvokeAccessor(index, value, attrDef);
            return;
        }
    }

    /**Add locking logic here.
     */
    public void lock() {
        super.lock();
    }


   private String getCadenaHorario(){
   
       RowIterator vHorario;
       sisHorarioContratoImpl vFilaHorario;
       vHorario=this.getSisHorarioContrato();
       String vHorarioStr="";
       

        while (vHorario.hasNext())
        {
             vFilaHorario=(sisHorarioContratoImpl)vHorario.next();
            vHorarioStr=vFilaHorario.getIdDia()+"|";
             
        }
    return vHorarioStr;    
   }


    /**Custom DML update/insert/delete logic here.
     */
    protected void doDML(int operation, TransactionEvent e) {
        NameValuePairs vParametros= new NameValuePairs();
        Object pValorConsulta;
        Number pIdContrato;
        Number pIdPartidaSicoin;
        RowIterator vHorario;
        sisHorarioContratoImpl vFilaHorario;
        oracle.jbo.DMLException vCausa;
        Object []vExceptions;
        Boolean isHoras;
        //int cambios;
        
        //cambios=this.getAttributeChangedCount();
        
      //  System.out.println(" actualizando contrato");
       isHoras = false;
       ResultSet fila=utils_DB.getEjecutarQuerry(this.getDBTransaction(),"select * from sis_contrato where id_contrato="+this.getIdContrato(),0);
       String idEstatus; 
       
       idEstatus=null;
       try {
           if(fila.next()){
               idEstatus = fila.getObject("estatus").toString();
               //fechaInicioDoc = fila.getObject("fecha_inicio_doc").toString();
               //fechaPosesion = fila.getObject("fecha_posesion").toString();
           }
       } catch (SQLException ex) {
           ex.printStackTrace();
       }
           
        
       if(!(this.getTipoValidez().equals("I") && idEstatus!=null && idEstatus.equals(this.getEstatus().toString()) && (idEstatus.equals("4") || idEstatus.equals("36") || idEstatus.equals("49") || idEstatus.equals("14")))){           
           ValidarEntidad();
       }
        
        
        
        vParametros.setAttribute("fechaInicio",utils.getFechaFormato("dd/MM/yyyy",this.getFechaInicio()) );
        vParametros.setAttribute("fechaPosesion",utils.getFechaFormato("dd/MM/yyyy",this.getFechaPosesion()));
        vParametros.setAttribute("Partida",this.getIdPartida());
        vParametros.setAttribute("Horario",getCadenaHorario());
        
        if (this.getFechaFirma()==null)
        {
            pValorConsulta=utils_DB.getValorFuncion(e.getDBTransaction(),"to_char(sis_pkg_util.getFechaFirmaContrato2(to_date(?,'dd/mm/yyyy'),to_date(?,'dd/mm/yyyy'),?,?),'dd/mm/yyyy')",vParametros);
            
            if (pValorConsulta!=null)
            {
              this.setFechaFirma(utils.getFechaOracle(pValorConsulta.toString()));            
                
            }
            
        }
        
        isAumentoSalarial();
        if (operation==this.DML_INSERT)
        {
        
        vParametros.clear();
        // Obteniendo el numero de contrato
        vParametros.setAttribute("partida",this.getIdPartida());
        vParametros.setAttribute("anio",this.getCorrelativo());
        pValorConsulta=utils_DB.getValorFuncion(e.getDBTransaction(),"sis_pkg_util.GETCODCONTRATO2(?,?)",vParametros);
        pIdContrato=utils.getNumberOracle(pValorConsulta);
             
        pValorConsulta=utils_DB.getIdEstado(e.getDBTransaction(),"INGRESADO","SIS_CONTRATO");
        
        
        
          if (numVeces==0 || pIdContrato.compareTo(this.getIdContrato())!=0){
           vHorario=this.getSisHorarioContrato();
        // Cambio el id del proceso para el proceso pago det        
            while (vHorario.hasNext()){
                 isHoras = true;
                 vFilaHorario=(sisHorarioContratoImpl)vHorario.next();
                 vFilaHorario.setIdContrato(pIdContrato);
                                 } 
         this.setIdContrato(pIdContrato);
         //No se puede crear contrato si no se ha ingresado horario de contratacion,.
         if (!isHoras){
            throw new JboException("No se a ingresado horario.");       
        }
         
               }
               numVeces++;      
         this.setEstatus(utils.getNumberOracle(pValorConsulta));
         this.setCreadoPor(utils.getAuthUser(this.getDBTransaction()));

         
        
            if (this.getTipoValidez()!=null && (this.getTipoValidez().equals("I")||this.getTipoValidez().equals("G")||this.getTipoValidez().equals("A")))
            {
                this.setFechaFin(null);
              
            } 
        
         }
        
         else{
             if(operation==this.DML_UPDATE){
                Calendar cal = Calendar.getInstance();
                cal.setTime(this.getFechaCreacion().getValue());
                int year = cal.get(Calendar.YEAR);
              //  System.out.println(utils.getAnioActual()+"-"+year);
                if (this.getTipoValidez()!=null && (this.getTipoValidez().equals("I")||this.getTipoValidez().equals("G")||this.getTipoValidez().equals("A"))){
                    if(utils.getAnioActual().equals(year)){
                        this.setFechaFin(null);
                    }
                }
             }
         }
         
        //VINCULAR PARTIDA SICOIN EN EL CONTRATO
                Number pSicoinPlaza , pSicoinAnexo ;
                String strConsulta = "select id_partida_sicoin from sis_plaza where id_partida = "+this.getIdPartida()
                                                                            +" and id_puesto ="+this.getIdPuesto()+" and numero_plaza = "+this.getNumeroPlaza()
                                                                            +" and correlativo = "+this.getCorrelativo()
                                                                            ;
              //  System.out.println(strConsulta);                                                                        
                 pValorConsulta=utils_DB.getEjecutarQuerry(e.getDBTransaction(),strConsulta);  
                 pSicoinPlaza=utils.getNumberOracle(pValorConsulta);
                 
                 strConsulta = "select sicoin_anexo\n" + 
                 "        from (\n" + 
                 "        select  m.id_partida, m.id_puesto, m.numero_plaza plaza, m.correlativo, m.id_partida_sicoin sicoin_anexo\n" + 
                 "        ,fecha_inicio , fecha_fin , a.fecha_creacion\n" + 
                 "        from sis_movimiento_plaza m\n" + 
                 "        inner join sis_Anexo a on a.id_anexo = m.id_anexo\n" + 
                 "        inner join sis_estado e on e.id_Estado = a.estatus\n" + 
                 "        where e.id_estado = 34  and m.id_partida_sicoin is not null and m.operacion = 'A' \n" + 
                 "        and m.id_partida = "+this.getIdPartida()+" and m.id_puesto = "+this.getIdPuesto()+" and m.correlativo = "+this.getCorrelativo()+" and m.numero_plaza = " +  this.getNumeroPlaza()+" \n"+
                 "        and a.fecha_creacion = (    select max(a.fecha_creacion) \n" + 
                 "                                    from sis_movimiento_plaza m\n" + 
                 "                                    inner join sis_Anexo a on a.id_anexo = m.id_anexo\n" + 
                 "                                    inner join sis_estado e on e.id_Estado = a.estatus\n" + 
                 "                                    where e.id_estado = 34  and m.id_partida_sicoin is not null and m.operacion = 'A' \n" + 
                 "                                    and m.id_partida = "+this.getIdPartida()+" and m.id_puesto = "+this.getIdPuesto()+" and m.correlativo = "+this.getCorrelativo()+" and m.numero_plaza = " +  this.getNumeroPlaza()+" \n"+
                 "                                    and ( (to_date('"+this.getFechaInicio()+"','yyyy-mm-dd') = to_date(to_char(fecha_inicio,'dd/mm/yyyy'))\n" + 
                 "                                           and to_date('"+this.getFechaFin()+"','yyyy-mm-dd') = to_date(to_char(fecha_fin,'dd/mm/yyyy')) \n" + 
                 "                                          )" +  
                 "                                        )" + 
                 "                               )" + 
                 "        )" + 
                 "        where " + 
                 "        ( (to_date('"+this.getFechaInicio()+"','yyyy-mm-dd') = to_date(to_char(fecha_inicio,'dd/mm/yyyy'))\n" + 
                 "           and to_date('"+this.getFechaFin()+"','yyyy-mm-dd') = to_date(to_char(fecha_fin,'dd/mm/yyyy')) \n" + 
                 "          )" +  
                 "        )";
                    
                //    System.out.println(strConsulta); 
                    pValorConsulta=utils_DB.getEjecutarQuerry(e.getDBTransaction(),strConsulta);  
                    pSicoinAnexo=utils.getNumberOracle(pValorConsulta);
        
        if (pSicoinAnexo == null) {                  
                    
        strConsulta = "select sicoin_anexo\n" + 
        "        from (\n" + 
        "        select  m.id_partida, m.id_puesto, m.numero_plaza plaza, m.correlativo, m.id_partida_sicoin sicoin_anexo\n" + 
        "        ,fecha_inicio , fecha_fin , a.fecha_creacion\n" + 
        "        from sis_movimiento_plaza m\n" + 
        "        inner join sis_Anexo a on a.id_anexo = m.id_anexo\n" + 
        "        inner join sis_estado e on e.id_Estado = a.estatus\n" + 
        "        where e.id_estado = 34  and m.id_partida_sicoin is not null and m.operacion = 'A' \n" + 
        "        and m.id_partida = "+this.getIdPartida()+" and m.id_puesto = "+this.getIdPuesto()+" and m.correlativo = "+this.getCorrelativo()+" and m.numero_plaza = " +  this.getNumeroPlaza()+" \n"+
        "        and a.fecha_creacion = (    select max(a.fecha_creacion) \n" + 
        "                                    from sis_movimiento_plaza m\n" + 
        "                                    inner join sis_Anexo a on a.id_anexo = m.id_anexo\n" + 
        "                                    inner join sis_estado e on e.id_Estado = a.estatus\n" + 
        "                                    where e.id_estado = 34  and m.id_partida_sicoin is not null and m.operacion = 'A' \n" + 
        "                                    and m.id_partida = "+this.getIdPartida()+" and m.id_puesto = "+this.getIdPuesto()+" and m.correlativo = "+this.getCorrelativo()+" and m.numero_plaza = " +  this.getNumeroPlaza()+" \n"+
        "                                    and to_date('"+this.getFechaInicio()+"','yyyy-mm-dd') between to_date(to_char(fecha_inicio,'dd/mm/yyyy')) and to_date(to_char(fecha_fin,'dd/mm/yyyy')) "+
        "                               )" + 
        "        )" + 
        "        where to_date('"+this.getFechaInicio()+"','yyyy-mm-dd')  between to_date(to_char(fecha_inicio,'dd/mm/yyyy')) and to_date(to_char(fecha_fin,'dd/mm/yyyy')) "
        ;
           
          // System.out.println(strConsulta);
            pValorConsulta=utils_DB.getEjecutarQuerry(e.getDBTransaction(),strConsulta);  
            pSicoinAnexo=utils.getNumberOracle(pValorConsulta);
        }
        
        
        
        if (pSicoinAnexo != null && pSicoinPlaza != null && pSicoinAnexo !=  pSicoinPlaza)
            pIdPartidaSicoin = pSicoinAnexo;
        else
            pIdPartidaSicoin = pSicoinPlaza;
    
                 
                 if (pIdPartidaSicoin != null) {
                    this.setIdPartidaSicoin(pIdPartidaSicoin);
                 }
        //FIN VINCULAR PARTIDA SICOIN EN EL CONTRATO    
        
     
       
        try{   
        
        // Si el valor del complemento es nulo lo inicializa a cero por defecto
        if (this.getComplSal()==null){
            this.setComplSal(new Number(0)); 
        }
        
        //Si el valor del escalafon es nulo lo inicializa a cero por defecto
        if (this.getEscalaf()==null){
            this.setEscalaf(new Number(0));
        }
        
        registrarLogOperaciones(operation, e); 
        super.doDML(operation, e);
        vInsertarHorario=true;
        
        }catch(Exception exep){
        
            if (operation==this.DML_INSERT)
            { 
              this.setFechaFirma(null);
              
            }  
         /*
            if (numVeces==0){
               actualizar_HORARIO();
            }
           
            numVeces++;
            */            
            super.getDBTransaction().cancelDMLOperations();
            //this.getDBTransaction().cancelDMLOperations();
            vCausa=(oracle.jbo.DMLException)exep;
            vExceptions=vCausa.getExceptions();
            //vInsertarHorario=false;
            
             vInsertarHorario=false;
             if (vExceptions.length>0){                 
                 throw new myException(utils.getSQLMensaje((Exception)vExceptions[0]));        
             }   
        }
        
    }

   public void actualizar_HORARIO(){
       sisHorarioContratoImpl vNuevaFila,vNuevaFila2;
       ArrayList vFilastemp= new ArrayList();
       RowIterator vHorario;
       vHorario=this.getSisHorarioContrato();
       vHorario.reset();
       
  
       while (vHorario.hasNext()){
            vNuevaFila2=(sisHorarioContratoImpl)vHorario.next();
            vFilastemp.add(vNuevaFila2);
                            }
                            
       for (Iterator iter=vFilastemp.iterator(); iter.hasNext();){
             vNuevaFila2=(sisHorarioContratoImpl)iter.next();
             vNuevaFila=(sisHorarioContratoImpl)vHorario.createRow(); 
             vNuevaFila2.remove();
             vNuevaFila.setIdDia(vNuevaFila2.getIdDia());
             vNuevaFila.setHoraEntrada2(vNuevaFila2.getHoraEntrada2());
             vNuevaFila.setHoraSalida2(vNuevaFila2.getHoraSalida2());         
       }
       
       
   }

    /**Gets the associated entity oracle.jbo.RowIterator
     */
    public RowIterator getSisHorarioContrato() {
        return (RowIterator)getAttributeInternal(SISHORARIOCONTRATO);
    }


   private void obtenerPuestosExcluye(){
       
       Object vPuestos;
       
       vPuestos=utils_DB.getEjecutarQuerry(this.getDBTransaction(),"select valor_cadena from sis_parametros_aplicacion where nom_parametro='CONTRATO_PUESTO_NOVALIDA'");
       
       if (vPuestos!=null)
         vPuestoExcluye=vPuestos.toString().split("\\|");
       
   }

    /**Add attribute defaulting logic in this method.
     */
    protected void create(AttributeList attributeList) {
        super.create(attributeList);   
        Object  pValorConsulta,vPuestos;
        pValorConsulta=attributeList;
        this.setLugarPosesion(utils.getNumberOracle(1));
        this.setPrimerIngreso("0");
        this.setTipoValidez("N");
        
        
        //usuario.
       // pValorConsulta=utils_DB.getValorFuncion(this.getDBTransaction(),"sis_pkg_util.GETCODCONTRATO(?)",vParametros);
        
        //this.setIdContrato(utils.getNumberOracle("125745"));
        /*
        sisHorarioContratoImpl nuevaFila;
        RowIterator horario;
        horario=this.getSisHorarioContrato();
        nuevaFila=(sisHorarioContratoImpl)horario.createRow();
        nuevaFila.setHoraEntrada2("07:30");
        nuevaFila.setHoraSalida2("15:30");
        nuevaFila.setIdDia("L-V");
        nuevaFila.setIdContrato(this.getIdContrato());
        horario.insertRow(nuevaFila);
    */
        }


    /**Gets the attribute value for numHoras, using the alias name numHoras
     */
    public Double getnumHoras() {
        double sum_horas=0,diff_horas;
        int num_dias=0;
        double diasSemana[]={0,0,0,0,0,0,0};
        RowIterator vHorario;
        sisHorarioContratoImpl vFilaHorario;
        vHorario=this.getSisHorarioContrato();
            
            while (vHorario.hasNext()){
                 vFilaHorario=(sisHorarioContratoImpl)vHorario.next();
                 diff_horas=vFilaHorario.getHoraF1().getDiff_minutos(vFilaHorario.getHoraE1());
                 
                 if (vFilaHorario.getIdDia().equals("L-V")){
                    diasSemana[0]+=diff_horas;
                    diasSemana[1]+=diff_horas;
                    diasSemana[2]+=diff_horas;
                    diasSemana[3]+=diff_horas;
                    diasSemana[4]+=diff_horas;
                 }else if (vFilaHorario.getIdDia().equals("L-S")){
                     diasSemana[0]+=diff_horas;
                     diasSemana[1]+=diff_horas;
                     diasSemana[2]+=diff_horas;
                     diasSemana[3]+=diff_horas;
                     diasSemana[4]+=diff_horas;
                     diasSemana[5]+=diff_horas;
                 }else  if (vFilaHorario.getIdDia().equals("L-D")){
                     diasSemana[0]+=diff_horas;
                     diasSemana[1]+=diff_horas;
                     diasSemana[2]+=diff_horas;
                     diasSemana[3]+=diff_horas;
                     diasSemana[4]+=diff_horas;
                     diasSemana[5]+=diff_horas;
                     diasSemana[6]+=diff_horas;
                 }else if (vFilaHorario.getIdDia().equals("L")){
                     diasSemana[0]+=diff_horas;
                 }else if (vFilaHorario.getIdDia().equals("M")){
                     diasSemana[1]+=diff_horas;
                 }else if (vFilaHorario.getIdDia().equals("MI")){
                     diasSemana[2]+=diff_horas;
                 }else if (vFilaHorario.getIdDia().equals("J")){
                     diasSemana[3]+=diff_horas;
                 }else if (vFilaHorario.getIdDia().equals("V")){
                     diasSemana[4]+=diff_horas;
                 }else if (vFilaHorario.getIdDia().equals("S")){
                     diasSemana[5]+=diff_horas;
                 }else if (vFilaHorario.getIdDia().equals("D")){
                     diasSemana[6]+=diff_horas;
                 }
     }
        sum_horas=diasSemana[0]+diasSemana[1]+diasSemana[2]+diasSemana[3]+diasSemana[4]+diasSemana[5]+diasSemana[6];
       /*
       num_dias=0;
       for (int i=0;i<7;i++){
         if (diasSemana[i]>0){
             num_dias++; 
         }
        
       }
       
        return sum_horas/(num_dias==0?1:num_dias);
       */
       
        return (new BigDecimal(sum_horas/60)).setScale(4,RoundingMode.UP).doubleValue();
        
        //return sum_horas; 
        
    }

    /**Sets <code>value</code> as the attribute value for numHoras
     */
    public void setnumHoras(Double value) {
        setAttributeInternal(NUMHORAS, value);
    }

    /**Gets the attribute value for numContratoFormato, using the alias name numContratoFormato
     */
    public String getnumContratoFormato() {
        String vNumContrato;
        NumberFormat formato;
        formato= new DecimalFormat("0000000000");
        vNumContrato="";
       // System.out.println("formato contrato");
        if (this.getIdContrato()!=null){
            try{
             vNumContrato=formato.format(utils.getNumber(this.getIdContrato()));    
            }catch(Exception exep){
                exep.printStackTrace();
            }
        }
        
        return vNumContrato;
    }

    /**Sets <code>value</code> as the attribute value for numContratoFormato
     */
    public void setnumContratoFormato(String value) {
        setAttributeInternal(NUMCONTRATOFORMATO, value);
    }

    /**Gets the attribute value for CreadoPor, using the alias name CreadoPor
     */
    public String getCreadoPor() {
        return (String)getAttributeInternal(CREADOPOR);
    }

    /**Sets <code>value</code> as the attribute value for CreadoPor
     */
    public void setCreadoPor(String value) {
        setAttributeInternal(CREADOPOR, value);
    }


    /**Gets the attribute value for BaseLegal, using the alias name BaseLegal
     */
    public String getBaseLegal() {
        return (String)getAttributeInternal(BASELEGAL);
    }

    /**Sets <code>value</code> as the attribute value for BaseLegal
     */
    public void setBaseLegal(String value) {
        setAttributeInternal(BASELEGAL, value);
    }

    /*
     *  Funcion para la validacion de los datos
     */
    public void ValidarEntidad(){
    
        
        
        NameValuePairs vParametros;
        vParametros=new NameValuePairs();
        Object vHorasPlaza,vRenglon021,vSuspendido,vResultadoConsul,vHorasIndef;
        String sqlQuerry;
        Object vComple;
        
        //Object vPeriodoPlaza;
        //  String [] vDatosPlaza;
        // Date vFechaInicio,vFechaFin;
      
      /*  
        vParametros.setAttribute("id_partida",this.getIdPartida());
        vParametros.setAttribute("id_puesto",this.getIdPuesto());
        vParametros.setAttribute("numero_plaza",this.getNumeroPlaza());
        vParametros.setAttribute("correlativo",this.getCorrelativo());
        
        vHorasPlaza=utils_DB.getValorTabla(this.getDBTransaction(),"sis_plaza","cantidad_horas",vParametros);
       */
       
       // vPeriodoPlaza=utils_DB.getValorFuncion(this.getDBTransaction(),"sis_pkg_util.getPeriodoPlaza(?,?,?,?)",vParametros);
        
       // vDatosPlaza=vPeriodoPlaza.toString().split("\\|");
        
       // vFechaInicio=utils.getFechaOracle(vDatosPlaza[0]);
       // vFechaFin=utils.getFechaOracle(vDatosPlaza[1]);
        
        
        sqlQuerry="select sis_pkg_util.verificaPlazaLicParcial(";
        sqlQuerry=sqlQuerry+this.getIdPartida();
        sqlQuerry=sqlQuerry+","+this.getIdPuesto()+","+this.getNumeroPlaza()+","+this.getCorrelativo();
        sqlQuerry=sqlQuerry+",to_date('"+utils.getFechaFormato("dd/MM/yyyy",this.getFechaInicio())+"','dd/mm/yyyy')";
        sqlQuerry=sqlQuerry+") as valor from dual"; 
        
        vResultadoConsul=utils_DB.getEjecutarQuerry(this.getDBTransaction(),sqlQuerry);
        
        if (vResultadoConsul!=null && !vResultadoConsul.toString().equals("1")){
            throw new JboException("No se pueda asignar una plaza asociada a una licencia sin goce de sueldo parcial en este periodo") ;
        }
        
        
        if (this.getIdTipoContrato()==null){
            throw new JboException("Por favor seleccione el tipo de contrato");              
        }
        
        if (this.getBaseLegal()==null){
            throw new JboException("Ingrese la base legal del contrato.");              
        }

        if (this.getSueldobase()==null|| this.getSueldobase().getValue()<=0){
            throw new JboException("El sueldo base no puede ser menor  o igual a cero.");              
        }
  
  /* se quita la validacion del horario para que deje guardar, en lugar se coloco un warning, pero no dejar trasladar o imprimir el contrato
        // no aplica para los vigilantes
       if (this.getIdPuesto().compareTo(141016)!=0  && this.getIdPuesto().compareTo(141017)!=0&&this.getIdPuesto().compareTo(141019)!=0){
           
           if (this.getnumHoras().doubleValue()!=utils.getNumberDouble(vHorasPlaza==null?"0":vHorasPlaza)*5){
              throw new JboException("El número de horas del contrato no coincide con el de la plaza."); 
               
           }
           
       }
       else  // para los vigilantes 
       {
           if (this.getSisHorarioContrato().getRowCount()<=0){
               throw new JboException("Por favor ingrese el horario.");   
               
           }
           
       }
       
  */  
  /*
        if (isContratoIndef()==false&&this.getFechaFin().compareTo(this.getFechaInicio())==0){
            throw new JboException("La fecha de inicio no puede ser igual a la fecha fin.");             
        }
        
        if (isContratoIndef()==false&&this.getFechaFin().compareTo(this.getFechaInicio())<0){
            throw new JboException("La fecha de inicio no puede ser mayor a la fecha fin.");             
        }
      */
      
           if (this.getFechaInicio()==null){
               throw new JboException("Por favor ingrese la fecha de inicio.");             
           }
              
           if (this.getFechaFin()!=null)
           {
               if (this.getFechaFin().compareTo(this.getFechaInicio())==0){
                   throw new JboException("La fecha de inicio no puede ser igual a la fecha fin.");             
               }
               
               if (this.getFechaFin().compareTo(this.getFechaInicio())<0){
                   throw new JboException("La fecha de inicio no puede ser mayor a la fecha fin.");             
               }
           }  
        
        if (this.getIdFormaObtPuesto()==null){
            throw new JboException("Seleccione la forma de obtener el puesto.");             
        }
        
        if (this.getLugarPosesion()==null){
            throw new JboException("Por favor ingrese el lugar de la toma de posesión");             
            
        }
        
        if (this.getFechaPosesion()==null){
            throw new JboException("Por favor ingrese la fecha de posesión dd/mm/yyyy");             
        }
        
        if (this.getHoraPosesion()==null){
            throw new JboException("Por favor ingrese la hora de posesión.");             
        }
                
        
        validaFechaPlaza(new Date(),3);

        // Solo si el puesto es fuera de carrera o fuera clasificacion entonces si permite el nombre de la plaza
        if (!(this.getIdPuesto().compareTo(new Number(999990))==0||this.getIdPuesto().compareTo(new Number(999994))==0||this.getIdPuesto().compareTo(new Number(999997))==0||this.getIdPuesto().compareTo(new Number(999999))==0)){
            this.setNomPlaza(null);
        }
        else{
            if (this.getNomPlaza()==null || this.getNomPlaza().trim().equals("")){
                
                throw new JboException("Por favor ingrese el nombre de la plaza");
            }
            
        }
        
       try{ 
        if (this.getBaseLegal()!=null)
            this.setBaseLegal(this.getBaseLegal().trim());
        
        if (this.getAtribucion()!=null)
        {
         
          if (this.getAtribucion().trim().length()<1000 )
          { 
             this.setAtribucion(this.getAtribucion().trim());
          }
          else
          {
              this.setAtribucionAnexo(new ClobDomain(this.getAtribucion().trim().substring(999,this.getAtribucion().trim().length())));
              this.setAtribucion(this.getAtribucion().trim().substring(1,999));
             
          }    
        }
        if (this.getObservFormaobtpuesto()!=null)
            this.setObservFormaobtpuesto(this.getObservFormaobtpuesto().trim());
            
        if (this.getAtribucionAnexo()!=null && this.getAtribucionAnexo().toString().trim().equals("")){
            this.setAtribucionAnexo(null);
            
        }
            
        
        if (this.getContractVacacion()==null || (this.getContractVacacion()!=null && this.getContractVacacion().compareTo(0)==0)){
            
            this.setPagaBono(new Number(1));
        }
           

       }catch(Exception exep){
            exep.getMessage();
       }
       
       
        if (this.getContractVacacion()!=null && this.getContractVacacion().compareTo(1)==0){
            
            vRenglon021=utils_DB.getEjecutarQuerry(this.getDBTransaction(),"select count(0) from partida where d9d10=21 and id_partida="+this.getIdPartida());
            
            if (vRenglon021!=null && !vRenglon021.toString().equals("1")){
                
                throw new JboException("Curso de vacaciones solo puede ser en renglon 021. Por favor verifique");               
                
            }    
            
        }
        
       if (this.getTipoValidez()==null){
           
           throw new JboException("Por favor ingrese el tipo de vigencia.");               
           
       }
        
        
       if (!(this.getTipoValidez().equals("G")||this.getTipoValidez().equals("J")||this.getTipoValidez().equals("A")||this.getTipoValidez().equals("P") || this.getTipoValidez().equals("T"))){
           
           this.setNoExcedaDe(null);
           
       }else{
       
          if (this.getNoExcedaDe()==null)
          {
          
             throw new JboException("Por favor Ingrese la fecha no exceda de"); 
             
          }
           
       }
        
      if (this.getTipoValidez().equals("A"))
      {
          
          vSuspendido=utils_DB.getEjecutarQuerry(this.getDBTransaction(),"select \n" + 
          "count(0) \n" + 
          "from\n" + 
          "sis_solicitud sol,\n" + 
          "sis_suspencion_igss igss\n" + 
          "where sol.id_solicitud=igss.id_solicitud\n" + 
          "and sol.id_estado in(39)\n" + 
          "and registro_empleado= "+this.getRegistroEmpleado() +
          "and id_tipo_solicitud=2\n" + 
          "and fecha_alta_susp_igss is null \n");
          
         if (vSuspendido.toString().equals("0")){
             throw new JboException("El empleado tiene que tener una suspensión IGSS activa, por favor revise la validez del contrato");
         }
          
      }
        
       if (!(this.getTipoValidez().equals("I") || this.getTipoValidez().equals("O"))) // si no es indefinido este valor es nulo.
       {
          this.setOpcionIndef(null);
           
       }else
       {
        
         if (this.getTipoValidez().equals("I"))
         {             
             if (this.getOpcionIndef()==null || this.getOpcionIndef().equals("1")) {
                 
                 String querySem1 = "select \n" + 
                     "sum(horascontratadas) as horas\n" + 
                     "from\n" + 
                     "sis_contrato cnt\n" + 
                     "where registro_empleado=" + this.getRegistroEmpleado()+" "+
                     (this.getIdContrato()!=null?" and cnt.id_contrato<>"+this.getIdContrato()+ " ":" ")+
                     "and estatus not in (11,15,83)\n" + 
                     "and correlativo=" + utils.getAnioActual()+ " "+
                     "and tipo_validez='I'\n" + 
                     "and nvl(cnt.opcion_indef,1) in (1,2)\n" +                         
                     "and not\n" + 
                     "exists(\n" + 
                     "select 1 from sis_solicitud sol\n" + 
                     "where sol.id_estado=39\n" + 
                     "and sol.registro_empleado=cnt.registro_empleado\n" + 
                     "and sol.ID_TIPO_SOLICITUD in (5,8)\n" + 
                     "and sol.id_partida=cnt.id_partida\n" + 
                     "and sol.id_puesto=cnt.id_puesto\n" + 
                     "and sol.numero_plaza=cnt.numero_plaza\n" + 
                     ") \n";
                     
                 Object vHorasIndefSem1 =  utils_DB.getEjecutarQuerry(this.getDBTransaction(), querySem1);
                 
                 String querySem2 = "select \n" + 
                     "sum(horascontratadas) as horas\n" + 
                     "from\n" + 
                     "sis_contrato cnt\n" + 
                     "where registro_empleado=" + this.getRegistroEmpleado()+" "+
                     (this.getIdContrato()!=null?" and cnt.id_contrato<>"+this.getIdContrato()+ " ":" ")+
                     "and estatus not in (11,15,83)\n" + 
                     "and correlativo=" + utils.getAnioActual()+ " "+
                     "and tipo_validez='I'\n" + 
                     "and nvl(cnt.opcion_indef,1) in (1,3)\n" +                         
                     "and not\n" + 
                     "exists(\n" + 
                     "select 1 from sis_solicitud sol\n" + 
                     "where sol.id_estado=39\n" + 
                     "and sol.registro_empleado=cnt.registro_empleado\n" + 
                     "and sol.ID_TIPO_SOLICITUD in (5,8)\n" + 
                     "and sol.id_partida=cnt.id_partida\n" + 
                     "and sol.id_puesto=cnt.id_puesto\n" + 
                     "and sol.numero_plaza=cnt.numero_plaza\n" + 
                     ") \n";
                 
                 Object vHorasIndefSem2 =  utils_DB.getEjecutarQuerry(this.getDBTransaction(), querySem2);
                 
                 //Verifica horas primer semestre
                 
                 if (vHorasIndefSem1 != null && (Double.parseDouble(vHorasIndefSem1.toString()) + 
                     this.getHorascontratadas().doubleValue()) > 
                     new Double("8").doubleValue()) {

                     throw new JboException("El total de horas en contratos indefinidos solo puede ser de máximo 8 horas. Por favor verifique");
                 }
                 else{
                    //Horas del segundo semestre
                     if (vHorasIndefSem2 != null && (Double.parseDouble(vHorasIndefSem2.toString()) + 
                         this.getHorascontratadas().doubleValue()) > 
                         new Double("8").doubleValue()) {

                         throw new JboException("El total de horas en contratos indefinidos solo puede ser de máximo 8 horas. Por favor verifique");
                     }
                 }
             }else{ 
             
           vHorasIndef=utils_DB.getEjecutarQuerry(this.getDBTransaction(),
               "select \n" + 
               "sum(horascontratadas) as horas\n" + 
               "from\n" + 
               "sis_contrato cnt\n" + 
               "where registro_empleado=" + this.getRegistroEmpleado()+" "+
               (this.getIdContrato()!=null?" and cnt.id_contrato<>"+this.getIdContrato()+ " ":" ")+
               "and estatus not in (11,15,83)\n" + 
               "and correlativo=" + utils.getAnioActual()+ " "+
               "and tipo_validez='I'\n" + 
               "and \n" + 
               "(\n" + 
               "("+ this.getOpcionIndef() + "=1 and nvl(cnt.opcion_indef,1) in (1,2,3))\n" + 
               "or (" + this.getOpcionIndef() + "=2  and nvl(cnt.opcion_indef,1) in (1,2))\n" + 
               "or (" + this.getOpcionIndef() + "=3  and nvl(cnt.opcion_indef,1) in (1,3))\n" + 
               ")\n" + 
               "and not\n" + 
               "exists(\n" + 
               "select 1 from sis_solicitud sol\n" + 
               "where sol.id_estado=39\n" + 
               "and sol.registro_empleado=cnt.registro_empleado\n" + 
               "and sol.ID_TIPO_SOLICITUD in (5,8)\n" + 
               "and sol.id_partida=cnt.id_partida\n" + 
               "and sol.id_puesto=cnt.id_puesto\n" + 
               "and sol.numero_plaza=cnt.numero_plaza\n" + 
               ") \n");
             
           if (vHorasIndef!=null && (Double.parseDouble(vHorasIndef.toString()) + this.getHorascontratadas().doubleValue()) > new Double("8").doubleValue()){
               
               throw new JboException("El total de horas en contratos indefinidos solo puede ser de máximo 8 horas. Por favor verifique");               
               
           }    
         } 
         }
       
    }
       
       //// validacion del complemento y escalafon

       if (this.getComplSal()!=null && this.getComplSal().compareTo(0)>0){
        Date vFechaFinTemp;
        vParametros=new NameValuePairs();        
       
       
            
             vParametros.setAttribute("id_partida",this.getIdPartida());
             vParametros.setAttribute("id_puesto",this.getIdPuesto());
             vParametros.setAttribute("numero_plaza",this.getNumeroPlaza());
             vParametros.setAttribute("correlativo",this.getCorrelativo());
             vParametros.setAttribute("monto",this.getComplSal());
             vParametros.setAttribute("fechaI", utils.getFechaFormato("dd/MM/yyyy",this.getFechaInicio()));
             
              if (this.getFechaFin()==null){
           
                vFechaFinTemp=this.getNoExcedaDe();
                if (vFechaFinTemp!=null)
                  vParametros.setAttribute("fechaF", utils.getFechaFormato("dd/MM/yyyy",vFechaFinTemp));
                else
                  vParametros.setAttribute("fechaF", null);
                  
              }else{
                  vFechaFinTemp=this.getFechaFin();
                  vParametros.setAttribute("fechaF", utils.getFechaFormato("dd/MM/yyyy",vFechaFinTemp));
              }
           
             
             
            
             vComple=utils_DB.getValorFuncion(this.getDBTransaction(),"sis_pkg_util.CHK_CMPL_ESCLF_PLAZA(?,?,?,?,1,?,to_date(?,'dd/mm/yyyy'),to_date(?,'dd/mm/yyyy'))",vParametros);
             
              if ( vComple==null || !vComple.equals("OK")){
                  
                  throw new JboException(vComple==null?"Ha ocurrido un error en la validación del complemento.":vComple.toString());
              }

       }
       
       
        if (this.getEscalaf()!=null && this.getEscalaf().compareTo(0)>0){
         Date vFechaFinTemp;
         vParametros=new NameValuePairs();        
        
        
             
              vParametros.setAttribute("id_partida",this.getIdPartida());
              vParametros.setAttribute("id_puesto",this.getIdPuesto());
              vParametros.setAttribute("numero_plaza",this.getNumeroPlaza());
              vParametros.setAttribute("correlativo",this.getCorrelativo());
              vParametros.setAttribute("monto",this.getEscalaf());
              vParametros.setAttribute("fechaI", utils.getFechaFormato("dd/MM/yyyy",this.getFechaInicio()));
              
               if (this.getFechaFin()==null){
            
                 vFechaFinTemp=this.getNoExcedaDe();
                 if (vFechaFinTemp!=null)
                   vParametros.setAttribute("fechaF", utils.getFechaFormato("dd/MM/yyyy",vFechaFinTemp));
                 else
                   vParametros.setAttribute("fechaF", null);
                   
               }else{
                   vFechaFinTemp=this.getFechaFin(); 
                   vParametros.setAttribute("fechaF", utils.getFechaFormato("dd/MM/yyyy",vFechaFinTemp));
               }
            
              
              
             
              vComple=utils_DB.getValorFuncion(this.getDBTransaction(),"sis_pkg_util.CHK_CMPL_ESCLF_PLAZA(?,?,?,?,2,?,to_date(?,'dd/mm/yyyy'),to_date(?,'dd/mm/yyyy'))",vParametros);
              
               if ( vComple==null || !vComple.equals("OK")){
                   
                   throw new JboException(vComple==null?"Ha ocurrido un error en la validación del escalafón.":vComple.toString());
               }

        }
        
        
    }

/*
 * 
 * Funcion para validar las fecha de incio y fin del contrato
 */
   private void validaFechaPlaza(Date data, int opcion){
       NameValuePairs vParametros;
       vParametros=new NameValuePairs();
       Object vPeriodoPlaza;
       String [] vDatosPlaza;
       Date vFechaInicio,vFechaFin;
       
       ValidacionFechaF=true;
       ValidacionFechaI=true;

       if (data!=null &&this.getIdPartida()!=null&&this.getIdPuesto()!=null&&this.getNumeroPlaza()!=null&&this.getCorrelativo()!=null){
           
           vParametros.setAttribute("id_partida",this.getIdPartida());
           vParametros.setAttribute("id_puesto",this.getIdPuesto());
           vParametros.setAttribute("numero_plaza",this.getNumeroPlaza());
           vParametros.setAttribute("correlativo",this.getCorrelativo());
           vParametros.setAttribute("fechaI",this.getFechaInicio());
           vParametros.setAttribute("fechaF",this.getFechaFin());
           if (this.getFechaCreacion()==null){
            vPeriodoPlaza=utils_DB.getValorFuncion(this.getDBTransaction(),"sis_pkg_util.getPeriodoPlaza2(?,?,?,?,?,?,null)",vParametros);            
           }
           else{
               vParametros.setAttribute("id_contrato",this.getIdContrato());
               vPeriodoPlaza=utils_DB.getValorFuncion(this.getDBTransaction(),"sis_pkg_util.getPeriodoPlaza2(?,?,?,?,?,?,?)",vParametros);
           }
           
           
           if (vPeriodoPlaza==null)
           {
           
               if (buscarPuestoExcluye(this.getIdPuesto().toString())){
                   vParametros.setAttribute("fechaF",null); 
                   
                   if (this.getFechaCreacion()==null)
                   {
                    vPeriodoPlaza=utils_DB.getValorFuncion(this.getDBTransaction(),"sis_pkg_util.getPeriodoPlaza2(?,?,?,?,?,?,null)",vParametros);
                   }
                   else
                   {
                       vParametros.setAttribute("id_contrato",this.getIdContrato());
                       vPeriodoPlaza=utils_DB.getValorFuncion(this.getDBTransaction(),"sis_pkg_util.getPeriodoPlaza2(?,?,?,?,?,?,?)",vParametros);
                   }
                   
               }else
               {
               
                   throw new JboException("La plaza no esta disponible para crear el contrato");
                   
               }
           
               
           }
           
           
           if (vPeriodoPlaza ==null) 
           {
               
               throw new JboException("La plaza no esta disponible para crear el contrato");
               
           }
           
           vDatosPlaza=vPeriodoPlaza.toString().split("\\|");
           
           vFechaInicio=utils.getFechaOracle(vDatosPlaza[0]);
           vFechaFin=utils.getFechaOracle(vDatosPlaza[1]);
           
           if (opcion==1){
               if (data.compareTo(vFechaInicio)<0){
                   throw new JboException("La fecha inicio es menor a la disponible de la plaza:" + vDatosPlaza[0]);
                  // ValidacionFechaI=false;
               }
               
                if (this.getFechaInicio().compareTo(vFechaFin)>0){
                       throw new JboException("La fecha inicio es mayor a la disponible de la plaza:" + vDatosPlaza[0]);
                     
                 }
                 
               if (!(this.getFechaInicio().compareTo(vFechaInicio)>=0 && this.getFechaInicio().compareTo(vFechaFin)<=0) && this.getFechaFin().compareTo(vFechaFin)<=0 ){
               
                   throw new JboException("Verifique la vigencia. La plaza esta disponible de" + vDatosPlaza[0] + " al " + vDatosPlaza[1] );
                   
               }
                 
           }else if(opcion==2 && isContratoIndef()==false) {
               if (data.compareTo(vFechaFin)>0){
                   throw new JboException("La fecha fin es mayor a la disponible de la plaza: " + vDatosPlaza[1]);             
                   //ValidacionFechaI=false;
               }       
           }else if (opcion==3)
           {
               if (this.getFechaInicio().compareTo(vFechaInicio)<0){
                   throw new JboException("La fecha inicio es menor a la disponible de la plaza:" + vDatosPlaza[0]);
                 
               }
               
               if (this.getFechaInicio().compareTo(vFechaFin)>0){
                   throw new JboException("La fecha inicio es mayor a la disponible de la plaza:" + vDatosPlaza[0]);
                 
               }
               
               
            
               if (this.getTipoValidez()==null || this.getTipoValidez().equals("N")) 
               {
                   if (this.getFechaFin()==null)
                   {
                       throw new JboException("Por favor ingrese la fecha fin");   
                   }
                   
                   if (!buscarPuestoExcluye(this.getIdPuesto().toString()))
                   {   
                   
                   if (isContratoIndef()==false && this.getFechaFin().compareTo(vFechaFin)>0)
                   {
                       throw new JboException("La fecha fin es mayor a la disponible de la plaza: " + vDatosPlaza[1]);   
                   
                   }
                }  
                   
              }
          }  
    
        
        if (this.getTipoValidez().equals("A") && vFechaFin!=null && this.getNoExcedaDe()!=null){
               
            if (this.getNoExcedaDe().compareTo(vFechaFin)>0){
               
                throw new JboException("La plaza esta disponible hasta: " + vFechaFin+ " verifique  Fecha No Exceda De");  
            }
               
        }
           
    
       }else if(data == null && opcion==1){ //La fecha de inicio viene nula
                  throw new JboException("Por favor ingrese la fecha de inicio del contrato.");   
       }else if(data==null && opcion==2 && isContratoIndef()==false){
                  throw new JboException("Por favor ingrese la fecha fin del contrato.");   
       }
       
       
       
   }


  public boolean isContratoIndef(){
     boolean vResultado=false; 
     Object vResultadoQuerry;
     
     if (this.getIdPartida()==null){
         throw new JboException("Por favor seleccione la plaza.");   
     }
     
     vResultadoQuerry=utils_DB.getEjecutarQuerry(this.getDBTransaction(),"select count(0) from sis_partida where id_partida=" + this.getIdPartida() + " and id_renglon=11");
     
        if (vResultadoQuerry!=null && vResultadoQuerry.toString().equals("1")){
         if (this.getTipoValidez()!=null && this.getTipoValidez().equals("I"))
         {
        
          vResultado=true;  
          
         }
        }
      
     return vResultado; 
  }
    /**Validation method for FechaInicio
     */
    public boolean validateFechaInicio(Date  data) { 
      //  validaFechaPlaza(data,1); 
      //  System.out.println("inicio");
        return ValidacionFechaI;
    }

    /**Validation method for FechaFin
     */
    public boolean validateFechaFin(Date  data) {
        //validaFechaPlaza(data,2);  
        //System.out.println("fin"); 
        return ValidacionFechaF;
    }


    public String validarCantidadHoras(){
        
        return "bien";
    }

    /**Gets the attribute value for IdContratoPadre, using the alias name IdContratoPadre
     */
    public Number getIdContratoPadre() {
        return (Number)getAttributeInternal(IDCONTRATOPADRE);
    }

    /**Sets <code>value</code> as the attribute value for IdContratoPadre
     */
    public void setIdContratoPadre(Number value) {
        setAttributeInternal(IDCONTRATOPADRE, value);
    }

    /**Gets the attribute value for ModPor1, using the alias name ModPor1
     */
    public String getModPor1() {
        return (String)getAttributeInternal(MODPOR1);
    }

    /**Sets <code>value</code> as the attribute value for ModPor1
     */
    public void setModPor1(String value) {
        setAttributeInternal(MODPOR1, value);
    }

    /**Gets the attribute value for FechaModificacion, using the alias name FechaModificacion
     */
    public Date getFechaModificacion() {
        return (Date)getAttributeInternal(FECHAMODIFICACION);
    }

    /**Sets <code>value</code> as the attribute value for FechaModificacion
     */
    public void setFechaModificacion(Date value) {
        setAttributeInternal(FECHAMODIFICACION, value);
    }

    /**Gets the attribute value for ObservFormaobtpuesto, using the alias name ObservFormaobtpuesto
     */
    public String getObservFormaobtpuesto() {
        return (String)getAttributeInternal(OBSERVFORMAOBTPUESTO);
    }

    /**Sets <code>value</code> as the attribute value for ObservFormaobtpuesto
     */
    public void setObservFormaobtpuesto(String value) {
        setAttributeInternal(OBSERVFORMAOBTPUESTO, value);
    }

    /**Gets the attribute value for HoraPosesion, using the alias name HoraPosesion
     */
    public String getHoraPosesion() {
        String vHoraPosesion=null;
        try{
                if (this.getFechaPosesion()!=null){
                    vHoraPosesion=utils.getFechaFormato("HH:mm",this.getFechaPosesion().getValue());
                        if (vHoraPosesion.equals("00:00")){
                            vHoraPosesion=null;
                        }
                }
        
        }catch(Exception exp){
            exp.printStackTrace();
        }

        return vHoraPosesion;
    }

    /**Sets <code>value</code> as the attribute value for HoraPosesion
     */
    public void setHoraPosesion(String value) {
        String vFechaPosesion;

        if (utils.isHora(value)){
            vFechaPosesion=utils.getFechaFormato("dd/MM/yyyy",this.getFechaPosesion().getValue());    
            vFechaPosesion+=" " + value;
            this.setFechaPosesion(utils.getFechaOracle("dd/MM/yyyy HH:mm",vFechaPosesion));
        }
        
          // setAttributeInternal(HORAPOSESION, value);

    }

    /**Gets the attribute value for ContractVacacion, using the alias name ContractVacacion
     */
    public Number getContractVacacion() {
        return (Number)getAttributeInternal(CONTRACTVACACION);
    }

    /**Sets <code>value</code> as the attribute value for ContractVacacion
     */
    public void setContractVacacion(Number value) {
        setAttributeInternal(CONTRACTVACACION, value);
    }

    /**Gets the attribute value for NomPlaza, using the alias name NomPlaza
     */
    public String getNomPlaza() {
        return (String)getAttributeInternal(NOMPLAZA);
    }

    /**Sets <code>value</code> as the attribute value for NomPlaza
     */
    public void setNomPlaza(String value) {
        setAttributeInternal(NOMPLAZA, value);
    }

    /**Gets the attribute value for Observhorario, using the alias name Observhorario
     */
    public String getObservhorario() {
        return (String)getAttributeInternal(OBSERVHORARIO);
    }

    /**Sets <code>value</code> as the attribute value for Observhorario
     */
    public void setObservhorario(String value) {
        setAttributeInternal(OBSERVHORARIO, value);
    }

    /**Gets the attribute value for ValHorario, using the alias name ValHorario
     */
    public Boolean getValHorario() {
    
      try{
        // no aplica para los vigilantes
        if (this.getIdPuesto().compareTo(141016)!=0  && this.getIdPuesto().compareTo(141017)!=0&&this.getIdPuesto().compareTo(141019)!=0){
           
           if (this.getnumHoras().doubleValue()!=utils.getNumberDouble(this.getHorascontratadas()==null?"0":this.getHorascontratadas().toString())*5){
             // throw new JboException("El número de horas del contrato no coincide con el de la plaza."); 
              return false;
               
           }
           
        }
        else  // para los vigilantes
        {
           if (this.getSisHorarioContrato().getRowCount()<=0){
               return false;
               
           }
           
        }
      }catch(Exception exep){
          
          return false;
      }
        
        return true;
        //return (Boolean)getAttributeInternal(VALHORARIO);
    }

    /**Sets <code>value</code> as the attribute value for ValHorario
     */
    public void setValHorario(Boolean value) {
        setAttributeInternal(VALHORARIO, value);
    }

    /**Gets the attribute value for FirmaJefeUnidad, using the alias name FirmaJefeUnidad
     */
    public String getFirmaJefeUnidad() {
    
        String vTemp=null;
        
        if (getAttributeInternal(FIRMAJEFEUNIDAD)!=null){
            vTemp=((String)getAttributeInternal(FIRMAJEFEUNIDAD)).replace("|","<br>");
        }
        
        return utils.getHTMLCode(vTemp);
    }

    /**Sets <code>value</code> as the attribute value for FirmaJefeUnidad
     */
    public void setFirmaJefeUnidad(String value) {
        //setAttributeInternal(FIRMAJEFEUNIDAD, utils.getHTMLDecode(value));
         if (value!=null && !value.equals(""))setAttributeInternal(FIRMAJEFEUNIDAD, utils.getHTMLDecode(value).replace("<br>","|"));
    }

    /**Gets the attribute value for FirmaJefeSubprog, using the alias name FirmaJefeSubprog
     */
    public String getFirmaJefeSubprog() {
    
        String vTemp=null;
        
        if (getAttributeInternal(FIRMAJEFESUBPROG)!=null){
            vTemp=((String)getAttributeInternal(FIRMAJEFESUBPROG)).replace("|","<br>");
        }
        
        return utils.getHTMLCode(vTemp);
    }

    /**Sets <code>value</code> as the attribute value for FirmaJefeSubprog
     */
    public void setFirmaJefeSubprog(String value) {
        if (value!=null && !value.equals("")) setAttributeInternal(FIRMAJEFESUBPROG, utils.getHTMLDecode(value).replace("<br>","|"));
    }

    /**Gets the attribute value for FirmaTesorero, using the alias name FirmaTesorero
     */
    public String getFirmaTesorero() {
        String vTemp=null;
        
        if (getAttributeInternal(FIRMATESORERO)!=null){
            vTemp=((String)getAttributeInternal(FIRMATESORERO)).replace("|","<br>");
        }
        
        return utils.getHTMLCode(vTemp);
    }

    /**Sets <code>value</code> as the attribute value for FirmaTesorero
     */
    public void setFirmaTesorero(String value) {
        if (value!=null && !value.equals(""))setAttributeInternal(FIRMATESORERO, utils.getHTMLDecode(value).replace("<br>","|"));
    }

    /**Gets the attribute value for AtribucionAnexo, using the alias name AtribucionAnexo
     */
    public ClobDomain getAtribucionAnexo() {
        return (ClobDomain)getAttributeInternal(ATRIBUCIONANEXO);
    }

    /**Sets <code>value</code> as the attribute value for AtribucionAnexo
     */
    public void setAtribucionAnexo(ClobDomain value) {
        setAttributeInternal(ATRIBUCIONANEXO, value);
    }

    /**Gets the attribute value for PrimerIngreso, using the alias name PrimerIngreso
     */
    public String getPrimerIngreso() {
        return (String)getAttributeInternal(PRIMERINGRESO);
    }

    /**Sets <code>value</code> as the attribute value for PrimerIngreso
     */
    public void setPrimerIngreso(String value) {
        setAttributeInternal(PRIMERINGRESO, value);
    }

    /**Gets the attribute value for TipoValidez, using the alias name TipoValidez
     */
    public String getTipoValidez() {
        return (String)getAttributeInternal(TIPOVALIDEZ);
    }

    /**Sets <code>value</code> as the attribute value for TipoValidez
     */
    public void setTipoValidez(String value) {
        setAttributeInternal(TIPOVALIDEZ, value);
    }

    /**Gets the attribute value for FechaFirma, using the alias name FechaFirma
     */
    public Date getFechaFirma() {
        return (Date)getAttributeInternal(FECHAFIRMA);
    }

    /**Sets <code>value</code> as the attribute value for FechaFirma
     */
    public void setFechaFirma(Date value) {
        setAttributeInternal(FECHAFIRMA, value);
    }

    /**Gets the attribute value for NoExcedaDe, using the alias name NoExcedaDe
     */
    public Date getNoExcedaDe() {
        return (Date)getAttributeInternal(NOEXCEDADE);
    }

    /**Sets <code>value</code> as the attribute value for NoExcedaDe
     */
    public void setNoExcedaDe(Date value) {
        setAttributeInternal(NOEXCEDADE, value);
    }

    /**Gets the attribute value for NumContratoFisico, using the alias name NumContratoFisico
     */
    public String getNumContratoFisico() {
        return (String)getAttributeInternal(NUMCONTRATOFISICO);
    }

    /**Sets <code>value</code> as the attribute value for NumContratoFisico
     */
    public void setNumContratoFisico(String value) {
        setAttributeInternal(NUMCONTRATOFISICO, value);
    }

    /**Gets the attribute value for TipoPago, using the alias name TipoPago
     */
    public Number getTipoPago() {
        return (Number)getAttributeInternal(TIPOPAGO);
    }

    /**Sets <code>value</code> as the attribute value for TipoPago
     */
    public void setTipoPago(Number value) {
        setAttributeInternal(TIPOPAGO, value);
    }

    /**Gets the attribute value for PagaBono, using the alias name PagaBono
     */
    public Number getPagaBono() {
        return (Number)getAttributeInternal(PAGABONO);
    }

    /**Sets <code>value</code> as the attribute value for PagaBono
     */
    public void setPagaBono(Number value) {
        setAttributeInternal(PAGABONO, value);
    }


    private boolean buscarPuestoExcluye(String pPuesto){
        
        Boolean vResultado=false;
        
        if (vPuestoExcluye==null)
           this.obtenerPuestosExcluye();           
                     
        if (vPuestoExcluye!=null && vPuestoExcluye.length>0){        
            
           for (int i=0;i<vPuestoExcluye.length;i++) {
               
               if (vPuestoExcluye[i].compareTo(pPuesto)==0){
                  vResultado=true;                           
                  break;
               }
               
           }
                   
        }
    return vResultado;  
    }


    /**Gets the attribute value for Provicionado, using the alias name Provicionado
     */
    public Number getProvicionado() {
        return (Number)getAttributeInternal(PROVICIONADO);
    }

    /**Sets <code>value</code> as the attribute value for Provicionado
     */
    public void setProvicionado(Number value) {
        setAttributeInternal(PROVICIONADO, value);
    }

    /**Gets the attribute value for IdPartidaProv, using the alias name IdPartidaProv
     */
    public Number getIdPartidaProv() {
        return (Number)getAttributeInternal(IDPARTIDAPROV);
    }

    /**Sets <code>value</code> as the attribute value for IdPartidaProv
     */
    public void setIdPartidaProv(Number value) {
        setAttributeInternal(IDPARTIDAPROV, value);
    }

    /**Gets the attribute value for FechaInicioDoc, using the alias name FechaInicioDoc
     */
    public Date getFechaInicioDoc() {
        return (Date)getAttributeInternal(FECHAINICIODOC);
    }

    /**Sets <code>value</code> as the attribute value for FechaInicioDoc
     */
    public void setFechaInicioDoc(Date value) {
        setAttributeInternal(FECHAINICIODOC, value);
    }

    /**Gets the attribute value for FechaFinDoc, using the alias name FechaFinDoc
     */
    public Date getFechaFinDoc() {
        return (Date)getAttributeInternal(FECHAFINDOC);
    }

    /**Sets <code>value</code> as the attribute value for FechaFinDoc
     */
    public void setFechaFinDoc(Date value) {
        setAttributeInternal(FECHAFINDOC, value);
    }

    /**Gets the attribute value for OpcionIndef, using the alias name OpcionIndef
     */
    public Number getOpcionIndef() {
        return (Number)getAttributeInternal(OPCIONINDEF);
    }

    /**Sets <code>value</code> as the attribute value for OpcionIndef
     */
    public void setOpcionIndef(Number value) {
        setAttributeInternal(OPCIONINDEF, value);
    }


    //Metodo para validad el aumento salarial
     private boolean isAumentoSalarial(){
       boolean vResultado=false; 
       /* Object vResultadoQuerry;
        
        //verifica si existe aumento salarial
        //El tipo (3) son plazas con id_programa (45, 46) donde la fecha inicio y fin son MENORES que el aumento.
        //Tipo (1) son todos los que tienen fecha_inicio es MAYOR que el aumento.
        String query = "SELECT CASE\n" + 
        " when pl.fecha_inicio is not null then 3 -- si es escala = 0 como viene de lo contrario verificar escala\n" + 
        " when to_date('"+utils.getFechaFormato("dd/MM/yyyy",this.getFechaInicio())+"','dd/mm/yyyy') > aum.fecha_inicio then 1 -- se queda como viene \n" + 
        " when to_date('"+utils.getFechaFormato("dd/MM/yyyy",this.getFechaInicio())+"','dd/mm/yyyy') < aum.fecha_inicio then 2 -- verificar si escala 0 o > 0 \n" + 
        " END AS aplicar \n" + 
        "FROM SIS_AUMENTO_SALARIAL AUM \n"+
        "left join (select pll.fecha_inicio, pll.fecha_fin, pll.id_partida, pll.id_puesto, pll.numero_plaza, pll.correlativo\n" + 
        "from sis_plaza pll\n" + 
        "inner join sis_partida pr on pr.id_partida = pll.id_partida\n" + 
        "where pr.ID_PROGRAMA in (45,46)) pl \n" + 
        "on pl.ID_PARTIDA = "+this.getIdPartida()+" and pl.id_puesto ="+this.getIdPuesto()+" and pl.NUMERO_PLAZA = "+this.getNumeroPlaza()+" and pl.CORRELATIVO = "+this.getCorrelativo()+" \n" + 
        "and pl.fecha_inicio < aum.fecha_inicio \n" + 
        "and pl.fecha_Fin < aum.fecha_inicio \n" +
         "where TO_CHAR(aum.fecha_inicio,'YYYY') = TO_CHAR(to_Date('"+utils.getFechaFormato("dd/MM/yyyy",this.getFechaInicio())+"','dd/mm/yyyy'),'YYYY') \n" + 
         "and to_date('"+utils.getFechaFormato("dd/MM/yyyy",this.getFechaInicio())+"','dd/mm/yyyy') < aum.fecha_inicio "+
        "and aum.id_estado in (106,103)"
        ;
        
        System.out.println(query);
       
        vResultadoQuerry=utils_DB.getEjecutarQuerry(this.getDBTransaction(),query);
        
           if (vResultadoQuerry!=null && !vResultadoQuerry.toString().equals("1")){
            String strTipo = vResultadoQuerry.toString();
           //Cambios porque la fecha inicial es menor al aumento salarial que se genero durante el año en consulta
           //Busca en historico puesto la fecha a la que pertenece el contrato que se esta creando para hacer el calculo del sueldo_Base y escalafon
            query = 
            "select (p.ESCALAMIN * pl.CANTIDAD_HORAS) as sueldo_Base , case when np.tipo = 'DOCENTE' THEN (p.escalafon * pl.cantidad_horas) else p.escalafon end escala\n" + 
            " from sis_plaza pl\n" + 
            " inner join sis_historico_puesto p on p.id_puesto = pl.id_puesto\n" + 
            " inner join sis_puesto pp on pp.id_puesto = p.id_puesto\n" + 
            " inner join sis_categoria_puesto cp on cp.ID_categoria = pp.ID_CATEGORIA\n" + 
            " inner join sis_nivel_puesto np on np.ID_NIVEL_PUESTO = cp.ID_NIVEL_PUESTO "+ 
            " where pl.ID_PARTIDA = "+this.getIdPartida()+" and pl.id_puesto ="+this.getIdPuesto()+" and pl.NUMERO_PLAZA = "+this.getNumeroPlaza()+" and pl.CORRELATIVO = "+this.getCorrelativo()+"\n" + 
            " and p.fecha_inicio <= to_date('"+utils.getFechaFormato("dd/MM/yyyy",this.getFechaInicio())+"','dd/mm/yyyy') and (p.fecha_fin >= to_date('"+utils.getFechaFormato("dd/MM/yyyy",this.getFechaInicio())+"','dd/mm/yyyy') or p.fecha_fin is null)"+"\n"
                    ;
              System.out.println(query);
               Object strEscala, strSueldoBase;
               strEscala = strSueldoBase = null;
               
               ResultSet fila = utils_DB.getEjecutarQuerry(this.getDBTransaction(), query, 0);
               try {
                          if(fila.next()){
                            strEscala = fila.getObject("escala");
                            //  System.out.println(strEscala);
                              
                            strSueldoBase = fila.getObject("sueldo_Base");
                             // System.out.println(strSueldoBase);
                              
                              if (strSueldoBase.toString().equals("0")){
                              
                              
                                if(!strTipo.equals("3")){
                              
                                query = "select ANT_SUELDO_BASE, escalafon as escala\n" + 
                                "from sis_plazas_fueracl_aumento\n" + 
                                  " where ID_PARTIDA = "+this.getIdPartida()+" and id_puesto ="+this.getIdPuesto()+" and NUMERO_PLAZA = "+this.getNumeroPlaza()+" and CORRELATIVO = "+this.getCorrelativo()+"\n" ;
                                  
                                  fila = utils_DB.getEjecutarQuerry(this.getDBTransaction(), query, 0);
                                  if(fila.next()){
                                      strEscala = fila.getObject("escala");
                                      strSueldoBase = fila.getObject("ANT_SUELDO_BASE");
                                  }
                                  this.setSueldobase(utils.getNumberOracle(strSueldoBase));
                                  //this.setEscalaf(utils.getNumberOracle(strEscala));
                                }
                                  
                              }else{
                                  this.setSueldobase(utils.getNumberOracle(strSueldoBase));
                                  this.setEscalaf(utils.getNumberOracle(strEscala));
                              }
                              
                          }
                          
                         
                          
               } catch (SQLException ex) {
                          ex.printStackTrace();
                      }
        
           
           }
         
        // System.out.println(this.getSueldobase());
        // System.out.println(this.getEscalaf());
        
        
        
        */
        
        NameValuePairs vParametros;
        vParametros=new NameValuePairs();
        Object vRes;
        String [] vDatosRes;
         Object strEscala, strSueldoBase, strtipo;
        
        
         if (this.getIdPartida()!=null&&this.getIdPuesto()!=null&&this.getNumeroPlaza()!=null&&this.getCorrelativo()!=null){
             vParametros.setAttribute("id_partida",this.getIdPartida());
             vParametros.setAttribute("id_puesto",this.getIdPuesto());
             vParametros.setAttribute("numero_plaza",this.getNumeroPlaza());
             vParametros.setAttribute("correlativo",this.getCorrelativo());
             vParametros.setAttribute("fechaI",this.getFechaInicio());
             vParametros.setAttribute("fechaF",this.getFechaFin());
             
             vRes=utils_DB.getValorFuncion(this.getDBTransaction(),"sis_pkg_util.getSalarioAumento(?,?,?,?,?,?)",vParametros);            
             vDatosRes = vRes.toString().split("\\|");
             
             strtipo = vDatosRes[0];
             strSueldoBase = vDatosRes[1];
             strEscala =  vDatosRes[2];
             
             if (strtipo.equals("3")){
                 throw new JboException("Error en sueldo base");  
             }else if (strtipo.equals("1")){ //se obtuvo el sueldo base por medio de sis_historico_puesto
                 this.setSueldobase(utils.getNumberOracle(strSueldoBase));
                 this.setEscalaf(utils.getNumberOracle(strEscala));
             }else if (strtipo.equals("4")){ //se obtuvo el sueldo base por medio de la tablota
                 this.setSueldobase(utils.getNumberOracle(strSueldoBase));
             }
             
         }
         
         
        
         
        return vResultado; 
     }

    /**Gets the attribute value for IdPartidaSicoin, using the alias name IdPartidaSicoin
     */
    public Number getIdPartidaSicoin() {
        return (Number)getAttributeInternal(IDPARTIDASICOIN);
    }

    /**Sets <code>value</code> as the attribute value for IdPartidaSicoin
     */
    public void setIdPartidaSicoin(Number value) {
        setAttributeInternal(IDPARTIDASICOIN, value);
    }

    /**Creates a Key object based on given key constituents
     */
    public static Key createPrimaryKey(Number idContrato) {
        return new Key(new Object[]{idContrato});
    }
}
