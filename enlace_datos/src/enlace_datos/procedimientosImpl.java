package enlace_datos;


import enlace_datos.common.procedimientos;

import enlace_datos.util.resulOp;
import enlace_datos.util.utils;

import java.math.BigDecimal;

import java.sql.CallableStatement;

import java.util.Date;

import oracle.jbo.server.ApplicationModuleImpl;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class procedimientosImpl extends ApplicationModuleImpl implements procedimientos {
    /**This is the default constructor (do not remove)
     */
    public procedimientosImpl() {
    }

    /**Sample main for debugging Business Components code using the tester.
     */
    public static void main(String[] args) {
        launchTester("enlace_datos", /* package name */
      "procedimientosLocal" /* Configuration Name */);
    }
    
    public resulOp generar_proceso(oracle.jbo.domain.Number pIdProceso,oracle.jbo.domain.Number pTipoProceso, oracle.jbo.domain.Number pPeriodo,String pObservaciones){
        String str_proc;
        resulOp vResultado=new resulOp();
        str_proc="call sis_pkg_calculos.crear_proceso(?,?,?,to_char(sysdate,'yyyy'),?,?)";
        CallableStatement cl_proc;
        try{
        cl_proc=this.getDBTransaction().createCallableStatement(str_proc,0);
        cl_proc.setBigDecimal(1,new BigDecimal(pIdProceso!=null?pIdProceso.toString():"0"));
        cl_proc.setInt(2,pTipoProceso.intValue());
        cl_proc.setInt(3,pPeriodo.intValue());
        cl_proc.setString(4,pObservaciones);
        cl_proc.setString(5,utils.getAuthUser(this.getDBTransaction()));
        cl_proc.execute();
        cl_proc.close();
        vResultado.setCodigoResultado(resulOp.OPE_OK);
        vResultado.setMensajeError("PROCESO EJECUTADO CORRECTAMENTE.");
        }catch(Exception exep){
            vResultado.setMensajeError(utils.getSQLMensaje(exep));
            vResultado.setCodigoResultado(resulOp.OPE_ERROR);
        }
      return vResultado;
    }
    
    
    public resulOp generar_pago(oracle.jbo.domain.Number pIdProceso){
        String str_proc;
        resulOp vResultado=new resulOp();
        str_proc="call sis_pkg_pagos.crear_pago(?)";
        CallableStatement cl_proc;
        if (pIdProceso!=null){
        try{
        cl_proc=this.getDBTransaction().createCallableStatement(str_proc,0);
        cl_proc.setObject(1,pIdProceso);      
        cl_proc.execute();
        //cl_proc.c
        cl_proc.close();
        vResultado.setCodigoResultado(resulOp.OPE_OK);
        vResultado.setMensajeError("Se ha realizado exitosamente la asignación de cheques y boletas. [ID:"+pIdProceso+"]");
        }catch(Exception exep){
            vResultado.setMensajeError(utils.getSQLMensaje(exep));
            vResultado.setCodigoResultado(resulOp.OPE_ERROR);
        }
        }
        else{
            vResultado.setCodigoResultado(resulOp.OPE_ERROR);
            vResultado.setMensajeError("INGRESE AL MENOS UN TIPO DE NOMINA");
        } 
      return vResultado;
    }
    
    
    
}
