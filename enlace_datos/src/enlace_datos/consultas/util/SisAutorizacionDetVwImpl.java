package enlace_datos.consultas.util;


import enlace_datos.ViewConsultaImpl;

import enlace_datos.consultas.util.common.SisAutorizacionDetVw;

import enlace_datos.myException;

import enlace_datos.util.utils;
import enlace_datos.util.utils_DB;

import oracle.jbo.JboException;
import oracle.jbo.NameValuePairs;
import oracle.jbo.server.ViewObjectImpl;
import oracle.jbo.domain.Number;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class SisAutorizacionDetVwImpl extends ViewConsultaImpl implements SisAutorizacionDetVw {
    /**This is the default constructor (do not remove)
     */
    public SisAutorizacionDetVwImpl() {
        super.setVerificarParam(true);
    }
    
    public void CambiarEstadoGestion(String pUsuario,Number pIdAutorizacion,Number pNuevoEstado, String pComentario,String pGestion,Number pIdGestion){
        
        Number vIdAutorizacion;
        oracle.jbo.DMLException vCausa;
        Object []vExceptions;
        if (pNuevoEstado!=null){
        
          if (pIdAutorizacion==null){
              NameValuePairs vPara= new NameValuePairs();
              Object vValorFuncion;
              String sqlQuerry;
              vPara.setAttribute("1",pUsuario);
              vPara.setAttribute("2",pIdGestion);
              vPara.setAttribute("3",pNuevoEstado);
              vPara.setAttribute("4",pGestion);
              vPara.setAttribute("5","NO");
              
                  
             // sqlQuerry="select max(id_autorizacion) from sis_autorizacion where id_solicitud="+pIdGestion;
              
              sqlQuerry="select sis_autorizacion_sq.currval from dual";

              vValorFuncion=utils_DB.getValorFuncion2(this.getDBTransaction(),"sis_pkg_util.getNumeroAutorizacion(?,?,?,?,?)",vPara,sqlQuerry);
              
              vIdAutorizacion=utils.getNumberOracle(vValorFuncion);
          }else 
          {
              
              vIdAutorizacion=pIdAutorizacion;
          }
          
          
          try{
          
              
            SisAutorizacionDetVwRowImpl NuevaFila;
            NuevaFila=(SisAutorizacionDetVwRowImpl)this.createRow();
            NuevaFila.setUsuario(pUsuario);
            NuevaFila.setIdEstado(pNuevoEstado);
            NuevaFila.setIdAutorizacion(vIdAutorizacion);
            NuevaFila.setComentario(pComentario);
            this.getDBTransaction().commit();
            
          }catch(Exception exp){
              
             // throw new JboException(utils.getSQLMensaje(exp));              
              this.getDBTransaction().rollback();
              if (exp.getClass()==oracle.jbo.DMLException.class){
                  vCausa=(oracle.jbo.DMLException)exp;    
                  vExceptions=vCausa.getExceptions();    
              }else{
                  vExceptions= new Object[]{exp};
              }
         
               if (vExceptions.length>0){
                    throw new JboException(utils.getSQLMensaje((Exception)vExceptions[0]));              
                   
               }   
              
          }
            
        }else {
            throw new JboException("Seleccione un estado"); 
        }
    }
    
}
