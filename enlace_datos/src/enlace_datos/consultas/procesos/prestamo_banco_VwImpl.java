package enlace_datos.consultas.procesos;

import enlace_datos.consultas.procesos.common.prestamo_banco_Vw;

import enlace_datos.util.utils;
import enlace_datos.util.utils_DB;

import java.sql.CallableStatement;

import oracle.jbo.JboException;
import oracle.jbo.domain.Date;
import oracle.jbo.server.ViewObjectImpl;

import oracle.jdbc.OracleTypes;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class prestamo_banco_VwImpl extends ViewObjectImpl implements prestamo_banco_Vw {
    /**This is the default constructor (do not remove)
     */
     
    private  String vPeriodoGL=null;
    private  Boolean vHabilitadoGL=null;
     
    public prestamo_banco_VwImpl() {
    }

    /**Gets the bind variable value for fechaI
     */
    public Date getfechaI() {
        return (Date)getNamedWhereClauseParam("fechaI");
    }

    /**Sets <code>value</code> for bind variable fechaI
     */
    public void setfechaI(Date value) {
        setNamedWhereClauseParam("fechaI", value);
    }

    /**Gets the bind variable value for fechaF
     */
    public Date getfechaF() {
        return (Date)getNamedWhereClauseParam("fechaF");
    }

    /**Sets <code>value</code> for bind variable fechaF
     */
    public void setfechaF(Date value) {
        setNamedWhereClauseParam("fechaF", value);
    }
    
    
    public void AnularCarga(oracle.jbo.domain.Number pIdCarga){
        
        CallableStatement cs=null;
        try{
        
            cs =this.getDBTransaction().createCallableStatement("CALL sis_pkg_carga_datos_externos.BORRARCARGAPRESTAMOSBANCOS(?)",0); 
            cs.setLong(1,pIdCarga.longValue());
            cs.execute();
            this.getDBTransaction().commit();
            cs.close();
            
        }catch(Exception exep){
            //exep.printStackTrace();           
           try{
            cs.close();
           }catch(Exception exep2){
               
           }
           throw new JboException(utils.getSQLMensaje(exep));
        }
        
    }

public void filtrarAccesoUsuario(String pUsuario,String pIdTipoCarga)
{
    
  if (pIdTipoCarga!=null && !pIdTipoCarga.equals(""))
  {
  
    this.setWhereClause("id_origen_carga_archivo="+pIdTipoCarga);      
      
  }else {
  
    this.setWhereClause("");
    
  }
   
 this.executeQuery();  
    
}


public boolean CargaHabilitada(){
 
 Object vResultado;   
 boolean vHabilitado=false;
 
 
 if (vHabilitadoGL==null)
 {
 
     System.out.println("ejecutando");
 vResultado=utils_DB.getEjecutarQuerry(this.getDBTransaction(),"select count(0) as habilitado from  sis_calendario_actividad where id_tipo_actividad=1 and sysdate between fecha_inicio and nvl(fecha_finalizacion,trunc(sysdate))+1");
 
 if (vResultado!=null){
     if (!vResultado.toString().equals("0")){
         vHabilitado=true;
     }
     
 }
 
     vHabilitadoGL=vHabilitado;
 }
return vHabilitadoGL;    
}


public String getPeriodoCarga(){
    
    Object vResultado;
    String vPeriodo;
    
    if (vPeriodoGL==null){
    
    //    System.out.println("ejecutando2");
    
    vResultado=utils_DB.getEjecutarQuerry(this.getDBTransaction(),"select 'del '||to_char(fecha_inicio,'dd/mm/yyyy')||' al '|| to_char(fecha_finalizacion,'dd/mm/yyyy') as periodo  from  sis_calendario_actividad where id_tipo_actividad=1 and sysdate between fecha_inicio and nvl(fecha_finalizacion,trunc(sysdate))+1 and rownum<=1 order by fecha_inicio asc");
    
    if (vResultado!=null && !vResultado.toString().equals("")){
        
        vPeriodo="Periodo de carga "+vResultado.toString();
        
    }else{
        
        vPeriodo="No hay periodos de carga habilitados" ;
        
    }
        
    vPeriodoGL=vPeriodo;
    }
   return vPeriodoGL; 
}

    
}
