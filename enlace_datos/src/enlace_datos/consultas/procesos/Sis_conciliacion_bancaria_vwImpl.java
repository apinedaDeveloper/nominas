package enlace_datos.consultas.procesos;

import enlace_datos.consultas.procesos.common.Sis_conciliacion_bancaria_vw;

import enlace_datos.util.utils_DB;

import java.sql.CallableStatement;

import oracle.jbo.JboException;
import oracle.jbo.domain.Date;
import oracle.jbo.domain.Number;
import oracle.jbo.server.ViewObjectImpl;

import oracle.jdbc.OracleTypes;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class Sis_conciliacion_bancaria_vwImpl extends ViewObjectImpl implements Sis_conciliacion_bancaria_vw {
    /**This is the default constructor (do not remove)
     */
    public Sis_conciliacion_bancaria_vwImpl() {
    }

    /**Gets the bind variable value for pFechaI
     */
    public Date getpFechaI() {
        return (Date)getNamedWhereClauseParam("pFechaI");
    }

    /**Sets <code>value</code> for bind variable pFechaI
     */
    public void setpFechaI(Date value) {
        setNamedWhereClauseParam("pFechaI", value);
    }

    /**Gets the bind variable value for pFechaF
     */
    public Date getpFechaF() {
        return (Date)getNamedWhereClauseParam("pFechaF");
    }

    /**Sets <code>value</code> for bind variable pFechaF
     */
    public void setpFechaF(Date value) {
        setNamedWhereClauseParam("pFechaF", value);
    }
    
    public void ProcesarConciliacionBancaria(Number pIdCarga){
        
        CallableStatement cs;
        long cantidad_error_proc=0;
        Object vYaEjecutado;
        
        vYaEjecutado=utils_DB.getEjecutarQuerry(this.getDBTransaction(),"select count(0) from sis_carga_archivo_datos where id_carga_archivo_datos="+ pIdCarga + " and estado='1'");
        if (vYaEjecutado!=null && vYaEjecutado.toString().equals("1")){
          throw new JboException("Ya fué ejecutado el proceso, por favor verifique.");
        }
        
        try{
        
            cs =this.getDBTransaction().createCallableStatement("CALL SIS_PKG_CARGA_DATOS_EXTERNOS.CARGARCONCILIACIONBANCARIA(?,?)",0); 
            cs.setLong(1,pIdCarga.longValue());
            cs.registerOutParameter(2,OracleTypes.NUMBER);
            cs.execute();
            cantidad_error_proc=cs.getLong(2);  //Obteniendo la cantidad de registros con error no procesados
            cs.close();
            
        }catch(Exception exep){
          exep.printStackTrace(); 
          throw new JboException("Ha ocurrido un error inesperado en la ejecución del proceso.");

        }
        return ;
    }
    
}
