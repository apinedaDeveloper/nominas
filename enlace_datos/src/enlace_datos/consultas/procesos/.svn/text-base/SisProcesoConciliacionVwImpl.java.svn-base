package enlace_datos.consultas.procesos;

import enlace_datos.consultas.procesos.common.SisProcesoConciliacionVw;

import enlace_datos.util.utils;

import enlace_datos.util.utils_DB;

import oracle.jbo.JboException;
import oracle.jbo.NameValuePairs;
import oracle.jbo.server.ViewObjectImpl;
import oracle.jbo.domain.Number;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class SisProcesoConciliacionVwImpl extends ViewObjectImpl implements SisProcesoConciliacionVw {
    /**This is the default constructor (do not remove)
     */
    public SisProcesoConciliacionVwImpl() {
    }
    
    
    public void crear_nuevo_det(String pUsuario){
        
        SisProcesoConciliacionVwRowImpl vFila;
        vFila= (SisProcesoConciliacionVwRowImpl)this.createRow();        
        vFila.setAnio( utils.getNumberOracle(utils.getAnioActual()));
        vFila.setMes(utils.getNumberOracle(utils.getMesActual()));    
        vFila.setCreadoPor(pUsuario);
        this.insertRow(vFila);
        
        
    }
    
   /*
    * 
    */
   public void procesar_conciliacion(Number pIdConciliacion)
   {
       
      boolean vResultado;   
      NameValuePairs vParametros;
      vParametros= new NameValuePairs();
      
      vParametros.setAttribute("1",pIdConciliacion);        
      //vResultado=false;
      vResultado=utils_DB.ejecutarProcedimiento(this.getDBTransaction(),"sis_pkg_procs.GEN_CONCILIA_PAGO(?,1)",vParametros); 
      
      
     // System.out.println(" debug  "+ pIdConciliacion);
      
      if (vResultado==false){
         this.getDBTransaction().rollback();
         throw new JboException("Ha ocurrido un error, por favor revisar");
         
      }else{
      
         this.getDBTransaction().commit();
         
      }
       

  }
  
  
  public void dar_visto_bueno(Number pIdConciliacion){
      
      int vResultado;   
      NameValuePairs vParametros;
      vParametros= new NameValuePairs();
      
      vParametros.setAttribute("1",pIdConciliacion);        
      vResultado=0;
      vResultado=utils_DB.getEjecutarConsulta(this.getDBTransaction(),"update sis_proceso_conciliacion set usuario_ok='" +utils.getAuthUser(this.getDBTransaction()) + "', fecha_ok=sysdate where id_proceso_conciliacion="+pIdConciliacion+" and fecha_ok is null"); 
                  
      if (vResultado==0){
         this.getDBTransaction().rollback();
         throw new JboException("Ha ocurrido un error, por favor revisar");
         
      }else{
      
         this.getDBTransaction().commit();
         
      }
          
      
  }


    /**Gets the bind variable value for pTipoReporte
     */
    public String getpTipoReporte() {
        return (String)getNamedWhereClauseParam("pTipoReporte");
    }

    /**Sets <code>value</code> for bind variable pTipoReporte
     */
    public void setpTipoReporte(String value) {
        setNamedWhereClauseParam("pTipoReporte", value);
    }
}
