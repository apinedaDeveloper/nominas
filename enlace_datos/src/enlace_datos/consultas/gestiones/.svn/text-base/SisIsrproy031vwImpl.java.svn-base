package enlace_datos.consultas.gestiones;

import enlace_datos.consultas.complementos.SisComplementoVwRowImpl;
import enlace_datos.consultas.gestiones.common.SisIsrproy031vw;

import enlace_datos.util.utils;

import oracle.jbo.NameValuePairs;
import oracle.jbo.server.ViewObjectImpl;
import enlace_datos.util.utils_DB;

import oracle.jbo.JboException;
import oracle.jbo.domain.Number;

// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class SisIsrproy031vwImpl extends ViewObjectImpl implements SisIsrproy031vw {
    /**This is the default constructor (do not remove)
     */
    public SisIsrproy031vwImpl() {
    }


    public void getFiltrar_Planillas(String pEstado, String pUsuario){
        String str_querry="";
        if (pEstado!=null){
            str_querry=" id_estado in (" + pEstado + ")";
            str_querry+=" AND DOC_PENDIENTE_ANIO IS NOT NULL AND DOC_PENDIENTE_NUMERO IS NOT NULL AND NUMERO_CHEQUE IS NOT NULL";
            str_querry+=" AND ( TO_DATE(SYSDATE, 'dd/mm/yyyy' ) - TO_DATE(FECHA_CREACION, 'dd/mm/yyyy')) <= 365";
        }
        if (str_querry.length()>1){  
            this.setWhereClause(str_querry);
        } else {
            this.setWhereClause("");
        }
        this.setpUsuario(pUsuario);
        this.executeQuery(); 
    }
    
    //Método obtiene los registros por filtro de búsqueda.
    public void getFiltrar_Planillas_Filtro_Busqueda(String pEstado, String pUsuario, Number idPlanilla, String numCheque, Number anioPago, Number mesPago){
        String str_querry="";
        if ( pEstado!= null ) {
            str_querry=" id_estado in (" + pEstado + ")";
            str_querry+=" AND DOC_PENDIENTE_ANIO IS NOT NULL AND DOC_PENDIENTE_NUMERO IS NOT NULL AND NUMERO_CHEQUE IS NOT NULL";
        }
        if ( idPlanilla!= null ) {
            if ( str_querry=="" ) {
                str_querry=" id_isr = " + idPlanilla;
            } else {
                str_querry+=" AND id_isr = " + idPlanilla;
            }
        }
        if ( numCheque!= null && numCheque.equalsIgnoreCase("")==false) {
            if ( str_querry=="" ) {
                str_querry=" numero_cheque in ('" + numCheque + "')";
            } else {
                str_querry+=" AND numero_cheque in ('" + numCheque + "')";
            }
        }
        if ( anioPago!= null ) {
            if ( str_querry=="" ) {
                str_querry=" anio_pago = " + anioPago;
            } else {
                str_querry+=" AND anio_pago = " + anioPago;
            }
        }
        if ( mesPago!= null ) {
            if ( str_querry=="" ) {
                str_querry=" periodo = " + mesPago;
            } else {
                str_querry+=" AND periodo = " + mesPago;
            }
        }
        if (str_querry.length()>1){  
            this.setWhereClause(str_querry);
        } else {
            this.setWhereClause("");
        }
        //System.out.println("La clausula where es: " + str_querry);
        this.setpUsuario(pUsuario);
        this.executeQuery();
    }

    public void getFiltrar_PlaniXUsuario(String pEstado, String pUsuario){
        //String str_querry="";
        
        this.setWhereClause("");
        this.setpUsuario(pUsuario);
        this.executeQuery(); 
        //System.out.println("Si pase x mi filtro");
    }

    public void generarDescuentoISR(Number pIdIsr){
        boolean vResultado; 
        NameValuePairs Parametros=new NameValuePairs();
        Parametros.setAttribute("1",pIdIsr);
        vResultado=utils_DB.ejecutarProcedimiento(this.getDBTransaction()," sis_pkg_calculos_isr.CALCULOS_ISR_CONTRATO031(?)",Parametros); 
               
       if (vResultado==false){
          this.getDBTransaction().rollback();
          throw new JboException("Ha ocurrido un error, por favor revisar");
       }else{
          this.getDBTransaction().commit();
       }
    }    

    public void genDetallePlanilla(Number pIdIsr, Number pAnioPago, Number pPeriodo, Number pDep, Number pIdPartida, Number pIdTipoNomina){
        boolean vResultado; 
        NameValuePairs Parametros=new NameValuePairs();
        Parametros.setAttribute("1",pIdIsr);
        Parametros.setAttribute("2",pAnioPago);
        Parametros.setAttribute("3",pPeriodo);
        Parametros.setAttribute("4",pDep);
        Parametros.setAttribute("5",pIdPartida);
        Parametros.setAttribute("6",pIdTipoNomina);
        //System.out.println("pIdIsr:="+pIdIsr+", pAnioPago:="+pAnioPago+", pPeriodo:="+pPeriodo
        //+", pDep:="+pDep+", pIdPartida:="+pIdPartida+", pIdTipoNomina:="+pIdTipoNomina);
        vResultado=utils_DB.ejecutarProcedimiento(this.getDBTransaction(),"SIS_PKG_CALCULOS.generarPlanilla031(?,?,?,?,?,?)",Parametros); 
               
        if (vResultado==false){
          this.getDBTransaction().rollback();
          throw new JboException("Ha ocurrido un error, por favor revisar");
        }else{
            //System.out.println("todo nais");
          this.getDBTransaction().commit();
        }
    }    

    public void RefrescarPlanilla(Number pIdIsr){
        String str_querry="";
        
        if (pIdIsr!=null){
            str_querry=" id_isr="+pIdIsr;
        }
        System.out.println(str_querry);
        if (str_querry.length()>1){  
            this.setWhereClause(str_querry);
        } else {
            this.setWhereClause("");
        }
        this.executeQuery(); 
    }

    public void crearPlanilla031(Number pIdDep, Number pIdPartida, Number pAnioPago,Number pPeriodo, Number pTipoNomina, String pUsuario){
        SisIsrproy031vwRowImpl pFila;
        pFila=(SisIsrproy031vwRowImpl)this.createRow();   
        Object pIdIsr;
        
        pFila.setAnio(pAnioPago);
        pFila.setIdDependencia(pIdDep);
        pFila.setIdPartida(pIdPartida);
        pFila.setAnioPago(pAnioPago);
        pFila.setPeriodo(pPeriodo);
        pFila.setCreadoPor(pUsuario);
        pFila.setIdTipoNomina(pTipoNomina);
        pFila.setIdEstado(utils.getNumberOracle("235"));

        pIdIsr=utils_DB.getEjecutarQuerry(this.getDBTransaction(),"select Sis_IsrProy031_sq.nextval from dual");
        
        if (pIdIsr!=null){         
            pFila.setIdIsr( utils.getNumberOracle(pIdIsr) );
        }
        this.insertRow(pFila);
        
    }


    /**Gets the bind variable value for pUsuario
     */
    public String getpUsuario() {
        return (String)getNamedWhereClauseParam("pUsuario");
    }

    /**Sets <code>value</code> for bind variable pUsuario
     */
    public void setpUsuario(String value) {
        setNamedWhereClauseParam("pUsuario", value);
    }
}
