package enlace_datos.consultas.gestiones;

import enlace_datos.ViewConsultaImpl;

import enlace_datos.consultas.gestiones.common.SisSolicitudVw;

import enlace_datos.util.utils;
import enlace_datos.util.utils_DB;

import java.sql.ResultSet;

import oracle.jbo.JboException;
import oracle.jbo.NameValuePairs;
import oracle.jbo.Row;
import oracle.jbo.domain.Date;
import oracle.jbo.domain.Number;
import oracle.jbo.server.ViewObjectImpl;
import oracle.jbo.server.ViewRowImpl;


// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class SisSolicitudVwImpl extends ViewConsultaImpl implements SisSolicitudVw {
    /**This is the default constructor (do not remove)
     */
    private String vConsultaOrig;
    private boolean vCambiarQuerry;

    public SisSolicitudVwImpl() {

        super.setVerificarParam(true);
        vCambiarQuerry = false;
    }

    /**Gets the bind variable value for reg_empleado
     */
    public Number getreg_empleado() {
        return (Number)getNamedWhereClauseParam("reg_empleado");
    }

    /**Sets <code>value</code> for bind variable reg_empleado
     */
    public void setreg_empleado(Number value) {
        setNamedWhereClauseParam("reg_empleado", value);
    }


    /**hasNextForCollection - overridden for custom java data source support.
     */
    protected boolean hasNextForCollection(Object qc) {
        boolean bRet = super.hasNextForCollection(qc);
        return bRet;
    }

    /**createRowFromResultSet - overridden for custom java data source support.
     */
    protected ViewRowImpl createRowFromResultSet(Object qc, 
                                                 ResultSet resultSet) {
        ViewRowImpl value = super.createRowFromResultSet(qc, resultSet);
        return value;
    }

    /**getEstimatedRowCount - overridden for custom java data source support.
     */
    public long getEstimatedRowCount() {
        long value = super.getEstimatedRowCount();
        return value;
    }

    /**Gets the bind variable value for fechaI
     */
    public Date getfechaI() {
        return (Date)getNamedWhereClauseParam("fechaI");
    }

    /**Sets <code>value</code> for bind variable fechaI
     */
    public void setfechaI(Date value) {
        setNamedWhereClauseParam("fechaI", value);
    }

    /**Gets the bind variable value for fechaF
     */
    public Date getfechaF() {
        return (Date)getNamedWhereClauseParam("fechaF");
    }

    /**Sets <code>value</code> for bind variable fechaF
     */
    public void setfechaF(Date value) {
        setNamedWhereClauseParam("fechaF", value);
    }

    public void crearSolicitud(String vTipo, Number vRegistroEmpleado, 
                               Number vIdContrato, String vCreadoPor) {
        SisSolicitudVwRowImpl vFila = null;
        SisDetLicenciaVwRowImpl vfila2 = null;
        SisSuspencionIgssRowImpl vfila3 = null;
        NameValuePairs vAtributos = new NameValuePairs();
        this.getDBTransaction().rollback();

        try {
            if (vTipo.equals("LICENCIA")) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("IdContrato", vIdContrato);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                vFila = (SisSolicitudVwRowImpl)this.getCurrentRow();

                vAtributos = new NameValuePairs();
                vAtributos.setAttribute("AyudaBecaria", "NO");
                vAtributos.setAttribute("Prorroga", "NO");
                vfila2 = 
                        (SisDetLicenciaVwRowImpl)vFila.getSisDetLicenciaVw().createAndInitRow(vAtributos);
                vFila.getSisDetLicenciaVw().insertRow(vfila2);
            } else if (vTipo.equals("SUSPENSION IGSS") || 
                       vTipo.equals("ALTA SUSPENSION IGSS")) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("IdContrato", vIdContrato);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                vFila = (SisSolicitudVwRowImpl)this.getCurrentRow();
                if (vTipo.equals("ALTA SUSPENSION IGSS")) {
                    vAtributos.clear();
                    vAtributos.setAttribute("IdTipoSuspencionIgss", 
                                            new Number(4));
                    vFila.getSisSuspencionIgss().insertRow(vFila.getSisSuspencionIgss().createAndInitRow(vAtributos));
                    //vfila3=(SisSuspencionIgssRowImpl)vFila.getSisSuspencionIgss().getCurrentRow();   
                    // vfila3.setIdTipoSuspencionIgss(new Number(4)); //tipo alta
                } else {
                    vFila.getSisSuspencionIgss().insertRow(vFila.getSisSuspencionIgss().createRow());
                }
            } else if (vTipo.equals("DESCUENTO JUDICIAL")) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                vFila = (SisSolicitudVwRowImpl)this.getCurrentRow();
                vFila.getview_orden_judicial().insertRow(vFila.getview_orden_judicial().createRow());
            } else if (vTipo.equals("DEUDORES")) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                vFila = (SisSolicitudVwRowImpl)this.getCurrentRow();
                vFila.getSis_deudores_vw().insertRow(vFila.getSis_deudores_vw().createRow());
            } else if (vTipo.equals("RETIRO OBLIGATORIO")) {
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                //vAtributos.setAttribute("IdContrato",vIdContrato);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
            } else if (vTipo.equals("FALLECIMIENTO")) {
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                //vAtributos.setAttribute("IdContrato",vIdContrato);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
            } else {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("IdContrato", vIdContrato);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);

            }
        } catch (Exception exep) {
            exep.printStackTrace();
        }
    }


    public void crearSolicitud2(String vTipo, Number vRegistroEmpleado, 
                                Number vIdContrato, String vCreadoPor, 
                                Number vAnio) {
        SisSolicitudVwRowImpl vFila = null;
        SisDetLicenciaVwRowImpl vfila2 = null;
        SisSuspencionIgssRowImpl vfila3 = null;
        NameValuePairs vAtributos = new NameValuePairs();
        this.getDBTransaction().rollback();

        try {
            if (vTipo.equals("LICENCIA")) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("IdContrato", vIdContrato);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("Anio", vAnio);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                vFila = (SisSolicitudVwRowImpl)this.getCurrentRow();

                vAtributos = new NameValuePairs();
                vAtributos.setAttribute("AyudaBecaria", "NO");
                vAtributos.setAttribute("Prorroga", "NO");
                vfila2 = 
                        (SisDetLicenciaVwRowImpl)vFila.getSisDetLicenciaVw().createAndInitRow(vAtributos);
                vFila.getSisDetLicenciaVw().insertRow(vfila2);
            } else if (vTipo.equals("SUSPENSION IGSS") || 
                       vTipo.equals("ALTA SUSPENSION IGSS")) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("IdContrato", vIdContrato);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("Anio", vAnio);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                vFila = (SisSolicitudVwRowImpl)this.getCurrentRow();
                if (vTipo.equals("ALTA SUSPENSION IGSS")) {
                    vAtributos.clear();
                    vAtributos.setAttribute("IdTipoSuspencionIgss", 
                                            new Number(4));
                    vFila.getSisSuspencionIgss().insertRow(vFila.getSisSuspencionIgss().createAndInitRow(vAtributos));
                    //vfila3=(SisSuspencionIgssRowImpl)vFila.getSisSuspencionIgss().getCurrentRow();   
                    // vfila3.setIdTipoSuspencionIgss(new Number(4)); //tipo alta
                } else {
                    vFila.getSisSuspencionIgss().insertRow(vFila.getSisSuspencionIgss().createRow());
                }
            }else if (vTipo.equals("BAJA SUPENCION LABORAL") ) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("IdContrato", vIdContrato);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("IdTipoSolicitud", "-1");
                vAtributos.setAttribute("Anio", vAnio);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                vFila = (SisSolicitudVwRowImpl)this.getCurrentRow();
             
            } 
            else if (vTipo.equals("DESCUENTO JUDICIAL")) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("Anio", vAnio);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                vFila = (SisSolicitudVwRowImpl)this.getCurrentRow();
                vFila.getview_orden_judicial().insertRow(vFila.getview_orden_judicial().createRow());
            } else if (vTipo.equals("DEUDORES")) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("Anio", vAnio);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                vFila = (SisSolicitudVwRowImpl)this.getCurrentRow();
                vFila.getSis_deudores_vw().insertRow(vFila.getSis_deudores_vw().createRow());
            } else {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("IdContrato", vIdContrato);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("Anio", vAnio);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);

            }
        } catch (Exception exep) {
            exep.printStackTrace();
        }
    }


    public void crearSolicitud3(String vTipo, Number vRegistroEmpleado, 
                                Number vIdContrato, Number pIdPartida, 
                                Number pIdPuesto, Number pNumeroPlaza, 
                                Number vAnio, String vCreadoPor, 
                                String vOrigen) {
        SisSolicitudVwRowImpl vFila = null;
        SisDetLicenciaVwRowImpl vfila2 = null;
        SisSuspencionIgssRowImpl vfila3 = null;
        SisPromReclafViewRowImpl vFila4 = null;
        NameValuePairs vAtributos = new NameValuePairs();
        Number vIdSolicitud, vIdPromReclaf;

        this.getDBTransaction().rollback();

        try {
            if (vTipo.equals("LICENCIA")) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("IdContrato", vIdContrato);
                vAtributos.setAttribute("IdPartida", pIdPartida);
                vAtributos.setAttribute("IdPuesto", pIdPuesto);
                vAtributos.setAttribute("NumeroPlaza", pNumeroPlaza);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("Anio", vAnio);
                vAtributos.setAttribute("Origen", vOrigen);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                vFila = (SisSolicitudVwRowImpl)this.getCurrentRow();

                vAtributos = new NameValuePairs();
                vAtributos.setAttribute("AyudaBecaria", "NO");
                vAtributos.setAttribute("Prorroga", "NO");
                vfila2 = 
                        (SisDetLicenciaVwRowImpl)vFila.getSisDetLicenciaVw().createAndInitRow(vAtributos);
                vFila.getSisDetLicenciaVw().insertRow(vfila2);
            } else if (vTipo.equals("SUSPENSION IGSS") || 
                       vTipo.equals("ALTA SUSPENSION IGSS")) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("IdContrato", vIdContrato);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("Anio", vAnio);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                vFila = (SisSolicitudVwRowImpl)this.getCurrentRow();
                if (vTipo.equals("ALTA SUSPENSION IGSS")) {
                    vAtributos.clear();
                    vAtributos.setAttribute("IdTipoSuspencionIgss", 
                                            new Number(4));
                    vFila.getSisSuspencionIgss().insertRow(vFila.getSisSuspencionIgss().createAndInitRow(vAtributos));
                    //vfila3=(SisSuspencionIgssRowImpl)vFila.getSisSuspencionIgss().getCurrentRow();   
                    // vfila3.setIdTipoSuspencionIgss(new Number(4)); //tipo alta
                } else {
                    vFila.getSisSuspencionIgss().insertRow(vFila.getSisSuspencionIgss().createRow());
                }
            } else if (vTipo.equals("DESCUENTO JUDICIAL")) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("Anio", vAnio);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                vFila = (SisSolicitudVwRowImpl)this.getCurrentRow();
                vFila.getview_orden_judicial().insertRow(vFila.getview_orden_judicial().createRow());
            } else if (vTipo.equals("DEUDORES")) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("Anio", vAnio);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                vFila = (SisSolicitudVwRowImpl)this.getCurrentRow();
                vFila.getSis_deudores_vw().insertRow(vFila.getSis_deudores_vw().createRow());
            } else if (vTipo.equals("RETIRO OBLIGATORIO")) {
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                //vAtributos.setAttribute("IdContrato",vIdContrato);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
            } else {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("IdContrato", vIdContrato);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("Anio", vAnio);
                vAtributos.setAttribute("IdPartida", pIdPartida);
                vAtributos.setAttribute("IdPuesto", pIdPuesto);
                vAtributos.setAttribute("NumeroPlaza", pNumeroPlaza);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);

            }
        } catch (Exception exep) {
            exep.printStackTrace();
        }
    }

    public void crearSolicitud4(String vTipo, Number vRegistroEmpleado, 
                                Number vIdContrato, Number pIdPartida, 
                                Number pIdPuesto, Number pNumeroPlaza, 
                                Number vAnio, String vCreadoPor, 
                                String vOrigen, String vTipoPuesto) {
        SisSolicitudVwRowImpl vFila = null;
        SisDetLicenciaVwRowImpl vfila2 = null;
        SisSuspencionIgssRowImpl vfila3 = null;
        SisPromReclafViewRowImpl vFila4 = null;
        NameValuePairs vAtributos = new NameValuePairs();

        this.getDBTransaction().rollback();

        try {
            if (vTipo.equals("PROMOCION Y RECLASIFICACION")) {
                vAtributos.setAttribute("RegistroEmpleado", vRegistroEmpleado);
                vAtributos.setAttribute("CreadoPor", vCreadoPor);
                vAtributos.setAttribute("tipoSolicitud", vTipo);
                vAtributos.setAttribute("Anio", vAnio);
                vAtributos.setAttribute("TipoPuesto", vTipoPuesto);
                vFila = 
                        (SisSolicitudVwRowImpl)this.createAndInitRow(vAtributos);
                this.insertRow(vFila);
                //vFila=(SisSolicitudVwRowImpl)this.getCurrentRow();
                //vFila.getSisPromReclafView().insertRow(vFila.getSisPromReclafView().createRow());

                /*
           vAtributos = new NameValuePairs();
           vAtributos.setAttribute("CreadoPor",vCreadoPor);
           vFila4=(SisPromReclafViewRowImpl) vFila.getSisPromReclafView().createAndInitRow(vAtributos);
           vFila.getSisPromReclafView().insertRow(vFila4);
           */
            }
        } catch (Exception exep) {
            exep.printStackTrace();
        }
    }

    //Función que obtiene el ID de la solicitud autorizada de fallecimiento de un trabajador

    public String obtenerIDSolicitudFallecimiento_autorizado(Number vRegistroEmpleado) {
        Object vResultado;
        String strConsulta;
        strConsulta = "select id_solicitud from siif.sis_solicitud";
        strConsulta += " where id_tipo_solicitud = 9 and id_estado = 39 and";
        strConsulta += " registro_empleado = " + vRegistroEmpleado;
        vResultado = 
                utils_DB.getEjecutarQuerry(this.getDBTransaction(), strConsulta);
        return vResultado.toString();
    }

    //Función que obtiene el ID de la solicitud autorizada de retiro definitivo de un trabajador

    public String obtenerIDSolicitudRetiro_autorizado(Number vRegistroEmpleado) {
        Object vResultado;
        String strConsulta;
        strConsulta = "select id_solicitud from siif.sis_solicitud";
        strConsulta += " where id_tipo_solicitud in(5,6) and id_estado = 39 and";
        strConsulta += " registro_empleado = " + vRegistroEmpleado;
        vResultado = 
                utils_DB.getEjecutarQuerry(this.getDBTransaction(), strConsulta);
        return vResultado.toString();
    }
    
    //Función que verifica si el trabajador fallecido tiene un cheque en trámite.
    public String verificarChequeTramite_SolicitudFallecimiento(Number pIdSolicitud, Date fechaSolicitud) {
        Object vResultado;
        String strConsulta;
        //strConsulta = "select count(*) as cantidad from sis_solicitud sol";
        //strConsulta += " inner join sis_nomina nom on sol.registro_empleado = nom.registro_empleado";
        //strConsulta += " inner join sis_proceso pro on nom.ID_PROCESO = pro.ID_PROCESO and pro.ID_ESTADO != 52 and pro.FECHA_INICIO > to_date('"+ fechaSolicitud.toString() + "','yyyy-mm-dd')";
        //strConsulta += " inner join sis_pago pago on nom.id_nomina = pago.id_nomina";
        //strConsulta += " inner join sis_documento_banco doc_ban on pago.id_documento_banco = doc_ban.id_documento_banco";
        //strConsulta += " where sol.id_solicitud = " + pIdSolicitud + " order by id_solicitud desc";
        strConsulta = "select count(*) as cantidad from sis_solicitud sol";
        strConsulta += " inner join sis_nomina nom on sol.registro_empleado = nom.registro_empleado and nom.id_estado != 23";
        strConsulta += " inner join sis_proceso pro on nom.ID_PROCESO = pro.ID_PROCESO and pro.ID_ESTADO != 52 and pro.ID_PROCESO!= 101";
        strConsulta += " where sol.id_solicitud = " + pIdSolicitud + " and not exists(";
        strConsulta += " select * from sis_documento_banco doc_ban";
        strConsulta += " inner join sis_pago pago on doc_ban.id_documento_banco = pago.id_documento_banco";
        strConsulta += " where pago.id_nomina = nom.id_nomina)";
        //System.out.println("La consulta es: " + strConsulta);
        vResultado=utils_DB.getEjecutarQuerry(this.getDBTransaction(), strConsulta);
        //System.out.println("El resultado es: "+ vResultado);
        return vResultado.toString();
    }

    //Método que actualiza el registro de empleado de una solicitud, así como el usuario y fecha que modifica

    public String actualizarSolicitud(Number vIdSolicitud, 
                                      Number vRegistroEmpleado, 
                                      String vActualizadoPor) {
        Object vResultado;
        String strConsulta;
        strConsulta = 
                "update SIIF.SIS_SOLICITUD set REGISTRO_EMPLEADO = " + vRegistroEmpleado;
        strConsulta += 
                " , MOD_POR = " + vActualizadoPor + " , FECHA_MOD = SYSDATE ";
        strConsulta += " where ID_SOLICITUD = " + vIdSolicitud;
        //System.out.println(strConsulta);
        vResultado = 
                utils_DB.getEjecutarConsulta(this.getDBTransaction(), strConsulta);
        return vResultado != null ? vResultado.toString() : "-1";
    }

    //Procedimiento que nos dice si un trabajador está fallecido o no

    public String verificarTrabajadorFallecido(Number vRegistroEmpleado) {
        Object vResultado;
        String strConsulta;
        strConsulta = "select count(*) from siif.sis_solicitud";
        strConsulta += " where id_tipo_solicitud = 9 and id_estado = 39 and";
        strConsulta += " registro_empleado = " + vRegistroEmpleado;
        vResultado = 
                utils_DB.getEjecutarQuerry(this.getDBTransaction(), strConsulta);
        return vResultado.toString();
    }

    //Procedimiento que nos dice si un trabajador está retirado o no

    public String verificarTrabajadorRetirado(Number vRegistroEmpleado) {
        Object vResultado;
        String strConsulta;
        strConsulta = "select count(*) from siif.sis_solicitud";
        strConsulta += " where id_tipo_solicitud in(5,6) and id_estado = 39 and";
        strConsulta += " registro_empleado = " + vRegistroEmpleado;
        vResultado = 
                utils_DB.getEjecutarQuerry(this.getDBTransaction(), strConsulta);
        return vResultado.toString();
    }
    
    /**executeQueryForCollection - overridden for custom java data source support.
     */
    protected void executeQueryForCollection(Object qc, Object[] params, 
                                             int noUserParams) {

        if (vCambiarQuerry == false && vConsultaOrig != null) {

            this.setQuery(this.vConsultaOrig);
        }

        super.executeQueryForCollection(qc, params, noUserParams);
    }


    public void actualizarEstado() {
        Row vFila;
        Object vNomEstado;
        vFila = this.getCurrentRow();

        //   vFila.getAttributeNames()


        vNomEstado = 
                utils_DB.getEjecutarQuerry(this.getDBTransaction(), "select b.nombre from sis_solicitud a, sis_estado b where a.id_estado=b.id_estado and tabla='SIS_SOLICITUD' and a.id_solicitud=" + 
                                           vFila.getAttribute("IdSolicitud"));

        if (vFila.getAttribute("Nomestado") != null && 
            !vFila.getAttribute("Nomestado").equals(vNomEstado)) {

            vFila.setAttribute("Nomestado", vNomEstado);

        } else if (vFila.getAttribute("Nomestado") == null) {
            vFila.setAttribute("Nomestado", vNomEstado);

        }

    }

    /*
 *
 */

    public void CambiarPlaza(Number vIdContrato, Number pIdPartida, 
                             Number pIdPuesto, Number pNumeroPlaza, 
                             Number vAnio, String pPartida, 
                             String pNomPuesto) {
        Row vFila = this.getCurrentRow();

        if (vFila != null) {

            vFila.setAttribute("IdContrato", vIdContrato);
            vFila.setAttribute("IdPartida", pIdPartida);
            vFila.setAttribute("IdPuesto", pIdPuesto);
            vFila.setAttribute("NumeroPlaza", pNumeroPlaza);
            vFila.setAttribute("Anio", vAnio);
            vFila.setAttribute("Partida", pPartida);
            vFila.setAttribute("NomPuesto", pNomPuesto);

        }


    }


    public void ConsultaPorId(Number pIdSolicitud) {
        String pConsulta = 
            "select a.id_solicitud,\n" + "a.id_tipo_solicitud,\n" + 
            "a.id_contrato,\n" + "a.registro_empleado,\n" + "a.documento,\n" + 
            "a.observacion,\n" + "a.fecha_creacion,\n" + "a.id_estado,\n" + 
            "a.fecha_solicitud,\n" + "a.creado_por,\n" + 
            "b.nombre_solicitud,\n" + "c.nombre nomestado, \n" + "a.anio,\n" + 
            "a.id_partida,\n" + "a.id_puesto,\n" + "a.numero_plaza,\n" + 
            "a.origen,\n" + "pst.nombre as nomPuesto,\n" + "part.formato2,\n" + 
            "a.tipo_puesto,\n" + "case when a.id_tipo_solicitud=1 then \n" + 
            "( select to_char(det.fecha_inicio,'dd/mm/yyyy')||' - '||to_char(det.fecha_fin,'dd/mm/yyyy') \n" + 
            " from sis_det_licencia det\n" + 
            "  where id_solicitud=a.id_solicitud)\n" + " else\n" + 
            "  case when a.id_tipo_solicitud=2 then\n" + 
            "    (select to_char(fecha_inicio_susp_igss,'dd/mm/yyyy')||' - '||to_char(fecha_alta_susp_igss,'dd/mm/yyyy')\n" + 
            "       from sis_suspencion_igss\n" + 
            "    where id_solicitud=a.id_solicitud)\n" + "   else\n" + 
            "     case when a.id_tipo_solicitud=4 then\n" + 
            "     (select to_char(fecha_alta_susp_igss,'dd/mm/yyyy')\n" + 
            "        from sis_suspencion_igss\n" + 
            "      where id_solicitud=a.id_solicitud)\n" + "     else\n" + 
            "      to_char(a.FECHA_SOLICITUD,'dd/mm/yyyy')\n" + 
            "    end      \n" + "  end \n" + " end as fechas_gestion,\n" + 
            "  usr.nombres||' '||apellidos as nomusr\n" + 
            "from sis_solicitud a\n" + 
            "left outer join sis_partida_vw part on (a.id_partida=part.id_partida)\n" + 
            "left outer join sis_puesto pst on (a.id_puesto=pst.id_puesto)\n" + 
            "left outer join usuario usr on usr.usuario=a.creado_por and usr.tipo_usuario='TRABAJADOR'\n" + 
            ",sis_tipo_solicitud b,sis_estado_solicitud_vw c \n" + 
            " where a.id_tipo_solicitud=b.id_tipo_solicitud\n" + 
            " and :reg_empleado=:reg_empleado\n" + 
            " and c.id_estado=a.id_estado\n" + " and :fechaI=:fechaI\n" + 
            " and :fechaF=:fechaF\n" + 
            " and :pfiltrarxtipopuesto is null and :pIdSolicitud=:pIdSolicitud" + 
            " and id_solicitud=" + pIdSolicitud;

        if (vConsultaOrig == null) {

            vConsultaOrig = this.getQuery();
        }


        this.setQuery(pConsulta);
        this.setreg_empleado(new Number(0));
        this.setfechaI(utils.getFechaActual());
        this.setfechaF(utils.getFechaActual());
        this.setpfiltrarxtipopuesto(null);
        this.setpIdSolicitud(utils.getNumberOracle("0"));

        vCambiarQuerry = true;
        this.executeQuery();
        vCambiarQuerry = false;

    }

    /**Gets the bind variable value for pfiltrarxtipopuesto
     */
    public String getpfiltrarxtipopuesto() {
        return (String)getNamedWhereClauseParam("pfiltrarxtipopuesto");
    }

    /**Sets <code>value</code> for bind variable pfiltrarxtipopuesto
     */
    public void setpfiltrarxtipopuesto(String value) {
        setNamedWhereClauseParam("pfiltrarxtipopuesto", value);
    }

    /**Gets the bind variable value for pIdSolicitud
     */
    public Number getpIdSolicitud() {
        return (Number)getNamedWhereClauseParam("pIdSolicitud");
    }

    /**Sets <code>value</code> for bind variable pIdSolicitud
     */
    public void setpIdSolicitud(Number value) {
        setNamedWhereClauseParam("pIdSolicitud", value);
    }


    public void reversar_gestion(Number pIdGestion, String pObserv, 
                                 String pUsuario) {
        String vResultado;
        NameValuePairs vListado;
        vListado = new NameValuePairs();

        vListado.setAttribute("01", pIdGestion);
        vListado.setAttribute("02", pObserv);
        vListado.setAttribute("03", pUsuario);

        vResultado = 
                utils_DB.ejecutarProcedimiento3(this.getDBTransaction(), "sis_pkg_procs.REVERTIR_GESTIONES(?,?,?,'SOLICITUD')", 
                                                vListado);

        if (vResultado.toString().equals("OK")) {

            this.getDBTransaction().commit();
        } else {

            throw new JboException(vResultado);
        }

    }

    public String verificarRango_solicitud(Number id_contrato, 
                                           String fecha_inicio, 
                                           String fecha_fin) {

        Object vResultado;
        String strConsulta;

        strConsulta = 
                "select count(*) from sis_solicitud s " + "inner join sis_tipo_solicitud ts on ts.id_tipo_solicitud = s.id_tipo_solicitud " + 
                "left join sis_det_licencia det on det.id_solicitud = s.id_solicitud " + 
                "inner join sis_contrato cont on cont.id_contrato = s.id_contrato " + 
                "where s.id_contrato =" + id_contrato + 
                "and ( ts.NOMBRE_SOLICITUD = 'RENUNCIA PARCIAL' or ts.nombre_solicitud = 'LICENCIA' or ts.nombre_solicitud = 'RENUNCIA' ) " + 
                "and (    (to_date('" + fecha_inicio + 
                "','yyyy-mm-dd') between det.FECHA_INICIO and nvl(det.FECHA_FIN,cont.fecha_fin)) " + 
                "      or (to_date('" + fecha_fin + 
                "','yyyy-mm-dd') between det.FECHA_INICIO and nvl(det.FECHA_FIN,cont.fecha_fin)) " + 
                "      or (to_date('" + fecha_inicio + 
                "','yyyy-mm-dd') >= s.FECHA_SOLICITUD )" + "    )";

        vResultado = 
                utils_DB.getEjecutarQuerry(this.getDBTransaction(), strConsulta);
        return vResultado != null ? vResultado.toString() : "-1";
    }

    /**Gets the bind variable value for pUsuario
     */
    public String getpUsuario() {
        return (String)getNamedWhereClauseParam("pUsuario");
    }

    /**Sets <code>value</code> for bind variable pUsuario
     */
    public void setpUsuario(String value) {
        setNamedWhereClauseParam("pUsuario", value);
    }
}
