package enlace_datos.consultas.gestiones.anexo;

import enlace_datos.consultas.gestiones.anexo.common.sis_anexo;

import enlace_datos.util.utils;

import java.util.Calendar;

import oracle.jbo.domain.Date;
import oracle.jbo.server.ViewObjectImpl;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class sis_anexoImpl extends ViewObjectImpl implements sis_anexo {
    /**This is the default constructor (do not remove)
     */
    public sis_anexoImpl() {
    }

public void reset(){
    this.setWhereClause("id_anexo<0");
    this.executeQuery();
    
}

public void paramFecha(Date fechaInicio, Date fechaFin,String pUsuario, String idAnexo) {
    
    String str_querry="";    
    boolean bolWhereFechas = true;
    
    if (idAnexo != null  ) {
        try {
        
            int intidAnexo = Integer.parseInt(idAnexo);
            str_querry = "ID_ANEXO = "+intidAnexo ;
            this.setWhereClause(str_querry);
            this.setpUsuario(pUsuario);
            this.executeQuery();
            bolWhereFechas = false;
        
        }catch(Exception e){
            bolWhereFechas = true;
        }   
    }
    
    if (bolWhereFechas){
        if(fechaInicio == null && fechaFin == null){
            str_querry = "fecha_creacion between sysdate - 30 and sysdate";
            this.setWhereClause(str_querry);
            this.setpUsuario(pUsuario);
            //this.setOrderByClause("fecha_creacion");
            this.executeQuery();
        }
        else if (fechaInicio!= null && fechaFin == null){
            str_querry = "fecha_creacion between to_date('"+utils.getFechaFormato(fechaInicio.getValue())+"','dd/mm/yyyy') and sysdate";  
            this.setWhereClause(str_querry);
            this.setpUsuario(pUsuario);
            //this.setOrderByClause("fecha_creacion");
            this.executeQuery();    
        }
        else {
            str_querry = "fecha_creacion between to_date('"+utils.getFechaFormato(fechaInicio.getValue())+"','dd/mm/yyyy') and to_date('"+utils.getFechaFormato(fechaFin.getValue())+"','dd/mm/yyyy')";  
            this.setWhereClause(str_querry);
            this.setpUsuario(pUsuario);
            //this.setOrderByClause("fecha_creacion");
            this.executeQuery();
        }
    }
}

public void paramPresupuesto(String pUsuario) {
    String str_querry="";
  /*  str_querry = " anexo.ESTATUS = estado.ID_ESTADO AND estado.NOMBRE like 'TRASLADADO' AND " +
    " <estado.TABLA> like 'SIS_ANEXO' and exists(select 1 from sis_secuencia_estados x, usuario_perfil " +
    " where x.perfil=y.perfil and usuario= " + pUsuario + " and id_estado_origen = anexo.ESTATUS) " +
    " and (exists( select * from sis_acceso_Dependencia f where anexo.id_dependencia=f.id_dependencia " + 
    " and f.usuario=  " + pUsuario + " ) or exists( select 1 from sis_acceso_unidad g " +
    " where dependencia1.id_dependencia=g.id_dependencia and g.usuario=  " + pUsuario + 
    "))";
*/
    //this.setWhereClause(str_querry);
     str_querry = " ESTATUS = ID_ESTADO AND nomEstado like 'TRASLADADO' AND" + 
     " TABLA like 'SIS_ANEXO' and exists (" + 
     " select 1 from sis_secuencia_estados x, usuario_perfil y where x.perfil=y.perfil " + 
     " and usuario= '" + pUsuario + "' and id_estado_origen = ESTATUS) and " + 
     " (exists(select * from sis_acceso_Dependencia f where id_dependencia=f.id_dependencia" + 
     " and f.usuario= '" + pUsuario + "' ) or exists(select 1 from sis_acceso_unidad g" + 
     " where id_dependencia=g.id_dependencia and g.usuario=  '" + pUsuario + "' ))" +
     " ";
    this.setWhereClause(str_querry);
    this.setpUsuario(pUsuario);
    //this.setQuery(str_querry);
    //this.setOrderByClause("fecha_creacion");
    this.executeQuery();
}

    /**Gets the bind variable value for pUsuario
     */
    public String getpUsuario() {
        return (String)getNamedWhereClauseParam("pUsuario");
    }

    /**Sets <code>value</code> for bind variable pUsuario
     */
    public void setpUsuario(String value) {
        setNamedWhereClauseParam("pUsuario", value);
    }
    public void anexo_autorizado(String pUsuario){
       
        String str_querry = " ESTATUS = ID_ESTADO AND nomEstado = 'AUTORIZADO' AND" + 
        " TABLA = 'SIS_ANEXO'";
        this.setWhereClause(str_querry);
        this.setpUsuario(pUsuario);
        
        this.executeQuery();
    }
    
}
