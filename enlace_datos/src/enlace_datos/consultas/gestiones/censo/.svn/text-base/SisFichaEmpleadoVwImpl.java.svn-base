package enlace_datos.consultas.gestiones.censo;


import enlace_datos.consultas.gestiones.censo.common.SisFichaEmpleadoVw;

import enlace_datos.util.utils;

import enlace_datos.util.utils_DB;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;

import oracle.jbo.NameValuePairs;
import oracle.jbo.Row;
import oracle.jbo.RowIterator;
import oracle.jbo.domain.Number;
import oracle.jbo.server.ViewObjectImpl;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class SisFichaEmpleadoVwImpl extends ViewObjectImpl implements SisFichaEmpleadoVw {
    private static int vNumPreguntas=25;
    private boolean vActualizaVal=false;
    
    /**This is the default constructor (do not remove)
     */
    public SisFichaEmpleadoVwImpl() {
    }


    public void setActualizaValResp(boolean pValor){
        this.vActualizaVal=pValor;
    }
    
    /**Gets the bind variable value for pRegEmpleado
     */
    public Number getpRegEmpleado() {
        return (Number)getNamedWhereClauseParam("pRegEmpleado");
    }

    /**Sets <code>value</code> for bind variable pRegEmpleado
     */
    public void setpRegEmpleado(Number value) {
        setNamedWhereClauseParam("pRegEmpleado", value);
    }

    /**Gets the bind variable value for pNumFormulario
     */
    public Number getpNumFormulario() {
        return (Number)getNamedWhereClauseParam("pNumFormulario");
    }

    /**Sets <code>value</code> for bind variable pNumFormulario
     */
    public void setpNumFormulario(Number value) {
        setNamedWhereClauseParam("pNumFormulario", value);
        
    }
    
    protected void create() {
      super.create();
     /*
       for (int i=0;i<vNumPreguntas;i++) {
        addDynamicAttribute("Pregunta"+i);
        addDynamicAttribute("PreguntaOtros"+i);
                                        }
     */                                   
    }
    
    public void PrepararRespuestasCenso(List vRespuestas){
    
        Row vfila;
        vfila=this.getCurrentRow();
       // System.out.println(" id respuesta0 " + vfila.getAttribute("Pregunta1"));
        vfila.setAttribute("RespuestasCenso", vRespuestas);
    }
    
    
    public void resetearRespuestas(List vRespuestas){
       int vTamanio;
       vTamanio=vRespuestas.size();
       NameValuePairs vValor;
       
       for (int i=0;i<vTamanio;i++){
        vValor=(NameValuePairs)vRespuestas.get(i);           
        vValor.setAttribute("ids",null);
        vValor.setAttribute("otros",null);
       }
        
    }
    
    
    
public boolean isSelectedControl(String vIdRespuesta)
{
        SisFichaEmpleadoVwRowImpl vfila;
        SisRespuestaCensoVwRowImpl vFilaResp;
        RowIterator vFilas;
       boolean vResultado=false;
        if (this.getCurrentRow()!=null && vActualizaVal==false)
        {
        vfila=(SisFichaEmpleadoVwRowImpl)this.getCurrentRow();
        vFilas=vfila.getSisRespuestaCensoVw();
       
        
            while (vFilas.hasNext())
            {
            
                vFilaResp=(SisRespuestaCensoVwRowImpl)vFilas.next();
                
                 if (vFilaResp.getIdRespuesta().toString().equals(vIdRespuesta)) 
                 {
                     vResultado=true;
                     break;
                     
                 }
                 
            }        
        
      
        }
 return vResultado;    
}    

public HashMap getRespuestas()
{
            SisFichaEmpleadoVwRowImpl vfila;
            SisRespuestaCensoVwRowImpl vFilaResp;
            RowIterator vFilas;
            HashMap vListado=new HashMap();
            
            if (this.getCurrentRow()!=null && vActualizaVal==false)
            {
            vfila=(SisFichaEmpleadoVwRowImpl)this.getCurrentRow();
            vFilas=vfila.getSisRespuestaCensoVw();
           
            
                while (vFilas.hasNext())
                {
                
                    vFilaResp=(SisRespuestaCensoVwRowImpl)vFilas.next();                    
                    vListado.put(vFilaResp.getIdRespuesta().toString(),vFilaResp.getIdRespuesta().toString());                     
                     
                }        
            
          
            }
     return vListado;    
}    



    
    public void setValoresRespuestas(List vRespuestas){
        SisFichaEmpleadoVwRowImpl vfila;
        SisRespuestaCensoVwRowImpl vFilaResp;
        NameValuePairs vFilaResp2=null;
        RowIterator vFilas;
        String vTipoControl;
        Number vIdAnt=new Number(0);
        ArrayList vids;
        String vGrupoCensoFicha,vGrupoCensoResp;
        
        
        
        if (this.getCurrentRow()!=null && vActualizaVal==false){
        vfila=(SisFichaEmpleadoVwRowImpl)this.getCurrentRow();
        vFilas=vfila.getSisRespuestaCensoVw();
        
        //resetearRespuestas(vRespuestas); //Reseteando las respuestas
     //   System.out.println("actualizando las respuestas censo");
        
          vGrupoCensoFicha=vfila.getGrupoCenso().toString();

          while (vFilas.hasNext())
          {
        
            vFilaResp=(SisRespuestaCensoVwRowImpl)vFilas.next();
            vTipoControl=vFilaResp.getTipoControl();
           // vFilaResp.getTipoControl()
            
            vGrupoCensoResp=(vFilaResp.getGrupoCenso()==null?"0":vFilaResp.getGrupoCenso().toString());
            
        if (vGrupoCensoFicha.equals(vGrupoCensoResp))
        {
            
             if (vIdAnt.compareTo(vFilaResp.getIdPregunta())!=0){ //Si es distinta a la anterior lo busca
                 vIdAnt=new Number(vFilaResp.getIdPregunta());
                 vFilaResp2=buscarPregunta(vRespuestas,vFilaResp.getIdPregunta());
             }
                
             if (vFilaResp2!=null){
                  if (!vFilaResp.getIdRespuesta().toString().equals("0")&& (vTipoControl.equals("CHECK")||vTipoControl.equals("MANYSHUTTLE")))  //||vTipoControl.equals("COMBO")
                  { 
                      if (vFilaResp2.getAttribute("ids")==null)
                      {
                         vFilaResp2.setAttribute("ids",new ArrayList());
                         vids=(ArrayList)vFilaResp2.getAttribute("ids");
                         vids.add(vFilaResp.getIdRespuesta().toString());
                      }else{
                         vids=(ArrayList)vFilaResp2.getAttribute("ids");
                         vids.add(vFilaResp.getIdRespuesta().toString());
                            }
                      
                    }
                 else if (!vFilaResp.getIdRespuesta().toString().equals("0")&& (vTipoControl.equals("RADIOSH"))) 
                 {
                     
                     
                     
                 }            
                  else if(!vFilaResp.getIdRespuesta().toString().equals("0"))
                  {
                      vFilaResp2.setAttribute("ids",vFilaResp.getIdRespuesta().toString());  
                  
                  }else if(vFilaResp.getIdRespuesta().toString().equals("0"))
                  {
                   
                      if (vTipoControl.equals("TABLAINTERRUP"))
                        vFilaResp2.setAttribute("otros",vFilaResp.getXMLCACHE());  
                      else
                        vFilaResp2.setAttribute("otros",vFilaResp.getOtraRespuesta());  
                      
                  
                  }
                 
                       }
            }     
          }   // while
        } 
        vActualizaVal=true;  
    }
    
    public NameValuePairs buscarPregunta(List vRespuestas,Number vIdPreg){
      int vTamanio;  
      NameValuePairs vValores=null;
      vTamanio=vRespuestas.size();  
      
      for (int i=0;i<vTamanio;i++){
          vValores=(NameValuePairs)vRespuestas.get(i);
            if (vValores.getAttribute("id_pregunta")!=null &&
            vValores.getAttribute("id_pregunta").toString().equals(vIdPreg.toString())){
                break;                
            }
      }
    return vValores;
    }


 public void nextGrupo()
 {
     Number vGrupo;
     Object vGrupoC;
     vGrupoC=this.getCurrentRow().getAttribute("GrupoCenso");
     
     if (vGrupoC!=null)
     {
     
        vGrupo=(Number)this.getCurrentRow().getAttribute("GrupoCenso");    
        vGrupo=vGrupo.add(1);
        this.getCurrentRow().setAttribute("GrupoCenso",vGrupo);
         
     }else {
         
         this.getCurrentRow().setAttribute("GrupoCenso",utils.getNumberOracle("2")); 
     }
     
 }
  
public void setTipoGestion(String vTipo){
    Row vfila;
    vfila=this.getCurrentRow();
    vfila.setAttribute("vTipoGestion", vTipo);    
    
}


public void resetearBaseCenso(Number pRegistroEmpleado){
    String vUpdate;
    
    this.getDBTransaction().rollback();;
    vUpdate="delete from sis_respuesta_censo where registro_empleado="+pRegistroEmpleado;    
    utils_DB.getEjecutarConsulta(this.getDBTransaction(),vUpdate);
    
    vUpdate="update sis_ficha_empleado set grupo_censo=1 where registro_empleado="+pRegistroEmpleado;
    utils_DB.getEjecutarConsulta(this.getDBTransaction(),vUpdate);    
    this.getDBTransaction().commit();
    
}


public void crearFichaCenso(){
   
   Row pFila;
   Number pFormulario;
   Object vSecuencia;
   pFila=this.createRow();

   vSecuencia=utils_DB.getValorSequencia(this.getDBTransaction(),"sis_ficha_empleado_censo_sq");

   pFormulario=utils.getNumberOracle(vSecuencia);
   pFormulario=pFormulario.subtract(100000000);
   
   pFila.setAttribute("RegistroEmpleado",utils.getNumberOracle(vSecuencia));
   pFila.setAttribute("NoFormulario",pFormulario);
   pFila.setAttribute("OrigenDatos","PL");
   pFila.setAttribute("Estadocivil","S");
   pFila.setAttribute("Estado","0");
   pFila.setAttribute("OtroTrabajo","NO");
   pFila.setAttribute("vTipoGestion","2");
   this.insertRow(pFila);
    
}


public void buscarCensoPlanilla(Number pNoForm)
{
  this.setpNumFormulario(pNoForm);  
  this.setWhereClause("origen_datos='PL'");
  this.executeQuery();
 
}

public void resetFiltros(){
    this.setWhereClause("");  
}    
}
